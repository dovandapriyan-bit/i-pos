<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Pos - Restoran & Cafe Management System</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --accent-primary: #3b82f6;
            --accent-secondary: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --accent-success: #10b981;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-light: #94a3b8;
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --sidebar-width: 260px;
            --header-height: 70px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            z-index: 1000;
            transition: transform 0.3s ease;
            box-shadow: var(--shadow);
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
            background-color: var(--bg-secondary);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .sidebar-header h1 {
            font-size: 1.5rem;
            color: var(--accent-primary);
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .sidebar-header .company-name {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .sidebar-menu {
            list-style: none;
            padding: 1rem 0;
            flex-grow: 1;
        }

        .sidebar-menu li {
            position: relative;
        }

        .sidebar-menu li a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s ease-in-out;
            border-left: 3px solid transparent;
        }

        .sidebar-menu li a:hover, .sidebar-menu li a.active {
            background-color: rgba(59, 130, 246, 0.05);
            color: var(--accent-primary);
            border-left-color: var(--accent-primary);
        }

        .notification-badge {
            position: absolute;
            top: 0.75rem;
            right: 1rem;
            background-color: var(--accent-danger);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .main-content {
            margin-left: var(--sidebar-width);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .topbar {
            height: var(--header-height);
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .topbar-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .topbar-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background-color: var(--bg-tertiary);
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .user-info:hover {
            background-color: #e2e8f0;
        }

        .user-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--accent-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .user-dropdown {
            position: relative;
        }

        .user-dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            min-width: 200px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            display: none;
        }

        .user-dropdown-menu.show {
            display: block;
        }

        .user-dropdown-item {
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .user-dropdown-item:hover {
            background-color: var(--bg-tertiary);
        }

        .user-dropdown-item.active {
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--accent-primary);
        }

        .content-area {
            padding: 2rem;
            flex-grow: 1;
            overflow-y: auto;
        }

        .page { display: none; }
        .page.active { display: block; }

        .card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary { 
            background-color: var(--accent-primary); 
            color: white; 
        }

        .btn-primary:hover { 
            background-color: #2563eb; 
            transform: translateY(-1px);
        }

        .btn-secondary { 
            background-color: var(--bg-tertiary); 
            color: var(--text-primary); 
        }

        .btn-secondary:hover { 
            background-color: #e2e8f0; 
            transform: translateY(-1px);
        }

        .btn-success { 
            background-color: var(--accent-success); 
            color: white; 
        }

        .btn-success:hover { 
            background-color: #0d9668; 
            transform: translateY(-1px);
        }

        .btn-danger { 
            background-color: var(--accent-danger); 
            color: white; 
        }

        .btn-danger:hover { 
            background-color: #b91c1c; 
            transform: translateY(-1px);
        }

        .btn-warning { 
            background-color: var(--accent-warning); 
            color: white; 
        }

        .btn-warning:hover { 
            background-color: #d97706; 
            transform: translateY(-1px);
        }

        .form-group { margin-bottom: 1rem; }
        .form-group label { 
            display: block; 
            margin-bottom: 0.5rem; 
            font-size: 0.875rem; 
            font-weight: 500; 
            color: var(--text-primary);
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.625rem;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            transition: border-color 0.2s;
            font-family: inherit;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-cols-1 { grid-template-columns: repeat(1, 1fr); }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .kpi-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background-color: var(--accent-primary);
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .kpi-card p { 
            font-size: 2rem; 
            font-weight: 700; 
            color: var(--accent-primary); 
            margin-bottom: 0.5rem;
        }

        .kpi-card h3 { 
            font-size: 0.875rem; 
            color: var(--text-secondary); 
        }

        .pos-layout {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 1.5rem;
            height: calc(100vh - var(--header-height) - 4rem);
        }

        .pos-menu-container {
            overflow-y: auto;
        }

        .pos-categories {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .pos-category-btn {
            padding: 0.5rem 1rem;
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .pos-category-btn.active, .pos-category-btn:hover {
            background-color: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .pos-menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
        }

        .pos-menu-item {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .pos-menu-item.best-seller {
            border: 2px solid var(--accent-warning);
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.05) 0%, rgba(245, 158, 11, 0.1) 100%);
        }

        .pos-menu-item.best-seller::after {
            content: '⭐ Terlaris';
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: var(--accent-warning);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.65rem;
            font-weight: 600;
        }

        .pos-menu-item.out-of-stock {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pos-menu-item.out-of-stock::before {
            content: 'Habis';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            background-color: var(--accent-danger);
            color: white;
            padding: 5px 20px;
            font-weight: 600;
            z-index: 1;
        }

        .pos-menu-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .pos-menu-item:hover::before {
            opacity: 1;
        }

        .pos-menu-item:hover:not(.out-of-stock) {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-primary);
        }

        .pos-menu-item h4 { 
            font-size: 1rem; 
            margin-bottom: 0.25rem; 
        }

        .pos-menu-item p { 
            color: var(--accent-primary); 
            font-weight: 600; 
        }

        .pos-menu-item .menu-description {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            height: 2.5rem;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .pos-cart-container {
            display: flex;
            flex-direction: column;
        }

        .pos-cart {
            flex-grow: 1;
            overflow-y: auto;
            max-height: 400px;
        }

        .pos-cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .pos-cart-item-name { font-weight: 500; }
        .pos-cart-item-price { color: var(--text-secondary); }
        .pos-cart-item-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pos-cart-item-controls button {
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            padding: 0.25rem;
            transition: color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pos-cart-item-controls button:hover {
            color: var(--accent-primary);
        }

        .pos-summary {
            border-top: 1px solid var(--border-color);
            padding-top: 1rem;
            margin-top: 1rem;
        }

        .pos-summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .pos-summary-row.total {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-primary);
            border-top: 1px solid var(--border-color);
            padding-top: 0.5rem;
            margin-top: 0.5rem;
        }

        .kds-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .kds-order-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            border-left: 5px solid var(--accent-success);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .kds-order-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .kds-order-card.status-cooking { border-left-color: var(--accent-warning); }
        .kds-order-card.status-ready { border-left-color: var(--accent-primary); }
        .kds-order-card.status-new {
            border-left-color: var(--accent-success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        .kds-order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .kds-order-id { font-weight: 700; }
        .kds-order-time { font-size: 0.875rem; color: var(--text-secondary); }
        .kds-order-items { margin-bottom: 1rem; }
        .kds-order-item {
            display: flex;
            justify-content: space-between;
            padding: 0.25rem 0;
            align-items: center;
        }

        .kds-order-item-status {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.25rem;
        }

        .kds-order-item-status button {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .kds-order-item-status button.btn-ok {
            background-color: var(--accent-success);
            color: white;
        }

        .kds-order-item-status button.btn-cancel {
            background-color: var(--accent-danger);
            color: white;
        }

        .kds-order-item-status button.btn-out {
            background-color: var(--accent-warning);
            color: white;
        }

        .kds-order-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .kds-order-actions button { flex-grow: 1; }

        .menu-item-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .menu-item-card:hover {
            box-shadow: var(--shadow);
        }

        .menu-item-info h4 {
            margin-bottom: 0.25rem;
        }

        .menu-item-info p {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .menu-item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .history-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
        }

        .history-table th, .history-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .history-table th {
            background-color: var(--bg-tertiary);
            font-weight: 600;
        }

        .history-table tr:hover {
            background-color: rgba(59, 130, 246, 0.05);
        }

        .user-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .user-card:hover {
            box-shadow: var(--shadow);
        }

        .user-info-card {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar-large {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--accent-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.25rem;
        }

        .user-details h4 {
            margin-bottom: 0.25rem;
        }

        .user-details p {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .user-role-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .role-admin {
            background-color: rgba(239, 68, 68, 0.2);
            color: var(--accent-danger);
        }

        .role-cashier {
            background-color: rgba(59, 130, 246, 0.2);
            color: var(--accent-primary);
        }

        .role-kitchen {
            background-color: rgba(16, 185, 129, 0.2);
            color: var(--accent-success);
        }

        .role-owner {
            background-color: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
        }

        .table-management-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        .table-management-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.2s;
        }

        .table-management-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .table-management-card.available {
            border-color: var(--accent-success);
        }

        .table-management-card.occupied {
            border-color: var(--accent-danger);
            opacity: 0.8;
        }

        .table-management-card.reserved {
            border-color: var(--accent-warning);
            opacity: 0.8;
        }

        .table-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .table-status {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .table-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }

        .table-order-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
        }

        .table-orders-section {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .order-status-timeline {
            display: flex;
            justify-content: space-between;
            margin: 1rem 0;
            position: relative;
        }

        .order-status-timeline::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--border-color);
            z-index: 1;
        }

        .order-status-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .order-status-step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            transition: all 0.3s;
        }

        .order-status-step.active .order-status-step-circle {
            border-color: var(--accent-primary);
            background-color: var(--accent-primary);
            color: white;
        }

        .order-status-step.completed .order-status-step-circle {
            border-color: var(--accent-success);
            background-color: var(--accent-success);
            color: white;
        }

        .order-status-step-label {
            font-size: 0.75rem;
            text-align: center;
            color: var(--text-secondary);
        }

        .order-status-step.active .order-status-step-label {
            color: var(--accent-primary);
            font-weight: 600;
        }

        .order-status-step.completed .order-status-step-label {
            color: var(--accent-success);
            font-weight: 600;
        }

        .subscription-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 1rem;
        }

        .status-active {
            background-color: rgba(16, 185, 129, 0.2);
            color: var(--accent-success);
        }

        .status-expired {
            background-color: rgba(239, 68, 68, 0.2);
            color: var(--accent-danger);
        }

        .status-trial {
            background-color: rgba(59, 130, 246, 0.2);
            color: var(--accent-primary);
        }

        .license-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .license-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: rgba(255,255,255,0.1);
            transform: rotate(45deg);
        }

        .license-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .license-info-item {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .license-info-item h4 {
            font-size: 0.875rem;
            opacity: 0.8;
            margin-bottom: 0.5rem;
        }

        .license-info-item p {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .license-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .transaction-history {
            margin-top: 2rem;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-amount {
            font-weight: 600;
            color: var(--accent-success);
        }

        .transaction-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-completed {
            background-color: rgba(16, 185, 129, 0.2);
            color: var(--accent-success);
        }

        .status-pending {
            background-color: rgba(245, 158, 11, 0.2);
            color: var(--accent-warning);
        }

        .status-failed {
            background-color: rgba(239, 68, 68, 0.2);
            color: var(--accent-danger);
        }

        .plan-card {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .plan-card.selected {
            border-color: var(--accent-primary);
            background-color: rgba(59, 130, 246, 0.05);
        }

        .plan-card.recommended {
            border-color: var(--accent-success);
            position: relative;
            overflow: hidden;
        }

        .plan-card.recommended::before {
            content: 'REKOMENDASI';
            position: absolute;
            top: 10px;
            right: -30px;
            background-color: var(--accent-success);
            color: white;
            padding: 0.25rem 2rem;
            font-size: 0.75rem;
            font-weight: 600;
            transform: rotate(45deg);
        }

        .plan-price {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin: 1rem 0;
        }

        .plan-period {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .plan-features {
            list-style: none;
            margin: 1.5rem 0;
            text-align: left;
        }

        .plan-features li {
            padding: 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .plan-features li i {
            color: var(--accent-success);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: modalFadeIn 0.3s;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.2s;
            background: none;
            border: none;
        }

        .modal-close:hover { color: var(--text-primary); }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideIn 0.3s, slideOut 0.3s 2.7s;
            animation-fill-mode: forwards;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        @keyframes slideOut {
            from { transform: translateX(0); }
            to { transform: translateX(100%); }
        }

        .notification.success {
            background-color: var(--accent-success);
        }

        .notification.error {
            background-color: var(--accent-danger);
        }

        .notification.warning {
            background-color: var(--accent-warning);
        }

        .notification.info {
            background-color: var(--accent-primary);
        }

        .footer {
            text-align: center;
            padding: 1rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
            border-top: 1px solid var(--border-color);
        }

        /* Table Selection Styles */
        .table-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1.5rem;
        }

        .table-card {
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .table-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(16, 185, 129, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .table-card:hover::before {
            opacity: 1;
        }

        .table-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-primary);
        }

        .table-card.available {
            border-color: var(--accent-success);
        }

        .table-card.occupied {
            border-color: var(--accent-danger);
            opacity: 0.8;
        }

        .table-icon {
            font-size: 3rem;
            color: var(--accent-primary);
            margin-bottom: 1rem;
        }

        .table-number {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .table-status {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .table-capacity {
            font-size: 0.875rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        /* Menu Image Upload Styles */
        .menu-image-container {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            background-color: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
        }

        .menu-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .menu-image-placeholder {
            color: var(--text-light);
            font-size: 2rem;
        }

        .menu-item-with-image {
            display: flex;
            align-items: center;
        }

        .menu-item-info {
            flex-grow: 1;
        }

        /* Inventory Management Styles */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .inventory-item-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.2s;
        }

        .inventory-item-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .inventory-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .inventory-item-name {
            font-weight: 600;
            font-size: 1.125rem;
        }

        .inventory-item-quantity {
            background-color: var(--bg-tertiary);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .inventory-item-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .status-good {
            background-color: var(--accent-success);
        }

        .status-low {
            background-color: var(--accent-warning);
        }

        .status-out {
            background-color: var(--accent-danger);
        }

        .inventory-item-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Asset Management Styles */
        .asset-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .asset-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.2s;
        }

        .asset-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .asset-image {
            width: 100%;
            height: 150px;
            border-radius: 8px;
            object-fit: cover;
            margin-bottom: 1rem;
        }

        .asset-name {
            font-weight: 600;
            font-size: 1.125rem;
            margin-bottom: 0.5rem;
        }

        .asset-category {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background-color: var(--bg-tertiary);
            border-radius: 20px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .asset-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .asset-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Financial Management Styles */
        .financial-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .financial-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.2s;
        }

        .financial-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .financial-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .financial-card-title {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .financial-card-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .financial-card-change {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .financial-card-change.positive {
            color: var(--accent-success);
        }

        .financial-card-change.negative {
            color: var(--accent-danger);
        }

        /* Payroll Management Styles */
        .payroll-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .payroll-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.2s;
        }

        .payroll-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .payroll-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .payroll-name {
            font-weight: 600;
            font-size: 1.125rem;
        }

        .payroll-role {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .payroll-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .payroll-detail {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .payroll-detail strong {
            color: var(--text-primary);
        }

        .payroll-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Shift Management Styles */
        .shift-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .shift-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.2s;
        }

        .shift-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .shift-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .shift-name {
            font-weight: 600;
            font-size: 1.125rem;
        }

        .shift-time {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .shift-employees {
            margin-bottom: 1rem;
        }

        .shift-employee {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0;
        }

        .shift-employee-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: var(--accent-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .shift-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Branch Management Styles */
        .branch-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .branch-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.2s;
        }

        .branch-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .branch-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .branch-name {
            font-weight: 600;
            font-size: 1.125rem;
        }

        .branch-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .branch-status.active {
            background-color: rgba(16, 185, 129, 0.2);
            color: var(--accent-success);
        }

        .branch-status.inactive {
            background-color: rgba(239, 68, 68, 0.2);
            color: var(--accent-danger);
        }

        .branch-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .branch-detail {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .branch-detail strong {
            color: var(--text-primary);
        }

        .branch-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Low Stock Alert Styles */
        .low-stock-alert {
            background-color: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--accent-warning);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .low-stock-alert-icon {
            color: var(--accent-warning);
            font-size: 1.5rem;
        }

        .low-stock-alert-content {
            flex-grow: 1;
        }

        .low-stock-alert-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .low-stock-alert-text {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Notification Toast Styles */
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: var(--shadow-lg);
            z-index: 4000;
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 300px;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .notification-toast-icon {
            font-size: 1.5rem;
        }

        .notification-toast-content {
            flex-grow: 1;
        }

        .notification-toast-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .notification-toast-message {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .notification-toast-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.25rem;
        }

        .notification-toast-close:hover {
            color: var(--text-primary);
        }

        /* Chart Container Styles */
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 1rem;
        }

        /* Category Tabs Styles */
        .category-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .category-tab {
            padding: 0.75rem 1rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
        }

        .category-tab:hover {
            color: var(--accent-primary);
        }

        .category-tab.active {
            color: var(--accent-primary);
            border-bottom-color: var(--accent-primary);
        }

        /* Chatbox Styles */
        .chatbox {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 450px;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            z-index: 1500;
            display: flex;
            flex-direction: column;
            transform: translateY(calc(100% - 60px));
            transition: transform 0.3s ease;
        }

        .chatbox.open {
            transform: translateY(0);
        }

        .chatbox-header {
            padding: 1rem;
            background-color: var(--accent-primary);
            color: white;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .chatbox-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chatbox-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.25rem;
        }

        .chatbox-body {
            flex-grow: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .chat-message {
            max-width: 80%;
            padding: 0.75rem;
            border-radius: 12px;
            word-wrap: break-word;
        }

        .chat-message.user {
            align-self: flex-end;
            background-color: var(--accent-primary);
            color: white;
        }

        .chat-message.bot {
            align-self: flex-start;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .chatbox-input {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 0.5rem;
        }

        .chatbox-input input {
            flex-grow: 1;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            outline: none;
        }

        .chatbox-input button {
            background-color: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* Reservation Styles */
        .reservation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .reservation-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.2s;
        }

        .reservation-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .reservation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .reservation-id {
            font-weight: 600;
            font-size: 1.125rem;
        }

        .reservation-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .reservation-status.confirmed {
            background-color: rgba(16, 185, 129, 0.2);
            color: var(--accent-success);
        }

        .reservation-status.pending {
            background-color: rgba(245, 158, 11, 0.2);
            color: var(--accent-warning);
        }

        .reservation-status.cancelled {
            background-color: rgba(239, 68, 68, 0.2);
            color: var(--accent-danger);
        }

        .reservation-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .reservation-detail {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .reservation-detail strong {
            color: var(--text-primary);
        }

        .reservation-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Print Styles */
        .print-receipt {
            width: 300px;
            padding: 20px;
            font-family: monospace;
            background-color: white;
            color: black;
        }

        .print-receipt-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .print-receipt-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .print-receipt-subtitle {
            font-size: 12px;
            margin-bottom: 10px;
        }

        .print-receipt-details {
            margin-bottom: 20px;
        }

        .print-receipt-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .print-receipt-divider {
            border-top: 1px dashed black;
            margin: 10px 0;
        }

        .print-receipt-total {
            font-weight: bold;
            margin-top: 10px;
        }

        .print-receipt-footer {
            text-align: center;
            margin-top: 20px;
            font-size: 12px;
        }

        /* Settings Styles */
        .settings-section {
            margin-bottom: 2rem;
        }

        .settings-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 500px;
        }

        .settings-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        /* Stock Opname Styles */
        .stock-opname-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .stock-opname-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.2s;
        }

        .stock-opname-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .stock-opname-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stock-opname-name {
            font-weight: 600;
            font-size: 1.125rem;
        }

        .stock-opname-category {
            padding: 0.25rem 0.75rem;
            background-color: var(--bg-tertiary);
            border-radius: 20px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .stock-opname-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .stock-opname-detail {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
        }

        .stock-opname-detail-label {
            color: var(--text-secondary);
        }

        .stock-opname-detail-value {
            font-weight: 500;
        }

        .stock-opname-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .stock-opname-status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .stock-opname-status-indicator.good {
            background-color: var(--accent-success);
        }

        .stock-opname-status-indicator.low {
            background-color: var(--accent-warning);
        }

        .stock-opname-status-indicator.out {
            background-color: var(--accent-danger);
        }

        .stock-opname-actions {
            display: flex;
            gap: 0.5rem;
        }

        .stock-opname-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .stock-opname-form-row {
            display: flex;
            gap: 1rem;
        }

        .stock-opname-form-row .form-group {
            flex: 1;
        }

        /* Professional Stock Opname Styles */
        .stock-opname-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
        }

        .stock-opname-table th, .stock-opname-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .stock-opname-table th {
            background-color: var(--bg-tertiary);
            font-weight: 600;
        }

        .stock-opname-table tr:hover {
            background-color: rgba(59, 130, 246, 0.05);
        }

        .stock-opname-summary {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: var(--bg-tertiary);
            border-radius: 8px;
        }

        .stock-opname-summary-item {
            text-align: center;
        }

        .stock-opname-summary-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .stock-opname-summary-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Professional Payroll Styles */
        .payroll-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
        }

        .payroll-table th, .payroll-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .payroll-table th {
            background-color: var(--bg-tertiary);
            font-weight: 600;
        }

        .payroll-table tr:hover {
            background-color: rgba(59, 130, 246, 0.05);
        }

        .payroll-summary {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: var(--bg-tertiary);
            border-radius: 8px;
        }

        .payroll-summary-item {
            text-align: center;
        }

        .payroll-summary-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .payroll-summary-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Professional Shift Management Styles */
        .shift-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-top: 1.5rem;
        }

        .shift-day {
            background-color: var(--bg-tertiary);
            border-radius: 8px;
            padding: 0.5rem;
            text-align: center;
        }

        .shift-day-header {
            font-weight: 600;
            margin-bottom: 0.5rem;
            padding-bottom: 0.25rem;
            border-bottom: 1px solid var(--border-color);
        }

        .shift-day-content {
            font-size: 0.875rem;
        }

        .shift-assignment {
            margin-top: 0.25rem;
            padding: 0.25rem;
            background-color: var(--bg-secondary);
            border-radius: 4px;
        }

        /* Queue List Styles */
        .queue-list {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .queue-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.2s;
        }

        .queue-item:last-child {
            border-bottom: none;
        }

        .queue-item:hover {
            background-color: var(--bg-tertiary);
        }

        .queue-table {
            font-weight: 600;
            color: var(--accent-primary);
        }

        .queue-order {
            font-weight: 500;
        }

        .queue-time {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .queue-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .queue-status.new {
            background-color: rgba(16, 185, 129, 0.2);
            color: var(--accent-success);
        }

        .queue-status.processing {
            background-color: rgba(245, 158, 11, 0.2);
            color: var(--accent-warning);
        }

        .queue-status.ready {
            background-color: rgba(59, 130, 246, 0.2);
            color: var(--accent-primary);
        }

        /* Position Management Styles */
        .position-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .position-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .position-badge button {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0;
            margin-left: 0.25rem;
            display: flex;
            align-items: center;
        }

        .position-badge button:hover {
            color: var(--accent-danger);
        }

        /* Print Reservation Styles */
        .print-reservation {
            width: 300px;
            padding: 20px;
            font-family: monospace;
            background-color: white;
            color: black;
        }

        .print-reservation-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .print-reservation-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .print-reservation-subtitle {
            font-size: 12px;
            margin-bottom: 10px;
        }

        .print-reservation-details {
            margin-bottom: 20px;
        }

        .print-reservation-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .print-reservation-divider {
            border-top: 1px dashed black;
            margin: 10px 0;
        }

        .print-reservation-footer {
            text-align: center;
            margin-top: 20px;
            font-size: 12px;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .grid-cols-4 { grid-template-columns: repeat(3, 1fr); }
            .pos-layout { grid-template-columns: 1fr; }
            .pos-cart-container { order: -1; }
            .table-order-layout { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .grid-cols-3 { grid-template-columns: repeat(2, 1fr); }
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
            .license-actions { flex-direction: column; }
            .chatbox {
                width: 100%;
                right: 0;
                bottom: 0;
                border-radius: 12px 12px 0 0;
                height: 350px;
            }
        }

        @media (max-width: 640px) {
            .grid-cols-3, .grid-cols-2 { grid-template-columns: 1fr; }
            .kpi-grid { grid-template-columns: 1fr; }
            .content-area { padding: 1rem; }
        }
    </style>
</head>
<body>

<div class="app-container">
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1><i data-lucide="coffee"></i> E-Pos</h1>
            <div class="company-name">DNT Network Cafe</div>
        </div>
        <ul class="sidebar-menu" id="sidebarMenu">
            <li><a href="#" class="nav-link active" data-page="dashboard"><i data-lucide="layout-dashboard"></i> Dashboard</a></li>
            <li><a href="#" class="nav-link" data-page="pos"><i data-lucide="shopping-cart"></i> Kasir</a></li>
            <li>
                <a href="#" class="nav-link" data-page="kds">
                    <i data-lucide="chef-hat"></i> Dapur
                    <span class="notification-badge" id="kds-notification" style="display: none;">0</span>
                </a>
            </li>
            <li><a href="#" class="nav-link" data-page="table-order"><i data-lucide="smartphone"></i> Pesan via Meja</a></li>
            <li><a href="#" class="nav-link" data-page="reservations"><i data-lucide="calendar"></i> Reservasi</a></li>
            <li><a href="#" class="nav-link" data-page="menu-management"><i data-lucide="utensils"></i> Kelola Menu</a></li>
            <li><a href="#" class="nav-link" data-page="table-management"><i data-lucide="table"></i> Manajemen Meja</a></li>
            <li><a href="#" class="nav-link" data-page="order-history"><i data-lucide="file-text"></i> Riwayat Pesanan</a></li>
            <li><a href="#" class="nav-link" data-page="user-management"><i data-lucide="users"></i> Kelola Pengguna</a></li>
            <li><a href="#" class="nav-link" data-page="stock-opname"><i data-lucide="package"></i> Stock Opname</a></li>
            <li><a href="#" class="nav-link" data-page="asset"><i data-lucide="briefcase"></i> Manajemen Aset</a></li>
            <li><a href="#" class="nav-link" data-page="financial"><i data-lucide="dollar-sign"></i> Keuangan</a></li>
            <li><a href="#" class="nav-link" data-page="payroll"><i data-lucide="credit-card"></i> Penggajian</a></li>
            <li><a href="#" class="nav-link" data-page="shift"><i data-lucide="calendar"></i> Shift</a></li>
            <li><a href="#" class="nav-link" data-page="branch"><i data-lucide="map-pin"></i> Multi Cabang</a></li>
            <li><a href="#" class="nav-link" data-page="license"><i data-lucide="crown"></i> Lisensi</a></li>
            <li><a href="#" class="nav-link" data-page="settings"><i data-lucide="settings"></i> Pengaturan</a></li>
        </ul>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <!-- TOPBAR -->
        <header class="topbar">
            <div class="topbar-title" id="topbarTitle">Dashboard</div>
            <div class="topbar-actions">
                <div class="user-dropdown">
                    <div class="user-info" onclick="toggleUserDropdown()">
                        <div class="user-avatar" id="userAvatar">A</div>
                        <span id="userName">Admin</span>
                        <span class="subscription-status status-trial" id="subscriptionStatus">Trial</span>
                        <i data-lucide="chevron-down" style="width: 16px; height: 16px;"></i>
                    </div>
                    <div class="user-dropdown-menu" id="userDropdownMenu">
                        <div class="user-dropdown-item active" onclick="switchUser(1)">
                            <i data-lucide="shield"></i>
                            <span>Admin</span>
                        </div>
                        <div class="user-dropdown-item" onclick="switchUser(2)">
                            <i data-lucide="crown"></i>
                            <span>Owner</span>
                        </div>
                        <div class="user-dropdown-item" onclick="switchUser(3)">
                            <i data-lucide="shopping-cart"></i>
                            <span>Kasir</span>
                        </div>
                        <div class="user-dropdown-item" onclick="switchUser(4)">
                            <i data-lucide="chef-hat"></i>
                            <span>Dapur</span>
                        </div>
                        <div class="user-dropdown-item" onclick="switchUser(5)">
                            <i data-lucide="user"></i>
                            <span>Pelanggan</span>
                        </div>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="toggleSidebar()"><i data-lucide="menu"></i></button>
            </div>
        </header>

        <!-- CONTENT AREA -->
        <div class="content-area" id="contentArea">
            <!-- DASHBOARD PAGE -->
            <div class="page active" id="dashboard-page">
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <p id="kpi-revenue">Rp 0</p>
                        <h3>Penjualan Hari Ini</h3>
                    </div>
                    <div class="kpi-card">
                        <p id="kpi-orders">0</p>
                        <h3>Total Pesanan</h3>
                    </div>
                    <div class="kpi-card">
                        <p id="kpi-active">0</p>
                        <h3>Pesanan Aktif</h3>
                    </div>
                    <div class="kpi-card">
                        <p id="kpi-items">0</p>
                        <h3>Item Terjual</h3>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">Pesanan Terbaru</div>
                    <div id="recent-orders-list"></div>
                </div>
            </div>

            <!-- POS PAGE -->
            <div class="page" id="pos-page">
                <div class="pos-layout">
                    <div class="pos-menu-container card">
                        <div class="card-header">
                            <span>Menu</span>
                            <select id="pos-table-select" class="form-group" style="width: 150px; margin:0;">
                                <option value="0">Take Away</option>
                                <option value="1">Meja 1</option>
                                <option value="2">Meja 2</option>
                                <option value="3">Meja 3</option>
                                <option value="4">Meja 4</option>
                                <option value="5">Meja 5</option>
                                <option value="6">Meja 6</option>
                            </select>
                        </div>
                        <div class="pos-categories" id="pos-categories"></div>
                        <div class="pos-menu-grid" id="pos-menu-grid"></div>
                    </div>
                    <div class="pos-cart-container card">
                        <div class="card-header">
                            <span>Keranjang</span>
                            <button class="btn btn-danger" onclick="clearCurrentOrder()">Batal</button>
                        </div>
                        <div class="pos-cart" id="pos-cart"></div>
                        <div class="pos-summary">
                            <div class="pos-summary-row"><span>Subtotal</span><span id="pos-subtotal">Rp 0</span></div>
                            <div class="pos-summary-row"><span>Pajak (10%)</span><span id="pos-tax">Rp 0</span></div>
                            <div class="pos-summary-row total"><span>Total</span><span id="pos-total">Rp 0</span></div>
                            <button class="btn btn-primary" style="width: 100%; margin-top: 1rem;" onclick="openPaymentModal()">Bayar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- KDS PAGE -->
            <div class="page" id="kds-page">
                <div class="card-header">Daftar Pesanan Dapur</div>
                <div style="margin-bottom: 1rem;">
                    <button class="btn btn-warning" onclick="openStockUpdateModal()">
                        <i data-lucide="alert-triangle"></i> Update Stok Menu Habis
                    </button>
                </div>
                <div class="kds-grid" id="kds-orders-grid"></div>
            </div>

            <!-- TABLE ORDER PAGE -->
            <div class="page" id="table-order-page">
                <div class="table-order-layout">
                    <div>
                        <div class="card">
                            <div class="card-header">
                                <span>Pesan di Meja</span>
                                <select id="table-order-select" class="form-group" style="width: 150px;" onchange="updateTableOrder()">
                                    <option value="1">Meja 1</option>
                                    <option value="2">Meja 2</option>
                                    <option value="3">Meja 3</option>
                                    <option value="4">Meja 4</option>
                                    <option value="5">Meja 5</option>
                                    <option value="6">Meja 6</option>
                                </select>
                            </div>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">Pelanggan memindai QR Code di meja dan melihat menu ini.</p>
                            <div class="pos-categories" id="table-categories"></div>
                            <div class="pos-menu-grid" id="table-menu-grid"></div>
                        </div>
                        
                        <!-- Queue List -->
                        <div class="queue-list">
                            <div class="card-header">Antrean Pesanan</div>
                            <div id="queue-list"></div>
                        </div>
                        
                        <!-- Daftar Pesanan untuk Meja Ini -->
                        <div class="table-orders-section">
                            <div class="card-header">Pesanan Aktif Meja <span id="current-table-number">1</span></div>
                            <div id="table-active-orders"></div>
                        </div>
                    </div>
                    
                    <div class="pos-cart-container card">
                        <div class="card-header">
                            <span>Keranjang Meja <span id="cart-table-number">1</span></span>
                        </div>
                        <div class="pos-cart" id="table-cart"></div>
                        <div class="pos-summary">
                            <div class="pos-summary-row total"><span>Total</span><span id="table-total">Rp 0</span></div>
                            <button class="btn btn-primary" style="width: 100%; margin-top: 1rem;" onclick="submitTableOrder()">Kirim Pesanan ke Dapur</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RESERVATIONS PAGE -->
            <div class="page" id="reservations-page">
                <div class="card">
                    <div class="card-header">
                        <span>Reservasi Meja</span>
                        <button class="btn btn-primary" onclick="openReservationModal()">Tambah Reservasi</button>
                    </div>
                    <div class="history-filters">
                        <div class="form-group" style="width: 200px;">
                            <label>Dari Tanggal</label>
                            <input type="date" id="filter-reservation-date-from">
                        </div>
                        <div class="form-group" style="width: 200px;">
                            <label>Sampai Tanggal</label>
                            <input type="date" id="filter-reservation-date-to">
                        </div>
                        <div class="form-group" style="width: 150px;">
                            <label>&nbsp;</label>
                            <button class="btn btn-primary" onclick="filterReservations()">Filter</button>
                        </div>
                    </div>
                    <div class="reservation-grid" id="reservation-grid"></div>
                </div>
            </div>

            <!-- MENU MANAGEMENT PAGE -->
            <div class="page" id="menu-management-page">
                <div class="card">
                    <div class="card-header">
                        <span>Kelola Menu</span>
                        <button class="btn btn-primary" onclick="openMenuModal()">Tambah Menu</button>
                    </div>
                    <div id="menu-list"></div>
                </div>
            </div>

            <!-- TABLE MANAGEMENT PAGE -->
            <div class="page" id="table-management-page">
                <div class="card">
                    <div class="card-header">
                        <span>Manajemen Meja</span>
                    </div>
                    <div class="table-management-grid" id="table-management-grid"></div>
                </div>
            </div>

            <!-- ORDER HISTORY PAGE -->
            <div class="page" id="order-history-page">
                <div class="card">
                    <div class="card-header">
                        <span>Riwayat Pesanan</span>
                        <button class="btn btn-secondary" onclick="exportOrderHistory()">Export Data</button>
                    </div>
                    <div class="history-filters">
                        <div class="form-group" style="width: 200px;">
                            <label>Dari Tanggal</label>
                            <input type="date" id="filter-date-from">
                        </div>
                        <div class="form-group" style="width: 200px;">
                            <label>Sampai Tanggal</label>
                            <input type="date" id="filter-date-to">
                        </div>
                        <div class="form-group" style="width: 150px;">
                            <label>&nbsp;</label>
                            <button class="btn btn-primary" onclick="filterOrderHistory()">Filter</button>
                        </div>
                    </div>
                    
                    <!-- Sales Chart -->
                    <div class="card" style="margin-top: 1.5rem;">
                        <div class="card-header">Grafik Penjualan</div>
                        <div class="chart-container">
                            <canvas id="sales-chart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Best Selling Items -->
                    <div class="card" style="margin-top: 1.5rem;">
                        <div class="card-header">Menu Terlaris</div>
                        <div id="best-selling-items"></div>
                    </div>
                    
                    <div class="table-container">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>ID Pesanan</th>
                                    <th>Tanggal</th>
                                    <th>Meja</th>
                                    <th>Tipe</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="history-table-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- USER MANAGEMENT PAGE -->
            <div class="page" id="user-management-page">
                <div class="card">
                    <div class="card-header">
                        <span>Kelola Pengguna</span>
                        <button class="btn btn-primary" onclick="openUserModal()">Tambah Pengguna</button>
                    </div>
                    <div id="user-list"></div>
                </div>
                
                <!-- Position Management -->
                <div class="card" style="margin-top: 1.5rem;">
                    <div class="card-header">Manajemen Posisi Karyawan</div>
                    <div class="position-list" id="position-list"></div>
                    <div class="form-group">
                        <label>Tambah Posisi Baru</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="text" id="new-position" placeholder="Nama posisi" style="flex-grow: 1;">
                            <button class="btn btn-primary" onclick="addPosition()">Tambah</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STOCK OPNAME PAGE -->
            <div class="page" id="stock-opname-page">
                <div class="card">
                    <div class="card-header">
                        <span>Stock Opname</span>
                        <button class="btn btn-primary" onclick="openStockOpnameModal()">Tambah Barang</button>
                    </div>
                    
                    <!-- Low Stock Alert -->
                    <div id="low-stock-alerts"></div>
                    
                    <!-- Category Tabs -->
                    <div class="category-tabs" id="stock-opname-category-tabs">
                        <button class="category-tab active" onclick="filterStockOpnameByCategory('all', this)">Semua</button>
                        <button class="category-tab" onclick="filterStockOpnameByCategory('Makanan', this)">Makanan</button>
                        <button class="category-tab" onclick="filterStockOpnameByCategory('Minuman', this)">Minuman</button>
                        <button class="category-tab" onclick="filterStockOpnameByCategory('Bahan Baku', this)">Bahan Baku</button>
                        <button class="category-tab" onclick="filterStockOpnameByCategory('Peralatan', this)">Peralatan</button>
                    </div>
                    
                    <!-- Professional Stock Opname Table -->
                    <div class="card" style="margin-top: 1.5rem;">
                        <div class="card-header">Tabel Stok Barang</div>
                        <table class="stock-opname-table">
                            <thead>
                                <tr>
                                    <th>Kode</th>
                                    <th>Nama Barang</th>
                                    <th>Kategori</th>
                                    <th>Stok Saat Ini</th>
                                    <th>Satuan</th>
                                    <th>Stok Minimum</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="stock-opname-table-body">
                            </tbody>
                        </table>
                        
                        <!-- Stock Summary -->
                        <div class="stock-opname-summary">
                            <div class="stock-opname-summary-item">
                                <div class="stock-opname-summary-value" id="total-items">0</div>
                                <div class="stock-opname-summary-label">Total Item</div>
                            </div>
                            <div class="stock-opname-summary-item">
                                <div class="stock-opname-summary-value" id="good-stock">0</div>
                                <div class="stock-opname-summary-label">Stok Aman</div>
                            </div>
                            <div class="stock-opname-summary-item">
                                <div class="stock-opname-summary-value" id="low-stock">0</div>
                                <div class="stock-opname-summary-label">Stok Rendah</div>
                            </div>
                            <div class="stock-opname-summary-item">
                                <div class="stock-opname-summary-value" id="out-stock">0</div>
                                <div class="stock-opname-summary-label">Stok Habis</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stock-opname-grid" id="stock-opname-grid"></div>
                </div>
            </div>

            <!-- ASSET PAGE -->
            <div class="page" id="asset-page">
                <div class="card">
                    <div class="card-header">
                        <span>Manajemen Aset Perusahaan</span>
                        <button class="btn btn-primary" onclick="openAssetModal()">Tambah Aset</button>
                    </div>
                    
                    <!-- Category Tabs -->
                    <div class="category-tabs" id="asset-category-tabs">
                        <button class="category-tab active" onclick="filterAssetsByCategory('all', this)">Semua</button>
                        <button class="category-tab" onclick="filterAssetsByCategory('Peralatan Dapur', this)">Peralatan Dapur</button>
                        <button class="category-tab" onclick="filterAssetsByCategory('Furniture', this)">Furniture</button>
                        <button class="category-tab" onclick="filterAssetsByCategory('Elektronik', this)">Elektronik</button>
                        <button class="category-tab" onclick="filterAssetsByCategory('Kendaraan', this)">Kendaraan</button>
                        <button class="category-tab" onclick="filterAssetsByCategory('Lainnya', this)">Lainnya</button>
                    </div>
                    
                    <div class="asset-grid" id="asset-grid"></div>
                </div>
            </div>

            <!-- FINANCIAL PAGE -->
            <div class="page" id="financial-page">
                <div class="financial-summary">
                    <div class="financial-card">
                        <div class="financial-card-header">
                            <div class="financial-card-title">Pendapatan Bulan Ini</div>
                            <i data-lucide="trending-up" style="color: var(--accent-success);"></i>
                        </div>
                        <div class="financial-card-value" id="monthly-revenue">Rp 0</div>
                        <div class="financial-card-change positive">
                            <i data-lucide="arrow-up"></i>
                            <span>0% dari bulan lalu</span>
                        </div>
                    </div>
                    <div class="financial-card">
                        <div class="financial-card-header">
                            <div class="financial-card-title">Pengeluaran Bulan Ini</div>
                            <i data-lucide="trending-down" style="color: var(--accent-danger);"></i>
                        </div>
                        <div class="financial-card-value" id="monthly-expenses">Rp 0</div>
                        <div class="financial-card-change negative">
                            <i data-lucide="arrow-up"></i>
                            <span>0% dari bulan lalu</span>
                        </div>
                    </div>
                    <div class="financial-card">
                        <div class="financial-card-header">
                            <div class="financial-card-title">Laba Bersih</div>
                            <i data-lucide="dollar-sign" style="color: var(--accent-primary);"></i>
                        </div>
                        <div class="financial-card-value" id="net-profit">Rp 0</div>
                        <div class="financial-card-change positive">
                            <i data-lucide="arrow-up"></i>
                            <span>0% dari bulan lalu</span>
                        </div>
                    </div>
                    <div class="financial-card">
                        <div class="financial-card-header">
                            <div class="financial-card-title">Total Transaksi</div>
                            <i data-lucide="receipt" style="color: var(--accent-secondary);"></i>
                        </div>
                        <div class="financial-card-value" id="total-transactions">0</div>
                        <div class="financial-card-change positive">
                            <i data-lucide="arrow-up"></i>
                            <span>0% dari bulan lalu</span>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-2">
                    <div class="card">
                        <div class="card-header">Laporan Keuangan</div>
                        <div class="chart-container">
                            <canvas id="financial-chart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">Kategori Pengeluaran</div>
                        <div class="chart-container">
                            <canvas id="expense-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <span>Transaksi Terbaru</span>
                        <button class="btn btn-primary" onclick="openTransactionModal()">Tambah Transaksi</button>
                    </div>
                    <div id="transaction-list"></div>
                </div>
            </div>

            <!-- PAYROLL PAGE -->
            <div class="page" id="payroll-page">
                <div class="card">
                    <div class="card-header">
                        <span>Manajemen Penggajian</span>
                        <button class="btn btn-primary" onclick="openPayrollModal()">Tambah Gaji</button>
                    </div>
                    
                    <!-- Professional Payroll Table -->
                    <div class="card" style="margin-top: 1.5rem;">
                        <div class="card-header">Tabel Gaji Karyawan</div>
                        <table class="payroll-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nama Karyawan</th>
                                    <th>Posisi</th>
                                    <th>Periode</th>
                                    <th>Gaji Pokok</th>
                                    <th>Tunjangan</th>
                                    <th>Potongan</th>
                                    <th>Total Gaji</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="payroll-table-body">
                            </tbody>
                        </table>
                        
                        <!-- Payroll Summary -->
                        <div class="payroll-summary">
                            <div class="payroll-summary-item">
                                <div class="payroll-summary-value" id="total-payroll">Rp 0</div>
                                <div class="payroll-summary-label">Total Gaji</div>
                            </div>
                            <div class="payroll-summary-item">
                                <div class="payroll-summary-value" id="avg-payroll">Rp 0</div>
                                <div class="payroll-summary-label">Rata-rata Gaji</div>
                            </div>
                            <div class="payroll-summary-item">
                                <div class="payroll-summary-value" id="highest-payroll">Rp 0</div>
                                <div class="payroll-summary-label">Gaji Tertinggi</div>
                            </div>
                            <div class="payroll-summary-item">
                                <div class="payroll-summary-value" id="lowest-payroll">Rp 0</div>
                                <div class="payroll-summary-label">Gaji Terendah</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="payroll-grid" id="payroll-grid"></div>
                </div>
            </div>

            <!-- SHIFT PAGE -->
            <div class="page" id="shift-page">
                <div class="card">
                    <div class="card-header">
                        <span>Manajemen Shift</span>
                        <button class="btn btn-primary" onclick="openShiftModal()">Tambah Shift</button>
                    </div>
                    
                    <!-- Professional Shift Calendar -->
                    <div class="card" style="margin-top: 1.5rem;">
                        <div class="card-header">Kalender Shift</div>
                        <div class="shift-calendar" id="shift-calendar">
                            <!-- Calendar will be generated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="shift-grid" id="shift-grid"></div>
                </div>
            </div>

            <!-- BRANCH PAGE -->
            <div class="page" id="branch-page">
                <div class="card">
                    <div class="card-header">
                        <span>Manajemen Multi Cabang</span>
                        <button class="btn btn-primary" onclick="openBranchModal()">Tambah Cabang</button>
                    </div>
                    <div class="branch-grid" id="branch-grid"></div>
                </div>
            </div>

            <!-- LICENSE PAGE -->
            <div class="page" id="license-page">
                <div class="license-card">
                    <div class="card-header" style="border-bottom: 1px solid rgba(255,255,255,0.3); color: white;">
                        <span>Status Lisensi</span>
                        <span class="subscription-status status-trial">TRIAL</span>
                    </div>
                    <div class="license-info-grid">
                        <div class="license-info-item">
                            <h4>Paket</h4>
                            <p id="license-plan">Trial</p>
                        </div>
                        <div class="license-info-item">
                            <h4>Berlaku Hingga</h4>
                            <p id="license-expiry">-</p>
                        </div>
                        <div class="license-info-item">
                            <h4>Sisa Hari</h4>
                            <p id="license-days-left">7 Hari</p>
                        </div>
                        <div class="license-info-item">
                            <h4>Maksimal Pengguna</h4>
                            <p id="license-max-users">3 Users</p>
                        </div>
                    </div>
                    <div class="license-actions">
                        <button class="btn btn-primary" onclick="openUpgradeModal()">
                            <i data-lucide="crown"></i> Upgrade Paket
                        </button>
                        <button class="btn btn-secondary" onclick="showLicenseKey()">
                            <i data-lucide="key"></i> Lihat Kunci Lisensi
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Aktivasi Lisensi</div>
                    <div class="form-group">
                        <label>Masukkan Kode Lisensi</label>
                        <input type="text" id="license-activation-input" placeholder="Masukkan kode lisensi Anda">
                    </div>
                    <button class="btn btn-primary" onclick="activateLicense()">Aktivasi</button>
                </div>

                <div class="card">
                    <div class="card-header">Statistik Penggunaan</div>
                    <div class="license-info-grid">
                        <div class="license-info-item" style="background: var(--bg-tertiary);">
                            <h4>Pengguna Aktif</h4>
                            <p id="active-users-count">1/3</p>
                        </div>
                        <div class="license-info-item" style="background: var(--bg-tertiary);">
                            <h4>Meja Terpakai</h4>
                            <p id="used-tables-count">3/6</p>
                        </div>
                        <div class="license-info-item" style="background: var(--bg-tertiary);">
                            <h4>Pesanan Bulan Ini</h4>
                            <p id="monthly-orders">0</p>
                        </div>
                        <div class="license-info-item" style="background: var(--bg-tertiary);">
                            <h4>Pendapatan Bulan Ini</h4>
                            <p id="monthly-revenue">Rp 0</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Riwayat Transaksi</div>
                    <div class="transaction-history" id="transaction-history">
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Paket Langganan</div>
                    <div class="grid grid-cols-3" id="subscription-plans">
                    </div>
                </div>
            </div>

            <!-- SETTINGS PAGE -->
            <div class="page" id="settings-page">
                <div class="card">
                    <div class="card-header">Pengaturan Profil</div>
                    <div class="settings-section">
                        <div class="settings-title">Informasi Akun</div>
                        <div class="settings-form">
                            <div class="form-group">
                                <label>Nama</label>
                                <input type="text" id="settings-name" value="Admin">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="settings-email" value="admin@restaurant.com">
                            </div>
                            <div class="form-group">
                                <label>Peran</label>
                                <select id="settings-role">
                                    <option value="admin" selected>Admin</option>
                                    <option value="owner">Owner</option>
                                    <option value="cashier">Kasir</option>
                                    <option value="kitchen">Dapur</option>
                                </select>
                            </div>
                            <div class="settings-actions">
                                <button class="btn btn-primary" onclick="updateProfile()">Simpan Perubahan</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <div class="settings-title">Ubah Password</div>
                        <div class="settings-form">
                            <div class="form-group">
                                <label>Password Lama</label>
                                <input type="password" id="settings-old-password">
                            </div>
                            <div class="form-group">
                                <label>Password Baru</label>
                                <input type="password" id="settings-new-password">
                            </div>
                            <div class="form-group">
                                <label>Konfirmasi Password Baru</label>
                                <input type="password" id="settings-confirm-password">
                            </div>
                            <div class="settings-actions">
                                <button class="btn btn-primary" onclick="changePassword()">Ubah Password</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <footer class="footer">
            © 2025 DNT Network - E-Pos System
        </footer>
    </main>
</div>

<!-- CHATBOX -->
<div class="chatbox" id="chatbox">
    <div class="chatbox-header" onclick="toggleChatbox()">
        <div class="chatbox-title">
            <i data-lucide="message-circle"></i>
            <span>Customer Service</span>
        </div>
        <button class="chatbox-close">
            <i data-lucide="minimize-2"></i>
        </button>
    </div>
    <div class="chatbox-body" id="chatbox-body">
        <div class="chat-message bot">
            Halo! Saya adalah asisten AI untuk membantu Anda. Ada yang bisa saya bantu?
        </div>
    </div>
    <div class="chatbox-input">
        <input type="text" id="chatbox-input" placeholder="Ketik pesan..." onkeypress="handleChatInputKeypress(event)">
        <button onclick="sendMessage()">
            <i data-lucide="send"></i>
        </button>
    </div>
</div>

<!-- PAYMENT MODAL -->
<div class="modal" id="payment-modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('payment-modal')">&times;</span>
        <h2>Pembayaran</h2>
        <div class="pos-summary">
            <div class="pos-summary-row"><span>Subtotal</span><span id="modal-subtotal">Rp 0</span></div>
            <div class="pos-summary-row"><span>Pajak (10%)</span><span id="modal-tax">Rp 0</span></div>
            <div class="pos-summary-row total"><span>Total</span><span id="modal-total">Rp 0</span></div>
        </div>
        <div class="form-group">
            <label>Metode Pembayaran</label>
            <select id="payment-method">
                <option value="Tunai">Tunai</option>
                <option value="QRIS">QRIS</option>
                <option value="Transfer">Transfer Bank</option>
            </select>
        </div>
        <div class="form-group">
            <label>Uang Dibayar (untuk Tunai)</label>
            <input type="number" id="payment-amount" placeholder="0">
        </div>
        <div class="pos-summary-row total"><span>Kembalian</span><span id="payment-change">Rp 0</span></div>
        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
            <button class="btn btn-primary" style="flex-grow: 1;" onclick="processPayment()">Proses Pembayaran</button>
            <button class="btn btn-secondary" onclick="printReceipt()" id="print-receipt-btn" style="display: none;">
                <i data-lucide="printer"></i> Cetak Struk
            </button>
        </div>
    </div>
</div>

<!-- MENU MODAL -->
<div class="modal" id="menu-modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('menu-modal')">&times;</span>
        <h2 id="menu-modal-title">Tambah Menu</h2>
        <form id="menu-form" onsubmit="saveMenuItem(event)">
            <input type="hidden" id="menu-id">
            <div class="form-group">
                <label>Nama Menu</label>
                <input type="text" id="menu-name" required>
            </div>
            <div class="form-group">
                <label>Kategori</label>
                <select id="menu-category" required>
                    <option value="Makanan">Makanan</option>
                    <option value="Minuman">Minuman</option>
                    <option value="Paket">Paket</option>
                </select>
            </div>
            <div class="form-group">
                <label>Harga</label>
                <input type="number" id="menu-price" required>
            </div>
            <div class="form-group">
                <label>Deskripsi</label>
                <textarea id="menu-description" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>Foto Menu</label>
                <input type="file" id="menu-image" accept="image/*">
                <div id="menu-image-preview" style="margin-top: 0.5rem;"></div>
            </div>
            <div class="form-group">
                <label>Bahan yang Diperlukan</label>
                <div id="menu-ingredients-list"></div>
                <button type="button" class="btn btn-secondary" onclick="addMenuIngredientField()">Tambah Bahan</button>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Simpan</button>
        </form>
    </div>
</div>

<!-- USER MODAL -->
<div class="modal" id="user-modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('user-modal')">&times;</span>
        <h2 id="user-modal-title">Tambah Pengguna</h2>
        <form id="user-form" onsubmit="saveUser(event)">
            <input type="hidden" id="user-id">
            <div class="form-group">
                <label>Nama</label>
                <input type="text" id="user-name-input" required>
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="user-email" required>
            </div>
            <div class="form-group">
                <label>Peran</label>
                <select id="user-role" required>
                    <option value="admin">Admin</option>
                    <option value="owner">Owner</option>
                    <option value="cashier">Kasir</option>
                    <option value="kitchen">Dapur</option>
                </select>
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="user-password" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Simpan</button>
        </form>
    </div>
</div>

<!-- STOCK OPNAME MODAL -->
<div class="modal" id="stock-opname-modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('stock-opname-modal')">&times;</span>
        <h2 id="stock-opname-modal-title">Tambah Barang</h2>
        <form id="stock-opname-form" onsubmit="saveStockOpnameItem(event)">
            <input type="hidden" id="stock-opname-id">
            <div class="form-group">
                <label>Kode Barang</label>
                <input type="text" id="stock-opname-code" required>
            </div>
            <div class="form-group">
                <label>Nama Barang</label>
                <input type="text" id="stock-opname-name" required>
            </div>
            <div class="form-group">
                <label>Kategori</label>
                <select id="stock-opname-category" required>
                    <option value="Makanan">Makanan</option>
                    <option value="Minuman">Minuman</option>
                    <option value="Bahan Baku">Bahan Baku</option>
                    <option value="Peralatan">Peralatan</option>
                </select>
            </div>
            <div class="form-group">
                <label>Jumlah</label>
                <input type="number" id="stock-opname-quantity" required>
            </div>
            <div class="form-group">
                <label>Satuan</label>
                <input type="text" id="stock-opname-unit" placeholder="kg, liter, pcs, dll">
            </div>
            <div class="form-group">
                <label>Stok Minimum</label>
                <input type="number" id="stock-opname-min-stock" required>
            </div>
            <div class="form-group">
                <label>Harga Beli</label>
                <input type="number" id="stock-opname-price" required>
            </div>
            <div class="form-group">
                <label>Supplier</label>
                <input type="text" id="stock-opname-supplier">
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Simpan</button>
        </form>
    </div>
</div>

<!-- ASSET MODAL -->
<div class="modal" id="asset-modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('asset-modal')">&times;</span>
        <h2 id="asset-modal-title">Tambah Aset</h2>
        <form id="asset-form" onsubmit="saveAsset(event)">
            <input type="hidden" id="asset-id">
            <div class="form-group">
                <label>Nama Aset</label>
                <input type="text" id="asset-name" required>
            </div>
            <div class="form-group">
                <label>Kategori</label>
                <select id="asset-category" required>
                    <option value="Peralatan Dapur">Peralatan Dapur</option>
                    <option value="Furniture">Furniture</option>
                    <option value="Elektronik">Elektronik</option>
                    <option value="Kendaraan">Kendaraan</option>
                    <option value="Lainnya">Lainnya</option>
                </select>
            </div>
            <div class="form-group">
                <label>Jumlah</label>
                <input type="number" id="asset-quantity" required>
            </div>
            <div class="form-group">
                <label>Tanggal Pembelian</label>
                <input type="date" id="asset-purchase-date" required>
            </div>
            <div class="form-group">
                <label>Harga Pembelian</label>
                <input type="number" id="asset-price" required>
            </div>
            <div class="form-group">
                <label>Nilai Saat Ini</label>
                <input type="number" id="asset-current-value" required>
            </div>
            <div class="form-group">
                <label>Lokasi</label>
                <input type="text" id="asset-location" required>
            </div>
            <div class="form-group">
                <label>Status</label>
                <select id="asset-status" required>
                    <option value="Baik">Baik</option>
                    <option value="Rusak Ringan">Rusak Ringan</option>
                    <option value="Rusak Berat">Rusak Berat</option>
                    <option value="Dalam Perbaikan">Dalam Perbaikan</option>
                    <option value="Hilang">Hilang</option>
                </select>
            </div>
            <div class="form-group">
                <label>Jumlah Hilang</label>
                <input type="number" id="asset-lost-quantity" placeholder="0">
            </div>
            <div class="form-group">
                <label>Foto Aset</label>
                <input type="file" id="asset-image" accept="image/*">
                <div id="asset-image-preview" style="margin-top: 0.5rem;"></div>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Simpan</button>
        </form>
    </div>
</div>

<!-- STOCK UPDATE MODAL -->
<div class="modal" id="stock-update-modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('stock-update-modal')">&times;</span>
        <h2>Update Stok Menu Habis</h2>
        <div id="stock-update-list"></div>
        <button class="btn btn-primary" style="width: 100%; margin-top: 1rem;" onclick="saveStockUpdates()">Simpan Perubahan</button>
    </div>
</div>

<!-- TRANSACTION MODAL -->
<div class="modal" id="transaction-modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('transaction-modal')">&times;</span>
        <h2>Tambah Transaksi</h2>
        <form id="transaction-form" onsubmit="saveTransaction(event)">
            <div class="form-group">
                <label>Tipe Transaksi</label>
                <select id="transaction-type" required>
                    <option value="income">Pemasukan</option>
                    <option value="expense">Pengeluaran</option>
                </select>
            </div>
            <div class="form-group">
                <label>Kategori</label>
                <select id="transaction-category" required>
                    <option value="Penjualan">Penjualan</option>
                    <option value="Gaji">Gaji</option>
                    <option value="Operasional">Operasional</option>
                    <option value="Bahan Baku">Bahan Baku</option>
                    <option value="Lainnya">Lainnya</option>
                </select>
            </div>
            <div class="form-group">
                <label>Jumlah</label>
                <input type="number" id="transaction-amount" required>
            </div>
            <div class="form-group">
                <label>Deskripsi</label>
                <textarea id="transaction-description" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>Tanggal</label>
                <input type="date" id="transaction-date" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Simpan</button>
        </form>
    </div>
</div>

<!-- PAYROLL MODAL -->
<div class="modal" id="payroll-modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('payroll-modal')">&times;</span>
        <h2 id="payroll-modal-title">Tambah Gaji</h2>
        <form id="payroll-form" onsubmit="savePayroll(event)">
            <input type="hidden" id="payroll-id">
            <div class="form-group">
                <label>Karyawan</label>
                <select id="payroll-employee" required>
                    <option value="">Pilih Karyawan</option>
                </select>
            </div>
            <div class="form-group">
                <label>Periode</label>
                <input type="month" id="payroll-period" required>
            </div>
            <div class="form-group">
                <label>Gaji Pokok</label>
                <input type="number" id="payroll-base" required>
            </div>
            <div class="form-group">
                <label>Tunjangan</label>
                <input type="number" id="payroll-allowance" value="0">
            </div>
            <div class="form-group">
                <label>Potongan</label>
                <input type="number" id="payroll-deduction" value="0">
            </div>
            <div class="form-group">
                <label>Total Gaji</label>
                <input type="number" id="payroll-total" readonly>
            </div>
            <div class="form-group">
                <label>Status Pembayaran</label>
                <select id="payroll-status" required>
                    <option value="pending">Menunggu Pembayaran</option>
                    <option value="paid">Sudah Dibayar</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Simpan</button>
        </form>
    </div>
</div>

<!-- SHIFT MODAL -->
<div class="modal" id="shift-modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('shift-modal')">&times;</span>
        <h2 id="shift-modal-title">Tambah Shift</h2>
        <form id="shift-form" onsubmit="saveShift(event)">
            <input type="hidden" id="shift-id">
            <div class="form-group">
                <label>Nama Shift</label>
                <input type="text" id="shift-name" required>
            </div>
            <div class="form-group">
                <label>Jam Mulai</label>
                <input type="time" id="shift-start" required>
            </div>
            <div class="form-group">
                <label>Jam Selesai</label>
                <input type="time" id="shift-end" required>
            </div>
            <div class="form-group">
                <label>Hari</label>
                <div id="shift-days-list">
                    <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <input type="checkbox" name="shift-days" value="Senin"> Senin
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <input type="checkbox" name="shift-days" value="Selasa"> Selasa
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <input type="checkbox" name="shift-days" value="Rabu"> Rabu
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <input type="checkbox" name="shift-days" value="Kamis"> Kamis
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <input type="checkbox" name="shift-days" value="Jumat"> Jumat
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <input type="checkbox" name="shift-days" value="Sabtu"> Sabtu
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <input type="checkbox" name="shift-days" value="Minggu"> Minggu
                    </label>
                </div>
            </div>
            <div class="form-group">
                <label>Karyawan</label>
                <div id="shift-employees-list"></div>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Simpan</button>
        </form>
    </div>
</div>

<!-- BRANCH MODAL -->
<div class="modal" id="branch-modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('branch-modal')">&times;</span>
        <h2 id="branch-modal-title">Tambah Cabang</h2>
        <form id="branch-form" onsubmit="saveBranch(event)">
            <input type="hidden" id="branch-id">
            <div class="form-group">
                <label>Nama Cabang</label>
                <input type="text" id="branch-name" required>
            </div>
            <div class="form-group">
                <label>Alamat</label>
                <textarea id="branch-address" rows="3" required></textarea>
            </div>
            <div class="form-group">
                <label>Telepon</label>
                <input type="tel" id="branch-phone" required>
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="branch-email">
            </div>
            <div class="form-group">
                <label>Manager</label>
                <select id="branch-manager" required>
                    <option value="">Pilih Manager</option>
                </select>
            </div>
            <div class="form-group">
                <label>Status</label>
                <select id="branch-status" required>
                    <option value="active">Aktif</option>
                    <option value="inactive">Tidak Aktif</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Simpan</button>
        </form>
    </div>
</div>

<!-- RESERVATION MODAL -->
<div class="modal" id="reservation-modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('reservation-modal')">&times;</span>
        <h2 id="reservation-modal-title">Tambah Reservasi</h2>
        <form id="reservation-form" onsubmit="saveReservation(event)">
            <input type="hidden" id="reservation-id">
            <div class="form-group">
                <label>Nama Pemesan</label>
                <input type="text" id="reservation-name" required>
            </div>
            <div class="form-group">
                <label>Telepon</label>
                <input type="tel" id="reservation-phone" required>
            </div>
            <div class="form-group">
                <label>Tanggal Reservasi</label>
                <input type="date" id="reservation-date" required>
            </div>
            <div class="form-group">
                <label>Waktu Reservasi</label>
                <input type="time" id="reservation-time" required>
            </div>
            <div class="form-group">
                <label>Jumlah Tamu</label>
                <input type="number" id="reservation-guests" required>
            </div>
            <div class="form-group">
                <label>Meja</label>
                <select id="reservation-table" required>
                    <option value="">Pilih Meja</option>
                </select>
            </div>
            <div class="form-group">
                <label>Permintaan Khusus</label>
                <textarea id="reservation-notes" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>Status</label>
                <select id="reservation-status" required>
                    <option value="pending">Menunggu Kedatangan</option>
                    <option value="confirmed">Datang</option>
                    <option value="completed">Selesai</option>
                </select>
            </div>
            <div class="form-group">
                <label>DP (Down Payment)</label>
                <input type="number" id="reservation-dp" placeholder="0">
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button type="submit" class="btn btn-primary" style="flex-grow: 1;">Simpan</button>
                <button type="button" class="btn btn-secondary" onclick="printReservationReceipt()" style="flex-grow: 1;">
                    <i data-lucide="printer"></i> Cetak Nota
                </button>
            </div>
        </form>
    </div>
</div>

<!-- TAKE AWAY CUSTOMER MODAL -->
<div class="modal" id="takeaway-customer-modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('takeaway-customer-modal')">&times;</span>
        <h2>Informasi Pelanggan</h2>
        <div class="form-group">
            <label>Nama Pelanggan</label>
            <input type="text" id="takeaway-customer-name" placeholder="Masukkan nama pelanggan" required>
        </div>
        <div class="form-group">
            <label>Nomor Telepon (Opsional)</label>
            <input type="tel" id="takeaway-customer-phone" placeholder="Masukkan nomor telepon">
        </div>
        <button class="btn btn-primary" style="width: 100%;" onclick="proceedWithTakeaway()">Lanjutkan</button>
    </div>
</div>

<!-- LICENSE MODALS -->
<div class="modal" id="upgrade-modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('upgrade-modal')">&times;</span>
        <h2>Upgrade Paket</h2>
        <div id="upgrade-plans-container"></div>
    </div>
</div>

<div class="modal" id="license-key-modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('license-key-modal')">&times;</span>
        <h2>Kunci Lisensi</h2>
        <div class="form-group">
            <label>Kunci Lisensi Anda</label>
            <input type="text" id="license-key-display" readonly style="background-color: var(--bg-tertiary);">
        </div>
        <div class="form-group">
            <label>Tanggal Expiry</label>
            <input type="text" id="license-expiry-display" readonly style="background-color: var(--bg-tertiary);">
        </div>
        <button class="btn btn-secondary" onclick="copyLicenseKey()">
            <i data-lucide="copy"></i> Salin Kunci
        </button>
    </div>
</div>

<!-- PRINT RECEIPT (HIDDEN) -->
<div id="print-receipt" style="display: none;"></div>

<!-- PRINT RESERVATION (HIDDEN) -->
<div id="print-reservation" style="display: none;"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // --- GLOBAL STATE & INITIALIZATION ---
    const DB_KEY = 'ePosState';
    let state = {
        // License information
        license: {
            key: null,
            plan: 'trial',
            status: 'trial',
            expiryDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(), // 7 days from now
            maxUsers: 3,
            maxTables: 6,
            trialActivated: true,
            trialStartDate: new Date().toISOString()
        },
        
        menu: [
            { 
                id: 1, 
                name: 'Nasi Goreng Spesial', 
                category: 'Makanan', 
                price: 25000, 
                description: 'Nasi goreng dengan telur mata sapi, ayam suwir, dan kerupuk', 
                image: null, 
                isBestSeller: true, 
                outOfStock: false,
                ingredients: [
                    { id: 1, name: 'Beras', quantity: 0.2, unit: 'kg' },
                    { id: 2, name: 'Telur', quantity: 1, unit: 'pcs' },
                    { id: 3, name: 'Ayam', quantity: 0.1, unit: 'kg' }
                ]
            },
            { 
                id: 2, 
                name: 'Mie Ayam Bakso', 
                category: 'Makanan', 
                price: 22000, 
                description: 'Mie ayam dengan bakso sapi dan pangsit goreng', 
                image: null, 
                isBestSeller: false, 
                outOfStock: false,
                ingredients: [
                    { id: 4, name: 'Mie', quantity: 0.2, unit: 'kg' },
                    { id: 3, name: 'Ayam', quantity: 0.1, unit: 'kg' }
                ]
            },
            { 
                id: 3, 
                name: 'Ayam Bakar Madu', 
                category: 'Makanan', 
                price: 35000, 
                description: 'Ayam bakar dengan saus madu, nasi, dan lalapan', 
                image: null, 
                isBestSeller: true, 
                outOfStock: false,
                ingredients: [
                    { id: 3, name: 'Ayam', quantity: 0.3, unit: 'kg' },
                    { id: 5, name: 'Madu', quantity: 0.05, unit: 'kg' }
                ]
            },
            { 
                id: 4, 
                name: 'Es Teh Manis', 
                category: 'Minuman', 
                price: 5000, 
                description: 'Teh manis dingin dengan es batu', 
                image: null, 
                isBestSeller: false, 
                outOfStock: false,
                ingredients: [
                    { id: 6, name: 'Teh', quantity: 0.01, unit: 'kg' },
                    { id: 7, name: 'Gula', quantity: 0.03, unit: 'kg' }
                ]
            },
            { 
                id: 5, 
                name: 'Jus Alpukat', 
                category: 'Minuman', 
                price: 18000, 
                description: 'Jus alpukat segar dengan susu dan madu', 
                image: null, 
                isBestSeller: false, 
                outOfStock: false,
                ingredients: [
                    { id: 8, name: 'Alpukat', quantity: 0.2, unit: 'kg' },
                    { id: 9, name: 'Susu', quantity: 0.1, unit: 'liter' }
                ]
            },
            { 
                id: 6, 
                name: 'Es Kopi Susu', 
                category: 'Minuman', 
                price: 15000, 
                description: 'Kopi espresso dengan susu dan gula aren', 
                image: null, 
                isBestSeller: true, 
                outOfStock: false,
                ingredients: [
                    { id: 10, name: 'Kopi', quantity: 0.02, unit: 'kg' },
                    { id: 9, name: 'Susu', quantity: 0.1, unit: 'liter' },
                    { id: 7, name: 'Gula', quantity: 0.02, unit: 'kg' }
                ]
            },
            // Demo packages
            { 
                id: 7, 
                name: 'Paket Hemat 1', 
                category: 'Paket', 
                price: 35000, 
                description: 'Nasi Goreng + Es Teh Manis', 
                image: null, 
                isBestSeller: true, 
                outOfStock: false,
                ingredients: [
                    { id: 1, name: 'Beras', quantity: 0.2, unit: 'kg' },
                    { id: 2, name: 'Telur', quantity: 1, unit: 'pcs' },
                    { id: 3, name: 'Ayam', quantity: 0.1, unit: 'kg' },
                    { id: 6, name: 'Teh', quantity: 0.01, unit: 'kg' },
                    { id: 7, name: 'Gula', quantity: 0.03, unit: 'kg' }
                ]
            },
            { 
                id: 8, 
                name: 'Paket Hemat 2', 
                category: 'Paket', 
                price: 40000, 
                description: 'Mie Ayam Bakso + Es Teh Manis', 
                image: null, 
                isBestSeller: false, 
                outOfStock: false,
                ingredients: [
                    { id: 4, name: 'Mie', quantity: 0.2, unit: 'kg' },
                    { id: 3, name: 'Ayam', quantity: 0.1, unit: 'kg' },
                    { id: 6, name: 'Teh', quantity: 0.01, unit: 'kg' },
                    { id: 7, name: 'Gula', quantity: 0.03, unit: 'kg' }
                ]
            },
            { 
                id: 9, 
                name: 'Paket Komplit', 
                category: 'Paket', 
                price: 45000, 
                description: 'Ayam Bakar Madu + Nasi + Jus Alpukat', 
                image: null, 
                isBestSeller: true, 
                outOfStock: false,
                ingredients: [
                    { id: 3, name: 'Ayam', quantity: 0.3, unit: 'kg' },
                    { id: 5, name: 'Madu', quantity: 0.05, unit: 'kg' },
                    { id: 1, name: 'Beras', quantity: 0.2, unit: 'kg' },
                    { id: 8, name: 'Alpukat', quantity: 0.2, unit: 'kg' },
                    { id: 9, name: 'Susu', quantity: 0.1, unit: 'liter' }
                ]
            }
        ],
        orders: [],
        users: [
            { id: 1, name: 'Admin', email: 'admin@restaurant.com', role: 'admin', password: 'admin123' },
            { id: 2, name: 'Owner', email: 'owner@restaurant.com', role: 'owner', password: 'owner123' },
            { id: 3, name: 'Kasir', email: 'kasir@restaurant.com', role: 'cashier', password: 'kasir123' },
            { id: 4, name: 'Dapur', email: 'dapur@restaurant.com', role: 'kitchen', password: 'dapur123' }
        ],
        tables: [
            { id: 1, number: 1, capacity: 4, status: 'available' },
            { id: 2, number: 2, capacity: 4, status: 'available' },
            { id: 3, number: 3, capacity: 2, status: 'available' },
            { id: 4, number: 4, capacity: 6, status: 'available' },
            { id: 5, number: 5, capacity: 6, status: 'available' },
            { id: 6, number: 6, capacity: 8, status: 'available' }
        ],
        currentOrder: { items: [], tableId: 0 },
        tableOrder: { items: [], tableId: 1 },
        currentUser: { id: 1, name: 'Admin', role: 'admin' },
        
        // Stock Opname (Inventory management)
        stockOpname: [
            { id: 1, code: 'BR001', name: 'Beras', category: 'Bahan Baku', quantity: 50, unit: 'kg', minStock: 10, price: 12000, supplier: 'Toko Beras Jaya' },
            { id: 2, code: 'TL001', name: 'Telur', category: 'Bahan Baku', quantity: 100, unit: 'pcs', minStock: 20, price: 2000, supplier: 'Peternakan Sejahtera' },
            { id: 3, code: 'AY001', name: 'Ayam', category: 'Bahan Baku', quantity: 30, unit: 'kg', minStock: 5, price: 35000, supplier: 'Daging Segar' },
            { id: 4, code: 'MI001', name: 'Mie', category: 'Bahan Baku', quantity: 20, unit: 'kg', minStock: 5, price: 15000, supplier: 'Mie Indo' },
            { id: 5, code: 'MD001', name: 'Madu', category: 'Bahan Baku', quantity: 5, unit: 'kg', minStock: 2, price: 80000, supplier: 'Lebah Farm' },
            { id: 6, code: 'TH001', name: 'Teh', category: 'Bahan Baku', quantity: 5, unit: 'kg', minStock: 2, price: 80000, supplier: 'Teh Nusantara' },
            { id: 7, code: 'GU001', name: 'Gula', category: 'Bahan Baku', quantity: 20, unit: 'kg', minStock: 5, price: 15000, supplier: 'Gula Manis' },
            { id: 8, code: 'AP001', name: 'Alpukat', category: 'Bahan Baku', quantity: 10, unit: 'kg', minStock: 3, price: 25000, supplier: 'Buah Segar' },
            { id: 9, code: 'SU001', name: 'Susu', category: 'Bahan Baku', quantity: 15, unit: 'liter', minStock: 5, price: 18000, supplier: 'Susu Sehat' },
            { id: 10, code: 'KP001', name: 'Kopi', category: 'Bahan Baku', quantity: 5, unit: 'kg', minStock: 2, price: 120000, supplier: 'Kopi Nusantara' }
        ],
        
        // Asset management
        assets: [
            { id: 1, name: 'Kompor Gas', category: 'Peralatan Dapur', quantity: 2, purchaseDate: '2023-01-15', price: 2500000, currentValue: 2000000, location: 'Dapur', status: 'Baik', lostQuantity: 0, image: null },
            { id: 2, name: 'Kulkas', category: 'Elektronik', quantity: 1, purchaseDate: '2023-02-20', price: 5000000, currentValue: 4000000, location: 'Dapur', status: 'Baik', lostQuantity: 0, image: null },
            { id: 3, name: 'Meja Makan', category: 'Furniture', quantity: 10, purchaseDate: '2023-01-10', price: 1500000, currentValue: 1200000, location: 'Ruang Makan', status: 'Baik', lostQuantity: 0, image: null }
        ],
        
        // Financial management
        transactions: [],
        
        // Payroll management
        payroll: [],
        
        // Shift management
        shifts: [
            { 
                id: 1, 
                name: 'Pagi', 
                startTime: '08:00', 
                endTime: '16:00', 
                days: ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat'],
                employees: [1, 2] 
            },
            { 
                id: 2, 
                name: 'Sore', 
                startTime: '16:00', 
                endTime: '00:00', 
                days: ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'],
                employees: [3, 4] 
            }
        ],
        
        // Branch management
        branches: [
            { id: 1, name: 'Cabang Utama', address: 'Jl. Sudirman No. 123', phone: '021-123456', email: 'utama@restaurant.com', manager: 2, status: 'active' }
        ],
        
        // Reservations
        reservations: [],
        
        // Notifications
        notifications: [],
        
        // License transactions
        licenseTransactions: [],
        
        // User positions
        positions: [
            { id: 1, name: 'Admin' },
            { id: 2, name: 'Owner' },
            { id: 3, name: 'Kasir' },
            { id: 4, name: 'Dapur' },
            { id: 5, name: 'Pelayan' },
            { id: 6, name: 'Supervisor' }
        ]
    };

    // Load state from localStorage
    function loadState() {
        const savedState = localStorage.getItem(DB_KEY);
        if (savedState) {
            try {
                const parsed = JSON.parse(savedState);
                state = { ...state, ...parsed };
            } catch (e) {
                console.error('Error loading state:', e);
            }
        }
        
        // Check trial status
        checkTrialStatus();
        updateKDSNotification();
        renderCurrentPage();
    }

    function saveState() {
        localStorage.setItem(DB_KEY, JSON.stringify(state));
        updateKDSNotification();
    }

    // --- LICENSE MANAGEMENT ---
    function checkTrialStatus() {
        if (state.license.status === 'trial' && state.license.trialActivated) {
            const now = new Date();
            const trialEndDate = new Date(state.license.expiryDate);
            const daysLeft = Math.ceil((trialEndDate - now) / (1000 * 60 * 60 * 24));
            
            // Update trial days left
            document.getElementById('license-days-left').textContent = daysLeft;
            
            // Check if trial has expired
            if (daysLeft <= 0) {
                state.license.status = 'expired';
                showNotification('Masa trial Anda telah berakhir! Silakan aktivasi lisensi untuk melanjutkan.', 'error');
                updateLicenseUI();
            }
            
            // Show warning when 3 days left
            if (daysLeft <= 3 && daysLeft > 0) {
                showNotification(`Masa trial Anda tersisa ${daysLeft} hari lagi!`, 'warning');
            }
        }
        
        updateLicenseUI();
        saveState();
    }

    function updateLicenseUI() {
        const statusElement = document.getElementById('subscriptionStatus');
        if (statusElement) {
            statusElement.textContent = state.license.status === 'trial' ? 'Trial' : 
                                      state.license.status === 'active' ? 'Aktif' : 'Kedaluwarsa';
            statusElement.className = `subscription-status status-${state.license.status}`;
        }
    }

    function activateLicense() {
        const licenseKey = document.getElementById('license-key-input').value || 
                           document.getElementById('license-activation-input').value;
        
        if (!licenseKey) {
            showNotification('Silakan masukkan kode lisensi!', 'warning');
            return;
        }
        
        // Simulate API call to validate license
        showNotification('Memvalidasi lisensi...', 'info');
        
        setTimeout(() => {
            // Simulate successful activation
            const planType = getPlanTypeFromKey(licenseKey);
            
            if (planType) {
                state.license.key = licenseKey;
                state.license.plan = planType;
                state.license.status = 'active';
                state.license.trialActivated = false;
                
                // Set expiry date based on plan type
                const now = new Date();
                if (planType === 'basic') {
                    state.license.expiryDate = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000).toISOString(); // 30 days
                    state.license.maxUsers = 5;
                    state.license.maxTables = 10;
                } else if (planType === 'premium') {
                    state.license.expiryDate = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000).toISOString(); // 30 days
                    state.license.maxUsers = 10;
                    state.license.maxTables = 15;
                } else if (planType === 'enterprise') {
                    state.license.expiryDate = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000).toISOString(); // 30 days
                    state.license.maxUsers = 999;
                    state.license.maxTables = 999;
                }
                
                // Add transaction record
                state.licenseTransactions.push({
                    id: Date.now(),
                    type: 'activation',
                    plan: planType,
                    amount: getPlanPrice(planType),
                    date: new Date().toISOString(),
                    status: 'completed',
                    paymentMethod: 'License Key'
                });
                
                saveState();
                updateLicenseUI();
                renderLicensePage();
                
                showNotification(`Lisensi ${planType} berhasil diaktifkan!`, 'success');
                
                // Clear input fields
                document.getElementById('license-key-input').value = '';
                document.getElementById('license-activation-input').value = '';
            } else {
                showNotification('Kode lisensi tidak valid!', 'error');
            }
        }, 1500);
    }

    function getPlanTypeFromKey(key) {
        // In a real implementation, you would validate the key with your database
        // For simulation, we'll check if the key contains specific patterns
        if (key.includes('BASIC')) return 'basic';
        if (key.includes('PREMIUM')) return 'premium';
        if (key.includes('ENTERPRISE')) return 'enterprise';
        return null;
    }

    function getPlanPrice(plan) {
        if (plan === 'basic') return 299000;
        if (plan === 'premium') return 599000;
        if (plan === 'enterprise') return 999000;
        return 0;
    }

    // --- USER MANAGEMENT ---
    function switchUser(userId) {
        const user = state.users.find(u => u.id === userId);
        if (user) {
            state.currentUser = user;
            renderUserInterface();
            showNotification(`Anda masuk sebagai ${user.name} (${getRoleLabel(user.role)})`, 'info');
        }
        toggleUserDropdown();
    }

    function renderUserInterface() {
        const user = state.currentUser;
        document.getElementById('userName').textContent = user.name;
        document.getElementById('userAvatar').textContent = user.name.charAt(0);
        renderSidebar();
        
        const defaultPages = {
            admin: 'dashboard',
            owner: 'financial',
            cashier: 'pos',
            kitchen: 'kds',
            customer: 'table-order'
        };
        
        showPage(defaultPages[user.role]);
        lucide.createIcons();
    }

    function renderSidebar() {
        const sidebarMenu = document.getElementById('sidebarMenu');
        const roleMenus = {
            admin: [
                { page: 'dashboard', label: 'Dashboard', icon: 'layout-dashboard' },
                { page: 'pos', label: 'Kasir', icon: 'shopping-cart' },
                { page: 'kds', label: 'Dapur', icon: 'chef-hat', notification: true },
                { page: 'table-order', label: 'Pesan via Meja', icon: 'smartphone' },
                { page: 'reservations', label: 'Reservasi', icon: 'calendar' },
                { page: 'menu-management', label: 'Kelola Menu', icon: 'utensils' },
                { page: 'table-management', label: 'Manajemen Meja', icon: 'table' },
                { page: 'stock-opname', label: 'Stock Opname', icon: 'package' },
                { page: 'order-history', label: 'Riwayat Pesanan', icon: 'file-text' },
                { page: 'user-management', label: 'Kelola Pengguna', icon: 'users' },
                { page: 'asset', label: 'Manajemen Aset', icon: 'briefcase' },
                { page: 'financial', label: 'Keuangan', icon: 'dollar-sign' },
                { page: 'payroll', label: 'Penggajian', icon: 'credit-card' },
                { page: 'shift', label: 'Shift', icon: 'calendar' },
                { page: 'branch', label: 'Multi Cabang', icon: 'map-pin' },
                { page: 'license', label: 'Lisensi', icon: 'crown' },
                { page: 'settings', label: 'Pengaturan', icon: 'settings' }
            ],
            owner: [
                { page: 'financial', label: 'Keuangan', icon: 'dollar-sign' },
                { page: 'reservations', label: 'Reservasi', icon: 'calendar' },
                { page: 'order-history', label: 'Riwayat Pesanan', icon: 'file-text' },
                { page: 'user-management', label: 'Kelola Pengguna', icon: 'users' },
                { page: 'payroll', label: 'Penggajian', icon: 'credit-card' },
                { page: 'branch', label: 'Multi Cabang', icon: 'map-pin' },
                { page: 'license', label: 'Lisensi', icon: 'crown' },
                { page: 'settings', label: 'Pengaturan', icon: 'settings' }
            ],
            cashier: [
                { page: 'dashboard', label: 'Dashboard', icon: 'layout-dashboard' },
                { page: 'pos', label: 'Kasir', icon: 'shopping-cart' },
                { page: 'reservations', label: 'Reservasi', icon: 'calendar' },
                { page: 'order-history', label: 'Riwayat Pesanan', icon: 'file-text' },
                { page: 'table-management', label: 'Manajemen Meja', icon: 'table' }
            ],
            kitchen: [
                { page: 'kds', label: 'Dapur', icon: 'chef-hat', notification: true }
            ],
            customer: [
                { page: 'table-order', label: 'Pesan di Meja', icon: 'smartphone' }
            ]
        };
        
        const menuItems = roleMenus[state.currentUser.role] || [];
        sidebarMenu.innerHTML = menuItems.map(item => `
            <li>
                <a href="#" class="nav-link ${item.page === 'dashboard' ? 'active' : ''}" data-page="${item.page}">
                    <i data-lucide="${item.icon}"></i> ${item.label}
                    ${item.notification ? `<span class="notification-badge" id="kds-notification" style="display: none;">0</span>` : ''}
                </a>
            </li>
        `).join('');
        
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                showPage(link.dataset.page);
                // Close sidebar on mobile after clicking a menu item
                if (window.innerWidth <= 768) {
                    document.getElementById('sidebar').classList.remove('open');
                }
            });
        });
    }

    function getRoleLabel(role) {
        const roleMap = {
            'admin': 'Admin',
            'owner': 'Pemilik',
            'cashier': 'Kasir',
            'kitchen': 'Dapur',
            'customer': 'Pelanggan'
        };
        return roleMap[role] || role;
    }

    function toggleUserDropdown() {
        document.getElementById('userDropdownMenu').classList.toggle('show');
    }

    // --- NOTIFICATION SYSTEM ---
    function showNotification(message, type = 'info', persistent = false) {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <i data-lucide="${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : type === 'warning' ? 'alert-triangle' : 'info'}"></i>
            <span>${message}</span>
        `;
        document.body.appendChild(notification);
        lucide.createIcons();
        
        if (!persistent) {
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Add to notifications list for persistence
        state.notifications.push({
            id: Date.now(),
            message,
            type,
            timestamp: new Date().toISOString(),
            read: false
        });
        saveState();
    }

    function showNotificationToast(title, message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = 'notification-toast';
        toast.innerHTML = `
            <div class="notification-toast-icon" style="color: ${type === 'success' ? 'var(--accent-success)' : type === 'error' ? 'var(--accent-danger)' : type === 'warning' ? 'var(--accent-warning)' : 'var(--accent-primary)'}">
                <i data-lucide="${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : type === 'warning' ? 'alert-triangle' : 'info'}"></i>
            </div>
            <div class="notification-toast-content">
                <div class="notification-toast-title">${title}</div>
                <div class="notification-toast-message">${message}</div>
            </div>
            <button class="notification-toast-close" onclick="this.parentElement.remove()">
                <i data-lucide="x"></i>
            </button>
        `;
        document.body.appendChild(toast);
        lucide.createIcons();
        
        setTimeout(() => {
            toast.remove();
        }, 5000);
    }

    function updateKDSNotification() {
        const newOrdersCount = state.orders.filter(o => o.status === 'baru').length;
        const notificationBadge = document.getElementById('kds-notification');
        if (notificationBadge) {
            if (newOrdersCount > 0) {
                notificationBadge.textContent = newOrdersCount;
                notificationBadge.style.display = 'flex';
            } else {
                notificationBadge.style.display = 'none';
            }
        }
    }

    // --- INVENTORY & MENU INTEGRATION ---
    function checkAndUpdateMenuStock() {
        // Check each menu item and update outOfStock status based on ingredient availability
        state.menu.forEach(menuItem => {
            let canMake = true;
            
            if (menuItem.ingredients && menuItem.ingredients.length > 0) {
                menuItem.ingredients.forEach(ingredient => {
                    const stockItem = state.stockOpname.find(item => item.name === ingredient.name);
                    if (stockItem && stockItem.quantity < ingredient.quantity) {
                        canMake = false;
                    }
                });
            }
            
            // Update menu item status
            if (menuItem.outOfStock !== !canMake) {
                menuItem.outOfStock = !canMake;
                
                // Send notification if menu item is now out of stock
                if (menuItem.outOfStock) {
                    showNotification(`Menu "${menuItem.name}" sekarang tidak tersedia karena stok bahan habis!`, 'warning');
                    
                    // Add persistent notification for customers
                    state.notifications.push({
                        id: Date.now(),
                        title: 'Menu Tidak Tersedia',
                        message: `Maaf, menu "${menuItem.name}" sedang tidak tersedia karena stok bahan habis. Silakan pilih menu lain.`,
                        type: 'warning',
                        timestamp: new Date().toISOString(),
                        read: false,
                        persistent: true
                    });
                }
            }
        });
        
        saveState();
    }

    function reduceStockFromOrder(order) {
        // Reduce stock based on order items
        order.items.forEach(orderItem => {
            const menuItem = state.menu.find(item => item.id === orderItem.id);
            if (menuItem && menuItem.ingredients) {
                menuItem.ingredients.forEach(ingredient => {
                    const stockItem = state.stockOpname.find(item => item.name === ingredient.name);
                    if (stockItem) {
                        const reduction = ingredient.quantity * orderItem.quantity;
                        stockItem.quantity = Math.max(0, stockItem.quantity - reduction);
                        
                        // Check if stock is now low
                        if (stockItem.quantity <= stockItem.minStock && stockItem.quantity > 0) {
                            showNotification(`Peringatan: Stok "${stockItem.name}" menipis! Sisa: ${stockItem.quantity} ${stockItem.unit}`, 'warning');
                        }
                        
                        // Check if stock is now out
                        if (stockItem.quantity === 0) {
                            showNotification(`Stok "${stockItem.name}" habis!`, 'error');
                        }
                    }
                });
            }
        });
        
        // Update menu stock status
        checkAndUpdateMenuStock();
    }

    // --- ROUTING & NAVIGATION ---
    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        
        document.getElementById(`${pageId}-page`).classList.add('active');
        const navLink = document.querySelector(`[data-page="${pageId}"]`);
        if (navLink) {
            navLink.classList.add('active');
            document.getElementById('topbarTitle').textContent = navLink.textContent.trim();
        }

        switch(pageId) {
            case 'dashboard': renderDashboard(); break;
            case 'pos': renderPOS(); break;
            case 'kds': renderKDS(); break;
            case 'table-order': renderTableOrder(); break;
            case 'reservations': renderReservations(); break;
            case 'menu-management': renderMenuManagement(); break;
            case 'table-management': renderTableManagement(); break;
            case 'order-history': renderOrderHistory(); break;
            case 'user-management': renderUserManagement(); break;
            case 'stock-opname': renderStockOpname(); break;
            case 'asset': renderAssetManagement(); break;
            case 'financial': renderFinancialManagement(); break;
            case 'payroll': renderPayrollManagement(); break;
            case 'shift': renderShiftManagement(); break;
            case 'branch': renderBranchManagement(); break;
            case 'license': renderLicensePage(); break;
            case 'settings': renderSettings(); break;
        }
    }

    // --- DASHBOARD ---
    function renderDashboard() {
        const today = new Date().toDateString();
        const todayOrders = state.orders.filter(o => new Date(o.timestamp).toDateString() === today);
        const activeOrders = state.orders.filter(o => o.status !== 'selesai');
        
        const totalRevenue = todayOrders.reduce((sum, o) => sum + o.total, 0);
        const totalItemsSold = todayOrders.reduce((sum, o) => sum + o.items.reduce((s, i) => s + i.quantity, 0), 0);

        document.getElementById('kpi-revenue').textContent = `Rp ${totalRevenue.toLocaleString('id-ID')}`;
        document.getElementById('kpi-orders').textContent = todayOrders.length;
        document.getElementById('kpi-active').textContent = activeOrders.length;
        document.getElementById('kpi-items').textContent = totalItemsSold;

        const recentOrdersList = document.getElementById('recent-orders-list');
        if (state.orders.length === 0) {
            recentOrdersList.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">Belum ada pesanan.</p>';
        } else {
            recentOrdersList.innerHTML = state.orders.slice(-5).reverse().map(order => `
                <div class="pos-cart-item">
                    <div>
                        <div class="pos-cart-item-name">Order #${order.id} - ${order.tableId === 0 ? 'Take Away' : `Meja ${order.tableId}`} (${order.type})</div>
                        <div class="pos-cart-item-price">${order.items.map(i=>`${i.name} (x${i.quantity})`).join(', ')}</div>
                    </div>
                    <div style="text-align:right;">
                        <div style="color: var(--accent-primary);">Rp ${order.total.toLocaleString('id-ID')}</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">${new Date(order.timestamp).toLocaleTimeString('id-ID')}</div>
                    </div>
                </div>
            `).join('');
        }
    }

    // --- POS SYSTEM ---
    function renderPOS() {
        renderCategories('pos-categories');
        renderMenuGrid('pos-menu-grid', handleAddToOrder);
        updatePOSCart();
    }

    function renderCategories(containerId) {
        const categories = [...new Set(state.menu.map(item => item.category))];
        const container = document.getElementById(containerId);
        container.innerHTML = `<button class="pos-category-btn active" onclick="filterMenu('all', this)">Semua</button>` +
            categories.map(cat => `<button class="pos-category-btn" onclick="filterMenu('${cat}', this)">${cat}</button>`).join('');
    }

    function renderMenuGrid(containerId, clickHandler) {
        const grid = document.getElementById(containerId);
        grid.innerHTML = state.menu.map(item => {
            const isBestSeller = item.isBestSeller;
            const isOutOfStock = item.outOfStock;
            
            return `
                <div class="pos-menu-item ${isBestSeller ? 'best-seller' : ''} ${isOutOfStock ? 'out-of-stock' : ''}" 
                     onclick="${!isOutOfStock ? clickHandler.name + '(' + item.id + ')' : ''}">
                    ${item.image ? `<img src="${item.image}" alt="${item.name}" style="width: 100%; height: 80px; object-fit: cover; border-radius: 8px; margin-bottom: 0.5rem;">` : ''}
                    <h4>${item.name}</h4>
                    <p>Rp ${item.price.toLocaleString('id-ID')}</p>
                    ${item.description ? `<div class="menu-description">${item.description}</div>` : ''}
                </div>
            `;
        }).join('');
    }

    function filterMenu(category, button) {
        document.querySelectorAll(`#${button.parentElement.id} .pos-category-btn`).forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        
        const grid = button.parentElement.nextElementSibling;
        const itemsToRender = category === 'all' ? state.menu : state.menu.filter(item => item.category === category);
        
        const clickHandlerMap = {
            'pos-categories': 'handleAddToOrder',
            'table-categories': 'handleAddToTableOrder'
        };
        const clickHandler = clickHandlerMap[button.parentElement.id] || 'handleAddToOrder';
        
        grid.innerHTML = itemsToRender.map(item => {
            const isBestSeller = item.isBestSeller;
            const isOutOfStock = item.outOfStock;
            
            return `
                <div class="pos-menu-item ${isBestSeller ? 'best-seller' : ''} ${isOutOfStock ? 'out-of-stock' : ''}" 
                     onclick="${!isOutOfStock ? clickHandler + '(' + item.id + ')' : ''}">
                    ${item.image ? `<img src="${item.image}" alt="${item.name}" style="width: 100%; height: 80px; object-fit: cover; border-radius: 8px; margin-bottom: 0.5rem;">` : ''}
                    <h4>${item.name}</h4>
                    <p>Rp ${item.price.toLocaleString('id-ID')}</p>
                    ${item.description ? `<div class="menu-description">${item.description}</div>` : ''}
                </div>
            `;
        }).join('');
    }

    function handleAddToOrder(itemId) {
        const menuItem = state.menu.find(i => i.id === itemId);
        if (!menuItem || menuItem.outOfStock) return;
        
        // Check if this is a take away order
        const tableId = parseInt(document.getElementById('pos-table-select').value);
        if (tableId === 0 && state.currentOrder.items.length === 0) {
            // Show customer info modal for take away orders
            document.getElementById('takeaway-customer-modal').style.display = 'flex';
            return;
        }
        
        const existingItem = state.currentOrder.items.find(i => i.id === itemId);
        if (existingItem) {
            existingItem.quantity++;
        } else {
            state.currentOrder.items.push({ 
                id: menuItem.id,
                name: menuItem.name, 
                price: menuItem.price, 
                quantity: 1 
            });
        }
        updatePOSCart();
    }

    function proceedWithTakeaway() {
        const customerName = document.getElementById('takeaway-customer-name').value;
        const customerPhone = document.getElementById('takeaway-customer-phone').value;
        
        if (!customerName) {
            showNotification('Nama pelanggan harus diisi!', 'warning');
            return;
        }
        
        // Store customer info in the current order
        state.currentOrder.customerName = customerName;
        state.currentOrder.customerPhone = customerPhone;
        
        closeModal('takeaway-customer-modal');
        showNotification('Silakan pilih menu untuk pesanan take away Anda', 'info');
    }

    function updatePOSCart() {
        const cartContainer = document.getElementById('pos-cart');
        if (state.currentOrder.items.length === 0) {
            cartContainer.innerHTML = '<p style="text-align:center; color: var(--text-secondary); padding: 2rem 0;">Keranjang kosong.</p>';
        } else {
            cartContainer.innerHTML = state.currentOrder.items.map(item => `
                <div class="pos-cart-item">
                    <div>
                        <div class="pos-cart-item-name">${item.name}</div>
                        <div class="pos-cart-item-price">Rp ${item.price.toLocaleString('id-ID')}</div>
                    </div>
                    <div class="pos-cart-item-controls">
                        <button onclick="updateOrderQuantity(${item.id}, -1)"><i data-lucide="minus-circle"></i></button>
                        <span>${item.quantity}</span>
                        <button onclick="updateOrderQuantity(${item.id}, 1)"><i data-lucide="plus-circle"></i></button>
                    </div>
                </div>
            `).join('');
        }
        calculatePOSTotal();
        lucide.createIcons();
    }

    function updateOrderQuantity(itemId, change) {
        const item = state.currentOrder.items.find(i => i.id === itemId);
        if (item) {
            item.quantity += change;
            if (item.quantity <= 0) {
                state.currentOrder.items = state.currentOrder.items.filter(i => i.id !== itemId);
            }
            updatePOSCart();
        }
    }

    function calculatePOSTotal() {
        const subtotal = state.currentOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const tax = subtotal * 0.1;
        const total = subtotal + tax;

        document.getElementById('pos-subtotal').textContent = `Rp ${subtotal.toLocaleString('id-ID')}`;
        document.getElementById('pos-tax').textContent = `Rp ${tax.toLocaleString('id-ID')}`;
        document.getElementById('pos-total').textContent = `Rp ${total.toLocaleString('id-ID')}`;
    }

    function clearCurrentOrder() {
        if (confirm('Apakah Anda yakin ingin membatalkan pesanan ini?')) {
            state.currentOrder = { items: [], tableId: parseInt(document.getElementById('pos-table-select').value) };
            updatePOSCart();
        }
    }

    function openPaymentModal() {
        if (state.currentOrder.items.length === 0) {
            showNotification('Keranjang masih kosong!', 'warning');
            return;
        }
        document.getElementById('modal-subtotal').textContent = document.getElementById('pos-subtotal').textContent;
        document.getElementById('modal-tax').textContent = document.getElementById('pos-tax').textContent;
        document.getElementById('modal-total').textContent = document.getElementById('pos-total').textContent;
        document.getElementById('payment-modal').style.display = 'flex';
    }

    function processPayment() {
        const total = parseInt(document.getElementById('modal-total').textContent.replace(/\D/g,''));
        const method = document.getElementById('payment-method').value;
        const paidAmount = parseInt(document.getElementById('payment-amount').value) || 0;
        
        if (method === 'Tunai' && paidAmount < total) {
            showNotification('Uang yang dibayar kurang!', 'error');
            return;
        }

        const newOrder = {
            id: Date.now(),
            tableId: parseInt(document.getElementById('pos-table-select').value),
            items: [...state.currentOrder.items],
            status: 'baru',
            total: total,
            type: state.currentOrder.tableId === 0 ? 'takeaway' : 'dine-in',
            paymentMethod: method,
            timestamp: new Date().toISOString(),
            cashier: state.currentUser.name,
            statusHistory: [
                { status: 'baru', timestamp: new Date().toISOString() }
            ]
        };
        
        // Add customer info for take away orders
        if (state.currentOrder.tableId === 0) {
            newOrder.customerName = state.currentOrder.customerName;
            newOrder.customerPhone = state.currentOrder.customerPhone;
        }

        // Reduce stock from inventory
        reduceStockFromOrder(newOrder);

        state.orders.push(newOrder);
        state.currentOrder = { items: [], tableId: 0 };
        saveState();
        
        closeModal('payment-modal');
        showNotification(`Pembayaran ${method} sebesar Rp ${total.toLocaleString('id-ID')} berhasil!`, 'success');
        
        // Show print button for cash payments
        if (method === 'Tunai') {
            document.getElementById('print-receipt-btn').style.display = 'flex';
        } else {
            document.getElementById('print-receipt-btn').style.display = 'none';
        }
        
        renderPOS();
        renderDashboard();
        renderKDS();
    }

    function printReceipt() {
        const total = parseInt(document.getElementById('modal-total').textContent.replace(/\D/g,''));
        const method = document.getElementById('payment-method').value;
        const paidAmount = parseInt(document.getElementById('payment-amount').value) || 0;
        const change = paidAmount - total;
        
        const receiptContent = `
            <div class="print-receipt">
                <div class="print-receipt-header">
                    <div class="print-receipt-title">DNT Network Cafe</div>
                    <div class="print-receipt-subtitle">Jl. Sudirman No. 123</div>
                    <div class="print-receipt-subtitle">Tel: 021-123456</div>
                </div>
                <div class="print-receipt-details">
                    <div class="print-receipt-row">
                        <span>Tanggal:</span>
                        <span>${new Date().toLocaleDateString('id-ID')}</span>
                    </div>
                    <div class="print-receipt-row">
                        <span>Kasir:</span>
                        <span>${state.currentUser.name}</span>
                    </div>
                    <div class="print-receipt-row">
                        <span>Meja:</span>
                        <span>${state.currentOrder.tableId === 0 ? 'Take Away' : `Meja ${state.currentOrder.tableId}`}</span>
                    </div>
                    ${state.currentOrder.customerName ? `
                        <div class="print-receipt-row">
                            <span>Pelanggan:</span>
                            <span>${state.currentOrder.customerName}</span>
                        </div>
                    ` : ''}
                </div>
                <div class="print-receipt-divider"></div>
                <div class="print-receipt-details">
                    ${state.currentOrder.items.map(item => `
                        <div class="print-receipt-row">
                            <span>${item.name} x${item.quantity}</span>
                            <span>Rp ${(item.price * item.quantity).toLocaleString('id-ID')}</span>
                        </div>
                    `).join('')}
                </div>
                <div class="print-receipt-divider"></div>
                <div class="print-receipt-details">
                    <div class="print-receipt-row">
                        <span>Subtotal:</span>
                        <span>${document.getElementById('modal-subtotal').textContent}</span>
                    </div>
                    <div class="print-receipt-row">
                        <span>Pajak (10%):</span>
                        <span>${document.getElementById('modal-tax').textContent}</span>
                    </div>
                    <div class="print-receipt-row print-receipt-total">
                        <span>Total:</span>
                        <span>${document.getElementById('modal-total').textContent}</span>
                    </div>
                    ${method === 'Tunai' ? `
                        <div class="print-receipt-row">
                            <span>Tunai:</span>
                            <span>Rp ${paidAmount.toLocaleString('id-ID')}</span>
                        </div>
                        <div class="print-receipt-row">
                            <span>Kembalian:</span>
                            <span>Rp ${change.toLocaleString('id-ID')}</span>
                        </div>
                    ` : ''}
                </div>
                <div class="print-receipt-footer">
                    <div>Terima kasih atas kunjungan Anda</div>
                    <div>Barang yang sudah dibeli tidak dapat dikembalikan</div>
                </div>
            </div>
        `;
        
        const printWindow = window.open('', '_blank');
        printWindow.document.write(receiptContent);
        printWindow.document.close();
        printWindow.focus();
        printWindow.print();
        printWindow.close();
    }

    // --- KDS SYSTEM ---
    function renderKDS() {
        const kdsGrid = document.getElementById('kds-orders-grid');
        const activeOrders = state.orders.filter(o => o.status !== 'selesai');
        
        if (activeOrders.length === 0) {
            kdsGrid.innerHTML = '<p style="text-align:center; color: var(--text-secondary); grid-column: 1/-1;">Tidak ada pesanan aktif.</p>';
        } else {
            // Group orders by table
            const ordersByTable = {};
            activeOrders.forEach(order => {
                const tableKey = order.tableId === 0 ? 'Take Away' : `Meja ${order.tableId}`;
                if (!ordersByTable[tableKey]) {
                    ordersByTable[tableKey] = [];
                }
                ordersByTable[tableKey].push(order);
            });
            
            // Group orders by menu items for efficiency
            const menuItemsByTable = {};
            Object.entries(ordersByTable).forEach(([tableKey, orders]) => {
                menuItemsByTable[tableKey] = {};
                
                orders.forEach(order => {
                    order.items.forEach(item => {
                        if (!menuItemsByTable[tableKey][item.id]) {
                            menuItemsByTable[tableKey][item.id] = {
                                ...item,
                                quantity: 0,
                                orders: []
                            };
                        }
                        menuItemsByTable[tableKey][item.id].quantity += item.quantity;
                        menuItemsByTable[tableKey][item.id].orders.push(order.id);
                    });
                });
            });
            
            kdsGrid.innerHTML = Object.entries(menuItemsByTable).map(([tableKey, menuItems]) => {
                const tableOrders = ordersByTable[tableKey];
                const orderIds = [...new Set(tableOrders.map(o => o.id))];
                
                return `
                    <div class="kds-order-card">
                        <div class="kds-order-header">
                            <span class="kds-order-id">${tableKey}</span>
                            <span class="kds-order-time">${orderIds.length} pesanan</span>
                        </div>
                        <div style="margin-bottom: 1rem; padding: 0.5rem; background: var(--bg-tertiary); border-radius: 8px;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem;">Pesanan: #${orderIds.join(', #')}</div>
                        </div>
                        ${Object.values(menuItems).map(item => `
                            <div class="kds-order-item">
                                <span>${item.name} x${item.quantity}</span>
                            </div>
                        `).join('')}
                        <div class="kds-order-actions">
                            ${tableOrders.some(o => o.status === 'baru') ? 
                                `<button class="btn btn-primary" onclick="updateTableOrderStatus('${tableKey}', 'dimasak')">Mulai Masak</button>` : ''}
                            ${tableOrders.every(o => o.status === 'dimasak') ? 
                                `<button class="btn btn-warning" onclick="updateTableOrderStatus('${tableKey}', 'siap')">Selesai</button>` : ''}
                            ${tableOrders.every(o => o.status === 'siap') ? 
                                `<button class="btn btn-success" onclick="updateTableOrderStatus('${tableKey}', 'selesai')">Diantar</button>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
    }

    function updateTableOrderStatus(tableKey, newStatus) {
        const tableId = tableKey === 'Take Away' ? 0 : parseInt(tableKey.replace('Meja ', ''));
        const tableOrders = state.orders.filter(o => o.tableId === tableId && o.status !== 'selesai');
        
        tableOrders.forEach(order => {
            order.status = newStatus;
            if (!order.statusHistory) order.statusHistory = [];
            order.statusHistory.push({
                status: newStatus,
                timestamp: new Date().toISOString()
            });
        });
        
        saveState();
        renderKDS();
        renderDashboard();
        renderTableOrder();
        
        const statusMessage = newStatus === 'dimasak' ? 'Pesanan sedang diproses' :
                             newStatus === 'siap' ? 'Pesanan siap diantar' :
                             newStatus === 'selesai' ? 'Pesanan telah selesai' : '';
        
        if (statusMessage) {
            showNotification(`${tableKey}: ${statusMessage}`, 'info');
        }
    }

    function openStockUpdateModal() {
        const modal = document.getElementById('stock-update-modal');
        const listContainer = document.getElementById('stock-update-list');
        
        listContainer.innerHTML = state.menu.map(item => `
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; padding: 0.5rem; background: var(--bg-tertiary); border-radius: 8px;">
                <input type="checkbox" id="stock-${item.id}" ${item.outOfStock ? 'checked' : ''} onchange="toggleMenuStock(${item.id})">
                <label for="stock-${item.id}" style="flex-grow: 1; cursor: pointer;">
                    ${item.name} - Rp ${item.price.toLocaleString('id-ID')}
                </label>
                <span style="color: ${item.outOfStock ? 'var(--accent-danger)' : 'var(--accent-success)'}; font-weight: 600;">
                    ${item.outOfStock ? 'Habis' : 'Tersedia'}
                </span>
            </div>
        `).join('');
        
        modal.style.display = 'flex';
    }

    function toggleMenuStock(itemId) {
        const item = state.menu.find(m => m.id === itemId);
        if (item) {
            item.outOfStock = !item.outOfStock;
        }
    }

    function saveStockUpdates() {
        saveState();
        closeModal('stock-update-modal');
        showNotification('Stok menu berhasil diperbarui!', 'success');
        renderPOS();
        renderTableOrder();
        renderKDS();
    }

    // --- TABLE ORDER SYSTEM ---
    function renderTableOrder() {
        const tableSelect = document.getElementById('table-order-select');
        const selectedTableId = parseInt(tableSelect.value);
        state.tableOrder.tableId = selectedTableId;
        
        document.getElementById('cart-table-number').textContent = selectedTableId;
        document.getElementById('current-table-number').textContent = selectedTableId;
        
        renderCategories('table-categories');
        renderMenuGrid('table-menu-grid', handleAddToTableOrder);
        updateTableCart();
        renderTableActiveOrders();
        renderQueueList();
    }

    function renderQueueList() {
        const queueList = document.getElementById('queue-list');
        const activeOrders = state.orders.filter(o => o.status !== 'selesai');
        
        if (activeOrders.length === 0) {
            queueList.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">Tidak ada antrean pesanan.</p>';
        } else {
            // Group orders by table
            const ordersByTable = {};
            activeOrders.forEach(order => {
                const tableKey = order.tableId === 0 ? 'Take Away' : `Meja ${order.tableId}`;
                if (!ordersByTable[tableKey]) {
                    ordersByTable[tableKey] = [];
                }
                ordersByTable[tableKey].push(order);
            });
            
            queueList.innerHTML = Object.entries(ordersByTable).map(([tableKey, orders]) => {
                const orderIds = orders.map(o => o.id);
                const latestOrder = orders.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))[0];
                const statusClass = latestOrder.status === 'baru' ? 'new' : 
                                    latestOrder.status === 'dimasak' ? 'processing' : 
                                    latestOrder.status === 'siap' ? 'ready' : '';
                
                return `
                    <div class="queue-item">
                        <div>
                            <div class="queue-table">${tableKey}</div>
                            <div class="queue-order">Order #${orderIds.join(', #')}</div>
                            <div class="queue-time">${new Date(latestOrder.timestamp).toLocaleTimeString('id-ID')}</div>
                        </div>
                        <div class="queue-status ${statusClass}">${getStatusLabel(latestOrder.status)}</div>
                    </div>
                `;
            }).join('');
        }
    }

    function renderTableActiveOrders() {
        const container = document.getElementById('table-active-orders');
        const tableId = state.tableOrder.tableId;
        const activeOrders = state.orders.filter(order => 
            order.tableId === tableId && order.status !== 'selesai'
        );
        
        if (activeOrders.length === 0) {
            container.innerHTML = '<p style="text-align:center; color: var(--text-secondary); padding: 2rem 0;">Tidak ada pesanan aktif untuk meja ini.</p>';
        } else {
            container.innerHTML = activeOrders.map(order => `
                <div class="card" style="margin-bottom: 1rem;">
                    <div class="card-header" style="padding: 1rem; margin-bottom: 0;">
                        <span>Order #${order.id}</span>
                        <span class="subscription-status status-${order.status === 'baru' ? 'active' : order.status === 'dimasak' ? 'warning' : 'success'}">
                            ${getStatusLabel(order.status)}
                        </span>
                    </div>
                    <div style="padding: 1rem;">
                        <div class="order-status-timeline">
                            <div class="order-status-step ${order.status === 'baru' || order.status === 'dimasak' || order.status === 'siap' || order.status === 'selesai' ? 'completed' : ''}">
                                <div class="order-status-step-circle">
                                    ${order.status === 'baru' || order.status === 'dimasak' || order.status === 'siap' || order.status === 'selesai' ? '<i data-lucide="check"></i>' : '1'}
                                </div>
                                <div class="order-status-step-label">Diterima</div>
                            </div>
                            <div class="order-status-step ${order.status === 'dimasak' || order.status === 'siap' || order.status === 'selesai' ? 'completed' : order.status === 'baru' ? 'active' : ''}">
                                <div class="order-status-step-circle">
                                    ${order.status === 'dimasak' || order.status === 'siap' || order.status === 'selesai' ? '<i data-lucide="check"></i>' : '2'}
                                </div>
                                <div class="order-status-step-label">Diproses</div>
                            </div>
                            <div class="order-status-step ${order.status === 'siap' || order.status === 'selesai' ? 'completed' : order.status === 'dimasak' ? 'active' : ''}">
                                <div class="order-status-step-circle">
                                    ${order.status === 'siap' || order.status === 'selesai' ? '<i data-lucide="check"></i>' : '3'}
                                </div>
                                <div class="order-status-step-label">Siap</div>
                            </div>
                            <div class="order-status-step ${order.status === 'selesai' ? 'completed' : order.status === 'siap' ? 'active' : ''}">
                                <div class="order-status-step-circle">
                                    ${order.status === 'selesai' ? '<i data-lucide="check"></i>' : '4'}
                                </div>
                                <div class="order-status-step-label">Selesai</div>
                            </div>
                        </div>
                        <div style="margin-top: 1rem;">
                            <h4>Items:</h4>
                            ${order.items.map(item => `
                                <div style="display: flex; justify-content: space-between; padding: 0.25rem 0;">
                                    <span>${item.name} x${item.quantity} ${item.status === 'cancel' ? '(Dibatalkan)' : item.status === 'out' ? '(Habis)' : ''}</span>
                                    <span>Rp ${(item.price * item.quantity).toLocaleString('id-ID')}</span>
                                </div>
                            `).join('')}
                        </div>
                        ${order.items.some(item => item.status === 'cancel' || item.status === 'out') ? `
                            <div style="margin-top: 1rem;">
                                <button class="btn btn-primary" onclick="replaceCancelledItems(${order.id})">
                                    <i data-lucide="refresh-cw"></i> Ganti Menu
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }
        lucide.createIcons();
    }

    function handleAddToTableOrder(itemId) {
        const menuItem = state.menu.find(i => i.id === itemId);
        if (!menuItem || menuItem.outOfStock) return;
        
        const existingItem = state.tableOrder.items.find(i => i.id === itemId);
        if (existingItem) {
            existingItem.quantity++;
        } else {
            state.tableOrder.items.push({ 
                id: menuItem.id,
                name: menuItem.name, 
                price: menuItem.price, 
                quantity: 1 
            });
        }
        updateTableCart();
    }

    function updateTableCart() {
        const cartContainer = document.getElementById('table-cart');
        if (state.tableOrder.items.length === 0) {
            cartContainer.innerHTML = '<p style="text-align:center; color: var(--text-secondary); padding: 2rem 0;">Keranjang kosong.</p>';
        } else {
            cartContainer.innerHTML = state.tableOrder.items.map(item => `
                <div class="pos-cart-item">
                    <div>
                        <div class="pos-cart-item-name">${item.name}</div>
                        <div class="pos-cart-item-price">Rp ${item.price.toLocaleString('id-ID')}</div>
                    </div>
                    <div class="pos-cart-item-controls">
                        <button onclick="updateTableQuantity(${item.id}, -1)"><i data-lucide="minus-circle"></i></button>
                        <span>${item.quantity}</span>
                        <button onclick="updateTableQuantity(${item.id}, 1)"><i data-lucide="plus-circle"></i></button>
                    </div>
                </div>
            `).join('');
        }
        calculateTableTotal();
        lucide.createIcons();
    }

    function updateTableQuantity(itemId, change) {
        const item = state.tableOrder.items.find(i => i.id === itemId);
        if (item) {
            item.quantity += change;
            if (item.quantity <= 0) {
                state.tableOrder.items = state.tableOrder.items.filter(i => i.id !== itemId);
            }
            updateTableCart();
        }
    }

    function calculateTableTotal() {
        const total = state.tableOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        document.getElementById('table-total').textContent = `Rp ${total.toLocaleString('id-ID')}`;
    }

    function submitTableOrder() {
        if (state.tableOrder.items.length === 0) {
            showNotification('Keranjang masih kosong!', 'warning');
            return;
        }
        const total = state.tableOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const newOrder = {
            id: Date.now(),
            tableId: state.tableOrder.tableId,
            items: [...state.tableOrder.items],
            status: 'baru',
            total: total,
            type: 'dine-in',
            timestamp: new Date().toISOString(),
            statusHistory: [
                { status: 'baru', timestamp: new Date().toISOString() }
            ]
        };
        
        const table = state.tables.find(t => t.id === state.tableOrder.tableId);
        if (table) table.status = 'occupied';
        
        // Reduce stock from inventory
        reduceStockFromOrder(newOrder);
        
        state.orders.push(newOrder);
        state.tableOrder = { items: [], tableId: 1 };
        saveState();
        
        showNotification('Pesanan telah dikirim ke dapur!', 'success');
        renderTableOrder();
        renderDashboard();
        renderKDS();
    }

    function replaceCancelledItems(orderId) {
        const order = state.orders.find(o => o.id === orderId);
        if (!order) return;
        
        const cancelledItems = order.items.filter(item => item.status === 'cancel' || item.status === 'out');
        
        // Add cancelled items back to table cart for replacement
        cancelledItems.forEach(item => {
            const existingItem = state.tableOrder.items.find(i => i.id === item.id);
            if (existingItem) {
                existingItem.quantity += item.quantity;
            } else {
                state.tableOrder.items.push({
                    id: item.id,
                    name: item.name,
                    price: item.price,
                    quantity: item.quantity
                });
            }
        });
        
        // Remove cancelled items from order
        order.items = order.items.filter(item => item.status !== 'cancel' && item.status !== 'out');
        
        saveState();
        showNotification('Item yang dibatalkan/habis telah ditambahkan ke keranjang untuk penggantian', 'info');
        renderTableOrder();
        updateTableCart();
    }

    // --- RESERVATION SYSTEM ---
    function renderReservations() {
        const container = document.getElementById('reservation-grid');
        const reservations = state.reservations.sort((a, b) => new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time));
        
        if (reservations.length === 0) {
            container.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">Belum ada reservasi.</p>';
        } else {
            container.innerHTML = reservations.map(reservation => `
                <div class="reservation-card">
                    <div class="reservation-header">
                        <div class="reservation-id">#${reservation.id}</div>
                        <div class="reservation-status ${reservation.status}">${getReservationStatusLabel(reservation.status)}</div>
                    </div>
                    <div class="reservation-details">
                        <div class="reservation-detail"><strong>Nama:</strong> ${reservation.name}</div>
                        <div class="reservation-detail"><strong>Telepon:</strong> ${reservation.phone}</div>
                        <div class="reservation-detail"><strong>Tanggal:</strong> ${new Date(reservation.date).toLocaleDateString('id-ID')}</div>
                        <div class="reservation-detail"><strong>Waktu:</strong> ${reservation.time}</div>
                        <div class="reservation-detail"><strong>Tamu:</strong> ${reservation.guests} orang</div>
                        <div class="reservation-detail"><strong>Meja:</strong> Meja ${reservation.table}</div>
                        ${reservation.notes ? `<div class="reservation-detail"><strong>Catatan:</strong> ${reservation.notes}</div>` : ''}
                        ${reservation.dp ? `<div class="reservation-detail"><strong>DP:</strong> Rp ${reservation.dp.toLocaleString('id-ID')}</div>` : ''}
                    </div>
                    <div class="reservation-actions">
                        ${reservation.status === 'pending' ? `
                            <button class="btn btn-success" onclick="updateReservationStatus(${reservation.id}, 'confirmed')">Datang</button>
                            <button class="btn btn-danger" onclick="updateReservationStatus(${reservation.id}, 'cancelled')">Batal</button>
                        ` : ''}
                        ${reservation.status === 'confirmed' ? `
                            <button class="btn btn-success" onclick="updateReservationStatus(${reservation.id}, 'completed')">Selesai</button>
                        ` : ''}
                        <button class="btn btn-secondary" onclick="editReservation(${reservation.id})">Edit</button>
                        <button class="btn btn-secondary" onclick="printReservationReceipt(${reservation.id})">
                            <i data-lucide="printer"></i> Cetak Nota
                        </button>
                    </div>
                </div>
            `).join('');
        }
        lucide.createIcons();
    }

    function getReservationStatusLabel(status) {
        const statusMap = {
            'pending': 'Menunggu Kedatangan',
            'confirmed': 'Datang',
            'completed': 'Selesai',
            'cancelled': 'Dibatalkan'
        };
        return statusMap[status] || status;
    }

    function openReservationModal(reservationId = null) {
        const modal = document.getElementById('reservation-modal');
        const title = document.getElementById('reservation-modal-title');
        const tableSelect = document.getElementById('reservation-table');
        
        // Populate table select
        tableSelect.innerHTML = '<option value="">Pilih Meja</option>' +
            state.tables.map(table => `<option value="${table.id}">Meja ${table.number} (Kapasitas: ${table.capacity})</option>`).join('');
        
        if (reservationId) {
            const reservation = state.reservations.find(r => r.id === reservationId);
            if (reservation) {
                title.innerText = 'Edit Reservasi';
                document.getElementById('reservation-id').value = reservation.id;
                document.getElementById('reservation-name').value = reservation.name;
                document.getElementById('reservation-phone').value = reservation.phone;
                document.getElementById('reservation-date').value = reservation.date;
                document.getElementById('reservation-time').value = reservation.time;
                document.getElementById('reservation-guests').value = reservation.guests;
                tableSelect.value = reservation.table;
                document.getElementById('reservation-notes').value = reservation.notes || '';
                document.getElementById('reservation-status').value = reservation.status;
                document.getElementById('reservation-dp').value = reservation.dp || '';
            }
        } else {
            title.innerText = 'Tambah Reservasi';
            document.getElementById('reservation-form').reset();
            document.getElementById('reservation-id').value = '';
            // Set default date to today
            document.getElementById('reservation-date').value = new Date().toISOString().split('T')[0];
        }
        
        modal.style.display = 'flex';
    }

    function saveReservation(event) {
        event.preventDefault();
        
        const reservationData = {
            name: document.getElementById('reservation-name').value,
            phone: document.getElementById('reservation-phone').value,
            date: document.getElementById('reservation-date').value,
            time: document.getElementById('reservation-time').value,
            guests: parseInt(document.getElementById('reservation-guests').value),
            table: parseInt(document.getElementById('reservation-table').value),
            notes: document.getElementById('reservation-notes').value,
            status: document.getElementById('reservation-status').value,
            dp: parseInt(document.getElementById('reservation-dp').value) || 0
        };
        
        const reservationId = document.getElementById('reservation-id').value;
        
        if (reservationId) {
            const index = state.reservations.findIndex(r => r.id == reservationId);
            if (index !== -1) {
                state.reservations[index] = { ...state.reservations[index], ...reservationData };
                showNotification('Reservasi berhasil diperbarui!', 'success');
            }
        } else {
            state.reservations.push({
                id: Date.now(),
                ...reservationData
            });
            showNotification('Reservasi berhasil ditambahkan!', 'success');
        }
        
        // Update table status based on reservation
        updateTableStatusFromReservations();
        
        saveState();
        closeModal('reservation-modal');
        renderReservations();
        renderTableManagement();
    }

    function editReservation(reservationId) {
        openReservationModal(reservationId);
    }

    function updateReservationStatus(reservationId, newStatus) {
        const reservation = state.reservations.find(r => r.id === reservationId);
        if (reservation) {
            reservation.status = newStatus;
            saveState();
            showNotification(`Status reservasi #${reservationId} berhasil diperbarui menjadi ${getReservationStatusLabel(newStatus)}`, 'success');
            renderReservations();
            
            // Update table status based on reservation
            updateTableStatusFromReservations();
            renderTableManagement();
        }
    }

    function updateTableStatusFromReservations() {
        // Reset all tables to available first
        state.tables.forEach(table => {
            if (table.status !== 'occupied') {
                table.status = 'available';
            }
        });
        
        // Check for active reservations
        const now = new Date();
        state.reservations.forEach(reservation => {
            if (reservation.status === 'pending' || reservation.status === 'confirmed') {
                const reservationDateTime = new Date(reservation.date + ' ' + reservation.time);
                
                // If reservation is confirmed and time is in the future, mark table as reserved
                if (reservation.status === 'confirmed' && reservationDateTime > now) {
                    const table = state.tables.find(t => t.id === reservation.table);
                    if (table && table.status !== 'occupied') {
                        table.status = 'reserved';
                    }
                }
            }
        });
    }

    function printReservationReceipt(reservationId) {
        const reservation = state.reservations.find(r => r.id === reservationId);
        if (!reservation) return;
        
        const receiptContent = `
            <div class="print-reservation">
                <div class="print-reservation-header">
                    <div class="print-reservation-title">NOTA RESERVASI</div>
                    <div class="print-reservation-subtitle">DNT Network Cafe</div>
                    <div class="print-reservation-subtitle">Jl. Sudirman No. 123</div>
                    <div class="print-reservation-subtitle">Tel: 021-123456</div>
                </div>
                <div class="print-reservation-divider"></div>
                <div class="print-reservation-details">
                    <div class="print-reservation-row">
                        <span>No. Reservasi:</span>
                        <span>#${reservation.id}</span>
                    </div>
                    <div class="print-reservation-row">
                        <span>Nama:</span>
                        <span>${reservation.name}</span>
                    </div>
                    <div class="print-reservation-row">
                        <span>Telepon:</span>
                        <span>${reservation.phone}</span>
                    </div>
                    <div class="print-reservation-row">
                        <span>Tanggal:</span>
                        <span>${new Date(reservation.date).toLocaleDateString('id-ID')}</span>
                    </div>
                    <div class="print-reservation-row">
                        <span>Waktu:</span>
                        <span>${reservation.time}</span>
                    </div>
                    <div class="print-reservation-row">
                        <span>Jumlah Tamu:</span>
                        <span>${reservation.guests} orang</span>
                    </div>
                    <div class="print-reservation-row">
                        <span>Meja:</span>
                        <span>Meja ${reservation.table}</span>
                    </div>
                    ${reservation.notes ? `
                        <div class="print-reservation-row">
                            <span>Catatan:</span>
                            <span>${reservation.notes}</span>
                        </div>
                    ` : ''}
                    ${reservation.dp ? `
                        <div class="print-reservation-row">
                            <span>DP:</span>
                            <span>Rp ${reservation.dp.toLocaleString('id-ID')}</span>
                        </div>
                    ` : ''}
                    <div class="print-reservation-row">
                        <span>Status:</span>
                        <span>${getReservationStatusLabel(reservation.status)}</span>
                    </div>
                </div>
                <div class="print-reservation-divider"></div>
                <div class="print-reservation-footer">
                    <div>Terima kasih atas reservasi Anda</div>
                    <div>Silakan datang 15 menit sebelum waktu reservasi</div>
                </div>
            </div>
        `;
        
        const printWindow = window.open('', '_blank');
        printWindow.document.write(receiptContent);
        printWindow.document.close();
        printWindow.focus();
        printWindow.print();
        printWindow.close();
    }

    function filterReservations() {
        const fromDate = document.getElementById('filter-reservation-date-from').value;
        const toDate = document.getElementById('filter-reservation-date-to').value;
        
        let filteredReservations = state.reservations;
        
        if (fromDate) {
            filteredReservations = filteredReservations.filter(reservation => 
                reservation.date >= fromDate
            );
        }
        
        if (toDate) {
            filteredReservations = filteredReservations.filter(reservation => 
                reservation.date <= toDate
            );
        }
        
        const container = document.getElementById('reservation-grid');
        
        if (filteredReservations.length === 0) {
            container.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">Tidak ada reservasi dalam rentang tanggal yang dipilih.</p>';
        } else {
            container.innerHTML = filteredReservations.map(reservation => `
                <div class="reservation-card">
                    <div class="reservation-header">
                        <div class="reservation-id">#${reservation.id}</div>
                        <div class="reservation-status ${reservation.status}">${getReservationStatusLabel(reservation.status)}</div>
                    </div>
                    <div class="reservation-details">
                        <div class="reservation-detail"><strong>Nama:</strong> ${reservation.name}</div>
                        <div class="reservation-detail"><strong>Telepon:</strong> ${reservation.phone}</div>
                        <div class="reservation-detail"><strong>Tanggal:</strong> ${new Date(reservation.date).toLocaleDateString('id-ID')}</div>
                        <div class="reservation-detail"><strong>Waktu:</strong> ${reservation.time}</div>
                        <div class="reservation-detail"><strong>Tamu:</strong> ${reservation.guests} orang</div>
                        <div class="reservation-detail"><strong>Meja:</strong> Meja ${reservation.table}</div>
                        ${reservation.notes ? `<div class="reservation-detail"><strong>Catatan:</strong> ${reservation.notes}</div>` : ''}
                        ${reservation.dp ? `<div class="reservation-detail"><strong>DP:</strong> Rp ${reservation.dp.toLocaleString('id-ID')}</div>` : ''}
                    </div>
                    <div class="reservation-actions">
                        ${reservation.status === 'pending' ? `
                            <button class="btn btn-success" onclick="updateReservationStatus(${reservation.id}, 'confirmed')">Datang</button>
                            <button class="btn btn-danger" onclick="updateReservationStatus(${reservation.id}, 'cancelled')">Batal</button>
                        ` : ''}
                        ${reservation.status === 'confirmed' ? `
                            <button class="btn btn-success" onclick="updateReservationStatus(${reservation.id}, 'completed')">Selesai</button>
                        ` : ''}
                        <button class="btn btn-secondary" onclick="editReservation(${reservation.id})">Edit</button>
                        <button class="btn btn-secondary" onclick="printReservationReceipt(${reservation.id})">
                            <i data-lucide="printer"></i> Cetak Nota
                        </button>
                    </div>
                </div>
            `).join('');
        }
        lucide.createIcons();
    }

    // --- MENU MANAGEMENT ---
    function renderMenuManagement() {
        const menuList = document.getElementById('menu-list');
        if (state.menu.length === 0) {
            menuList.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">Belum ada menu.</p>';
        } else {
            menuList.innerHTML = state.menu.map(item => `
                <div class="menu-item-card">
                    <div class="menu-item-with-image">
                        <div class="menu-image-container">
                            ${item.image ? 
                                `<img src="${item.image}" alt="${item.name}" class="menu-image">` : 
                                `<div class="menu-image-placeholder"><i data-lucide="image"></i></div>`
                            }
                        </div>
                        <div class="menu-item-info">
                            <h4>${item.name} ${item.isBestSeller ? '⭐' : ''} ${item.outOfStock ? '(Habis)' : ''}</h4>
                            <p>${item.category} - Rp ${item.price.toLocaleString('id-ID')}</p>
                            <p style="font-size: 0.8rem; margin-top: 0.5rem;">${item.description || 'Tidak ada deskripsi'}</p>
                        </div>
                    </div>
                    <div class="menu-item-actions">
                        <button class="btn btn-secondary" onclick="editMenuItem(${item.id})"><i data-lucide="edit"></i></button>
                        <button class="btn btn-danger" onclick="deleteMenuItem(${item.id})"><i data-lucide="trash-2"></i></button>
                    </div>
                </div>
            `).join('');
        }
        lucide.createIcons();
    }

    function openMenuModal(itemId = null) {
        const modal = document.getElementById('menu-modal');
        const title = document.getElementById('menu-modal-title');
        const ingredientsList = document.getElementById('menu-ingredients-list');
        
        // Populate ingredients list
        if (!ingredientsList.innerHTML) {
            addMenuIngredientField();
        }
        
        if (itemId) {
            const menuItem = state.menu.find(item => item.id === itemId);
            if (menuItem) {
                title.innerText = 'Edit Menu';
                document.getElementById('menu-id').value = menuItem.id;
                document.getElementById('menu-name').value = menuItem.name;
                document.getElementById('menu-category').value = menuItem.category;
                document.getElementById('menu-price').value = menuItem.price;
                document.getElementById('menu-description').value = menuItem.description || '';
                
                // Show image preview if exists
                if (menuItem.image) {
                    document.getElementById('menu-image-preview').innerHTML = 
                        `<img src="${menuItem.image}" alt="Preview" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px;">`;
                }
                
                // Populate ingredients
                ingredientsList.innerHTML = '';
                if (menuItem.ingredients && menuItem.ingredients.length > 0) {
                    menuItem.ingredients.forEach(ingredient => {
                        addMenuIngredientField(ingredient);
                    });
                } else {
                    addMenuIngredientField();
                }
            }
        } else {
            title.innerText = 'Tambah Menu';
            document.getElementById('menu-form').reset();
            document.getElementById('menu-id').value = '';
            document.getElementById('menu-image-preview').innerHTML = '';
            ingredientsList.innerHTML = '';
            addMenuIngredientField();
        }
        
        modal.style.display = 'flex';
    }

    function addMenuIngredientField(existingIngredient = null) {
        const ingredientsList = document.getElementById('menu-ingredients-list');
        const ingredientId = Date.now();
        
        // Create stock options
        const stockOptions = state.stockOpname.map(item => 
            `<option value="${item.name}" ${existingIngredient && existingIngredient.name === item.name ? 'selected' : ''}>${item.name}</option>`
        ).join('');
        
        const ingredientField = document.createElement('div');
        ingredientField.className = 'form-group';
        ingredientField.id = `ingredient-${ingredientId}`;
        ingredientField.innerHTML = `
            <div style="display: flex; gap: 0.5rem; align-items: center;">
                <select style="flex: 2;" onchange="updateIngredientUnit(${ingredientId})">
                    <option value="">Pilih Bahan</option>
                    ${stockOptions}
                </select>
                <input type="number" placeholder="Jumlah" style="flex: 1;" min="0" step="0.01" value="${existingIngredient ? existingIngredient.quantity : ''}">
                <span style="flex: 1;">${existingIngredient ? existingIngredient.unit : 'unit'}</span>
                <button type="button" class="btn btn-danger" onclick="removeMenuIngredientField(${ingredientId})">
                    <i data-lucide="trash-2"></i>
                </button>
            </div>
        `;
        
        ingredientsList.appendChild(ingredientField);
        lucide.createIcons();
    }

    function removeMenuIngredientField(ingredientId) {
        const ingredientField = document.getElementById(`ingredient-${ingredientId}`);
        if (ingredientField) {
            ingredientField.remove();
        }
    }

    function updateIngredientUnit(ingredientId) {
        const ingredientField = document.getElementById(`ingredient-${ingredientId}`);
        const select = ingredientField.querySelector('select');
        const unitSpan = ingredientField.querySelector('span');
        
        if (select.value) {
            const stockItem = state.stockOpname.find(item => item.name === select.value);
            if (stockItem) {
                unitSpan.textContent = stockItem.unit;
            }
        } else {
            unitSpan.textContent = 'unit';
        }
    }

    function saveMenuItem(event) {
        event.preventDefault();
        
        const menuItem = {
            name: document.getElementById('menu-name').value,
            category: document.getElementById('menu-category').value,
            price: parseInt(document.getElementById('menu-price').value),
            description: document.getElementById('menu-description').value,
            ingredients: []
        };
        
        // Collect ingredients
        const ingredientFields = document.querySelectorAll('#menu-ingredients-list > div');
        ingredientFields.forEach(field => {
            const select = field.querySelector('select');
            const quantityInput = field.querySelector('input[type="number"]');
            
            if (select.value && quantityInput.value) {
                const stockItem = state.stockOpname.find(item => item.name === select.value);
                if (stockItem) {
                    menuItem.ingredients.push({
                        id: stockItem.id,
                        name: stockItem.name,
                        quantity: parseFloat(quantityInput.value),
                        unit: stockItem.unit
                    });
                }
            }
        });
        
        const menuId = document.getElementById('menu-id').value;
        
        // Handle image upload
        const imageInput = document.getElementById('menu-image');
        if (imageInput.files && imageInput.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                menuItem.image = e.target.result;
                saveMenuItemData(menuId, menuItem);
            };
            reader.readAsDataURL(imageInput.files[0]);
        } else {
            // Keep existing image if editing
            if (menuId) {
                const existingItem = state.menu.find(item => item.id == menuId);
                if (existingItem && existingItem.image) {
                    menuItem.image = existingItem.image;
                }
            }
            saveMenuItemData(menuId, menuItem);
        }
    }

    function saveMenuItemData(menuId, menuItem) {
        if (menuId) {
            const index = state.menu.findIndex(item => item.id == menuId);
            if (index !== -1) {
                state.menu[index] = { ...state.menu[index], ...menuItem };
                showNotification('Menu berhasil diperbarui!', 'success');
            }
        } else {
            state.menu.push({
                id: Date.now(),
                ...menuItem,
                isBestSeller: false,
                outOfStock: false
            });
            showNotification('Menu berhasil ditambahkan!', 'success');
        }
        
        // Check if menu can be made with current stock
        checkAndUpdateMenuStock();
        
        saveState();
        closeModal('menu-modal');
        renderMenuManagement();
        renderPOS();
        renderTableOrder();
    }

    function editMenuItem(itemId) {
        openMenuModal(itemId);
    }

    function deleteMenuItem(itemId) {
        if (confirm('Apakah Anda yakin ingin menghapus menu ini?')) {
            state.menu = state.menu.filter(item => item.id !== itemId);
            saveState();
            showNotification('Menu berhasil dihapus!', 'success');
            renderMenuManagement();
            renderPOS();
            renderTableOrder();
        }
    }

    // --- TABLE MANAGEMENT ---
    function renderTableManagement() {
        const tableGrid = document.getElementById('table-management-grid');
        if (state.tables.length === 0) {
            tableGrid.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">Belum ada meja.</p>';
        } else {
            tableGrid.innerHTML = state.tables.map(table => {
                // Check if table has active reservation
                const hasReservation = state.reservations.some(r => 
                    r.table === table.id && (r.status === 'pending' || r.status === 'confirmed')
                );
                
                return `
                    <div class="table-management-card ${table.status} ${hasReservation ? 'reserved' : ''}">
                        <div class="table-number">Meja ${table.number}</div>
                        <div class="table-status">Kapasitas: ${table.capacity} orang</div>
                        <div class="table-status">${
                            table.status === 'available' ? 'Tersedia' : 
                            table.status === 'occupied' ? 'Terisi' : 
                            table.status === 'reserved' ? 'Direservasi' : table.status
                        }</div>
                        <div class="table-actions">
                            ${state.currentUser.role === 'cashier' || state.currentUser.role === 'admin' ? 
                                `<button class="btn btn-secondary" onclick="changeTableStatus(${table.id})">Ubah Status</button>` : 
                                ''
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }
        lucide.createIcons();
    }

    function changeTableStatus(tableId) {
        const table = state.tables.find(t => t.id === tableId);
        if (!table) return;
        
        // Don't allow status change if table has active reservation
        const hasReservation = state.reservations.some(r => 
            r.table === tableId && (r.status === 'pending' || r.status === 'confirmed')
        );
        
        if (hasReservation) {
            showNotification('Meja ini memiliki reservasi aktif!', 'warning');
            return;
        }
        
        // Cycle through available statuses
        if (table.status === 'available') {
            table.status = 'occupied';
        } else if (table.status === 'occupied') {
            table.status = 'available';
        }
        
        saveState();
        showNotification(`Status Meja ${table.number} berhasil diubah menjadi ${table.status === 'available' ? 'Tersedia' : 'Terisi'}`, 'success');
        renderTableManagement();
    }

    // --- ORDER HISTORY ---
    function renderOrderHistory() {
        renderSalesChart();
        renderBestSellingItems();
        
        const historyTableBody = document.getElementById('history-table-body');
        const orders = state.orders.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        
        if (orders.length === 0) {
            historyTableBody.innerHTML = '<tr><td colspan="7" style="text-align:center; color: var(--text-secondary);">Belum ada riwayat pesanan.</td></tr>';
        } else {
            historyTableBody.innerHTML = orders.map(order => `
                <tr>
                    <td>#${order.id}</td>
                    <td>${new Date(order.timestamp).toLocaleDateString('id-ID')}</td>
                    <td>${order.tableId === 0 ? 'Take Away' : `Meja ${order.tableId}`}</td>
                    <td>${order.type}</td>
                    <td>Rp ${order.total.toLocaleString('id-ID')}</td>
                    <td>${getStatusLabel(order.status)}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteOrder(${order.id})"><i data-lucide="trash-2"></i></button>
                    </td>
                </tr>
            `).join('');
        }
    }

    function renderSalesChart() {
        const ctx = document.getElementById('sales-chart');
        if (!ctx) return;
        
        // Generate data for the last 7 days
        const labels = [];
        const data = [];
        
        for (let i = 6; i >= 0; i--) {
            const date = new Date();
            date.setDate(date.getDate() - i);
            const dateStr = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short' });
            labels.push(dateStr);
            
            const dayOrders = state.orders.filter(order => {
                const orderDate = new Date(order.timestamp);
                return orderDate.toDateString() === date.toDateString();
            });
            
            const dayRevenue = dayOrders.reduce((sum, order) => sum + (order.total || 0), 0);
            data.push(dayRevenue);
        }
        
        // Destroy existing chart if it exists
        if (window.salesChart) {
            window.salesChart.destroy();
        }
        
        // Create new chart
        window.salesChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Penjualan Harian',
                    data: data,
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderColor: 'rgba(59, 130, 246, 1)',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return 'Rp ' + value.toLocaleString('id-ID');
                            }
                        }
                    }
                }
            }
        });
    }

    function renderBestSellingItems() {
        const container = document.getElementById('best-selling-items');
        
        // Calculate best selling items
        const itemSales = {};
        state.orders.forEach(order => {
            order.items.forEach(item => {
                if (!itemSales[item.name]) {
                    itemSales[item.name] = 0;
                }
                itemSales[item.name] += item.quantity;
            });
        });
        
        const bestSelling = Object.entries(itemSales)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 5);
        
        if (bestSelling.length === 0) {
            container.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">Belum ada data penjualan.</p>';
        } else {
            container.innerHTML = bestSelling.map((item, index) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 0.5rem;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span style="font-size: 1.5rem; font-weight: 700; color: var(--accent-primary);">${index + 1}</span>
                        <div>
                            <div style="font-weight: 600;">${item[0]}</div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);">Terjual: ${item[1]} pcs</div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 600; color: var(--accent-primary);">
                            Rp ${(item[1] * (state.menu.find(m => m.name === item[0])?.price || 0)).toLocaleString('id-ID')}
                        </div>
                    </div>
                </div>
            `).join('');
        }
    }

    function filterOrderHistory() {
        const fromDate = document.getElementById('filter-date-from').value;
        const toDate = document.getElementById('filter-date-to').value;
        
        let filteredOrders = state.orders;
        
        if (fromDate) {
            filteredOrders = filteredOrders.filter(order => 
                new Date(order.timestamp) >= new Date(fromDate)
            );
        }
        
        if (toDate) {
            filteredOrders = filteredOrders.filter(order => 
                new Date(order.timestamp) <= new Date(toDate + 'T23:59:59')
            );
        }
        
        const historyTableBody = document.getElementById('history-table-body');
        
        if (filteredOrders.length === 0) {
            historyTableBody.innerHTML = '<tr><td colspan="7" style="text-align:center; color: var(--text-secondary);">Tidak ada pesanan dalam rentang tanggal yang dipilih.</td></tr>';
        } else {
            historyTableBody.innerHTML = filteredOrders.map(order => `
                <tr>
                    <td>#${order.id}</td>
                    <td>${new Date(order.timestamp).toLocaleDateString('id-ID')}</td>
                    <td>${order.tableId === 0 ? 'Take Away' : `Meja ${order.tableId}`}</td>
                    <td>${order.type}</td>
                    <td>Rp ${order.total.toLocaleString('id-ID')}</td>
                    <td>${getStatusLabel(order.status)}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteOrder(${order.id})"><i data-lucide="trash-2"></i></button>
                    </td>
                </tr>
            `).join('');
        }
    }

    function exportOrderHistory() {
        const fromDate = document.getElementById('filter-date-from').value;
        const toDate = document.getElementById('filter-date-to').value;
        
        let filteredOrders = state.orders;
        
        if (fromDate) {
            filteredOrders = filteredOrders.filter(order => 
                new Date(order.timestamp) >= new Date(fromDate)
            );
        }
        
        if (toDate) {
            filteredOrders = filteredOrders.filter(order => 
                new Date(order.timestamp) <= new Date(toDate + 'T23:59:59')
            );
        }
        
        let csvContent = "ID Pesanan,Tanggal,Meja,Tipe,Total,Status\n";
        
        filteredOrders.forEach(order => {
            const row = [
                `#${order.id}`,
                new Date(order.timestamp).toLocaleDateString('id-ID'),
                order.tableId === 0 ? 'Take Away' : `Meja ${order.tableId}`,
                order.type,
                `Rp ${order.total.toLocaleString('id-ID')}`,
                getStatusLabel(order.status)
            ].join(',');
            
            csvContent += row + '\n';
        });
        
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.setAttribute('href', url);
        link.setAttribute('download', `order_history_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showNotification('Data riwayat pesanan berhasil diexport!', 'success');
    }

    function deleteOrder(orderId) {
        if (confirm('Apakah Anda yakin ingin menghapus pesanan ini?')) {
            state.orders = state.orders.filter(o => o.id !== orderId);
            saveState();
            showNotification('Pesanan berhasil dihapus!', 'success');
            renderOrderHistory();
            renderDashboard();
        }
    }

    // --- USER MANAGEMENT ---
    function renderUserManagement() {
        const container = document.getElementById('user-list');
        if (state.users.length === 0) {
            container.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">Belum ada pengguna.</p>';
        } else {
            container.innerHTML = state.users.map(user => `
                <div class="user-card">
                    <div class="user-info-card">
                        <div class="user-avatar-large">${user.name.charAt(0)}</div>
                        <div class="user-details">
                            <h4>${user.name}</h4>
                            <p>${user.email}</p>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span class="user-role-badge role-${user.role}">${getRoleLabel(user.role)}</span>
                        <div class="menu-item-actions">
                            <button class="btn btn-secondary" onclick="editUser(${user.id})">
                                <i data-lucide="edit"></i>
                            </button>
                            ${user.id !== 1 ? `
                                <button class="btn btn-danger" onclick="deleteUser(${user.id})">
                                    <i data-lucide="trash-2"></i>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Render position list
        renderPositionList();
        
        lucide.createIcons();
    }

    function renderPositionList() {
        const positionList = document.getElementById('position-list');
        positionList.innerHTML = state.positions.map(position => `
            <div class="position-badge">
                <span>${position.name}</span>
                <button onclick="removePosition(${position.id})">
                    <i data-lucide="x"></i>
                </button>
            </div>
        `).join('');
    }

    function addPosition() {
        const positionName = document.getElementById('new-position').value.trim();
        
        if (!positionName) {
            showNotification('Nama posisi tidak boleh kosong!', 'warning');
            return;
        }
        
        // Check if position already exists
        if (state.positions.some(p => p.name.toLowerCase() === positionName.toLowerCase())) {
            showNotification('Posisi ini sudah ada!', 'warning');
            return;
        }
        
        state.positions.push({
            id: Date.now(),
            name: positionName
        });
        
        document.getElementById('new-position').value = '';
        saveState();
        renderPositionList();
        showNotification('Posisi berhasil ditambahkan!', 'success');
    }

    function removePosition(positionId) {
        if (confirm('Apakah Anda yakin ingin menghapus posisi ini?')) {
            state.positions = state.positions.filter(p => p.id !== positionId);
            saveState();
            renderPositionList();
            showNotification('Posisi berhasil dihapus!', 'success');
        }
    }

    function openUserModal(userId = null) {
        const modal = document.getElementById('user-modal');
        const title = document.getElementById('user-modal-title');
        const roleSelect = document.getElementById('user-role');
        
        // Populate role select with positions
        roleSelect.innerHTML = state.positions.map(position => 
            `<option value="${position.name.toLowerCase()}">${position.name}</option>`
        ).join('');
        
        if (userId) {
            const user = state.users.find(u => u.id === userId);
            if (user) {
                title.innerText = 'Edit Pengguna';
                document.getElementById('user-id').value = user.id;
                document.getElementById('user-name-input').value = user.name;
                document.getElementById('user-email').value = user.email;
                roleSelect.value = user.role;
                document.getElementById('user-password').value = user.password;
            }
        } else {
            title.innerText = 'Tambah Pengguna';
            document.getElementById('user-form').reset();
            document.getElementById('user-id').value = '';
        }
        
        modal.style.display = 'flex';
    }

    function saveUser(event) {
        event.preventDefault();
        
        if (!checkLicenseLimits('user')) return;
        
        const userData = {
            name: document.getElementById('user-name-input').value,
            email: document.getElementById('user-email').value,
            role: document.getElementById('user-role').value,
            password: document.getElementById('user-password').value
        };
        
        const userId = document.getElementById('user-id').value;
        
        if (userId) {
            const index = state.users.findIndex(u => u.id == userId);
            if (index !== -1) {
                state.users[index] = { ...state.users[index], ...userData };
                showNotification('Pengguna berhasil diperbarui!', 'success');
            }
        } else {
            if (state.users.some(u => u.email === userData.email)) {
                showNotification('Email sudah terdaftar!', 'error');
                return;
            }
            
            state.users.push({
                id: Date.now(),
                ...userData
            });
            showNotification('Pengguna berhasil ditambahkan!', 'success');
        }
        
        saveState();
        closeModal('user-modal');
        renderUserManagement();
    }

    function editUser(userId) {
        openUserModal(userId);
    }

    function deleteUser(userId) {
        if (confirm('Apakah Anda yakin ingin menghapus pengguna ini?')) {
            state.users = state.users.filter(u => u.id !== userId);
            saveState();
            showNotification('Pengguna berhasil dihapus!', 'success');
            renderUserManagement();
        }
    }

    // --- STOCK OPNAME (INVENTORY MANAGEMENT) ---
    function renderStockOpname() {
        renderLowStockAlerts();
        renderStockOpnameTable();
        renderStockOpnameGrid();
        updateStockSummary();
    }

    function renderLowStockAlerts() {
        const container = document.getElementById('low-stock-alerts');
        const lowStockItems = state.stockOpname.filter(item => item.quantity <= item.minStock);
        
        if (lowStockItems.length === 0) {
            container.innerHTML = '';
        } else {
            container.innerHTML = `
                <div class="low-stock-alert">
                    <div class="low-stock-alert-icon">
                        <i data-lucide="alert-triangle"></i>
                    </div>
                    <div class="low-stock-alert-content">
                        <div class="low-stock-alert-title">Peringatan Stok Menipis</div>
                        <div class="low-stock-alert-text">
                            ${lowStockItems.length} item dengan stok rendah: ${lowStockItems.map(item => item.name).join(', ')}
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }
    }

    function renderStockOpnameTable() {
        const tableBody = document.getElementById('stock-opname-table-body');
        
        if (state.stockOpname.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="8" style="text-align:center; color: var(--text-secondary);">Belum ada barang.</td></tr>';
        } else {
            tableBody.innerHTML = state.stockOpname.map(item => {
                let statusClass = 'status-good';
                let statusText = 'Stok Aman';
                
                if (item.quantity <= 0) {
                    statusClass = 'status-out';
                    statusText = 'Habis';
                } else if (item.quantity <= item.minStock) {
                    statusClass = 'status-low';
                    statusText = 'Stok Rendah';
                }
                
                return `
                    <tr>
                        <td>${item.code}</td>
                        <td>${item.name}</td>
                        <td>${item.category}</td>
                        <td>${item.quantity} ${item.unit}</td>
                        <td>${item.unit}</td>
                        <td>${item.minStock} ${item.unit}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div class="stock-opname-status-indicator ${statusClass}"></div>
                                <div>${statusText}</div>
                            </div>
                        </td>
                        <td>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-secondary" onclick="editStockOpnameItem(${item.id})" style="padding: 0.25rem 0.5rem;">
                                    <i data-lucide="edit" style="width: 14px; height: 14px;"></i>
                                </button>
                                <button class="btn btn-danger" onclick="deleteStockOpnameItem(${item.id})" style="padding: 0.25rem 0.5rem;">
                                    <i data-lucide="trash-2" style="width: 14px; height: 14px;"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
    }

    function updateStockSummary() {
        const totalItems = state.stockOpname.length;
        const goodStock = state.stockOpname.filter(item => item.quantity > item.minStock).length;
        const lowStock = state.stockOpname.filter(item => item.quantity > 0 && item.quantity <= item.minStock).length;
        const outStock = state.stockOpname.filter(item => item.quantity <= 0).length;
        
        document.getElementById('total-items').textContent = totalItems;
        document.getElementById('good-stock').textContent = goodStock;
        document.getElementById('low-stock').textContent = lowStock;
        document.getElementById('out-stock').textContent = outStock;
    }

    function renderStockOpnameGrid() {
        const stockOpnameGrid = document.getElementById('stock-opname-grid');
        if (state.stockOpname.length === 0) {
            stockOpnameGrid.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">Belum ada barang.</p>';
        } else {
            stockOpnameGrid.innerHTML = state.stockOpname.map(item => {
                let statusClass = 'status-good';
                let statusText = 'Stok Aman';
                
                if (item.quantity <= 0) {
                    statusClass = 'status-out';
                    statusText = 'Habis';
                } else if (item.quantity <= item.minStock) {
                    statusClass = 'status-low';
                    statusText = 'Stok Rendah';
                }
                
                return `
                    <div class="stock-opname-card">
                        <div class="stock-opname-header">
                            <div class="stock-opname-name">${item.name}</div>
                            <div class="stock-opname-category">${item.category}</div>
                        </div>
                        <div class="stock-opname-details">
                            <div class="stock-opname-detail">
                                <span class="stock-opname-detail-label">Stok Saat Ini:</span>
                                <span class="stock-opname-detail-value">${item.quantity} ${item.unit}</span>
                            </div>
                            <div class="stock-opname-detail">
                                <span class="stock-opname-detail-label">Stok Minimum:</span>
                                <span class="stock-opname-detail-value">${item.minStock} ${item.unit}</span>
                            </div>
                            <div class="stock-opname-detail">
                                <span class="stock-opname-detail-label">Harga Beli:</span>
                                <span class="stock-opname-detail-value">Rp ${item.price.toLocaleString('id-ID')}</span>
                            </div>
                            <div class="stock-opname-detail">
                                <span class="stock-opname-detail-label">Supplier:</span>
                                <span class="stock-opname-detail-value">${item.supplier || '-'}</span>
                            </div>
                        </div>
                        <div class="stock-opname-status">
                            <div class="stock-opname-status-indicator ${statusClass}"></div>
                            <div>${statusText}</div>
                        </div>
                        <div class="stock-opname-actions">
                            <button class="btn btn-secondary" onclick="editStockOpnameItem(${item.id})" style="flex-grow: 1;">
                                <i data-lucide="edit"></i> Edit
                            </button>
                            <button class="btn btn-danger" onclick="deleteStockOpnameItem(${item.id})" style="flex-grow: 1;">
                                <i data-lucide="trash-2"></i> Hapus
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        lucide.createIcons();
    }

    function filterStockOpnameByCategory(category, button) {
        document.querySelectorAll('#stock-opname-category-tabs .category-tab').forEach(tab => tab.classList.remove('active'));
        button.classList.add('active');
        
        const stockOpnameGrid = document.getElementById('stock-opname-grid');
        const itemsToRender = category === 'all' ? state.stockOpname : state.stockOpname.filter(item => item.category === category);
        
        if (itemsToRender.length === 0) {
            stockOpnameGrid.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">Tidak ada barang dalam kategori ini.</p>';
        } else {
            stockOpnameGrid.innerHTML = itemsToRender.map(item => {
                let statusClass = 'status-good';
                let statusText = 'Stok Aman';
                
                if (item.quantity <= 0) {
                    statusClass = 'status-out';
                    statusText = 'Habis';
                } else if (item.quantity <= item.minStock) {
                    statusClass = 'status-low';
                    statusText = 'Stok Rendah';
                }
                
                return `
                    <div class="stock-opname-card">
                        <div class="stock-opname-header">
                            <div class="stock-opname-name">${item.name}</div>
                            <div class="stock-opname-category">${item.category}</div>
                        </div>
                        <div class="stock-opname-details">
                            <div class="stock-opname-detail">
                                <span class="stock-opname-detail-label">Stok Saat Ini:</span>
                                <span class="stock-opname-detail-value">${item.quantity} ${item.unit}</span>
                            </div>
                            <div class="stock-opname-detail">
                                <span class="stock-opname-detail-label">Stok Minimum:</span>
                                <span class="stock-opname-detail-value">${item.minStock} ${item.unit}</span>
                            </div>
                            <div class="stock-opname-detail">
                                <span class="stock-opname-detail-label">Harga Beli:</span>
                                <span class="stock-opname-detail-value">Rp ${item.price.toLocaleString('id-ID')}</span>
                            </div>
                            <div class="stock-opname-detail">
                                <span class="stock-opname-detail-label">Supplier:</span>
                                <span class="stock-opname-detail-value">${item.supplier || '-'}</span>
                            </div>
                        </div>
                        <div class="stock-opname-status">
                            <div class="stock-opname-status-indicator ${statusClass}"></div>
                            <div>${statusText}</div>
                        </div>
                        <div class="stock-opname-actions">
                            <button class="btn btn-secondary" onclick="editStockOpnameItem(${item.id})" style="flex-grow: 1;">
                                <i data-lucide="edit"></i> Edit
                            </button>
                            <button class="btn btn-danger" onclick="deleteStockOpnameItem(${item.id})" style="flex-grow: 1;">
                                <i data-lucide="trash-2"></i> Hapus
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        lucide.createIcons();
    }

    function openStockOpnameModal(itemId = null) {
        const modal = document.getElementById('stock-opname-modal');
        const title = document.getElementById('stock-opname-modal-title');
        
        if (itemId) {
            const item = state.stockOpname.find(i => i.id === itemId);
            if (item) {
                title.innerText = 'Edit Barang';
                document.getElementById('stock-opname-id').value = item.id;
                document.getElementById('stock-opname-code').value = item.code;
                document.getElementById('stock-opname-name').value = item.name;
                document.getElementById('stock-opname-category').value = item.category;
                document.getElementById('stock-opname-quantity').value = item.quantity;
                document.getElementById('stock-opname-unit').value = item.unit;
                document.getElementById('stock-opname-min-stock').value = item.minStock;
                document.getElementById('stock-opname-price').value = item.price;
                document.getElementById('stock-opname-supplier').value = item.supplier || '';
            }
        } else {
            title.innerText = 'Tambah Barang';
            document.getElementById('stock-opname-form').reset();
            document.getElementById('stock-opname-id').value = '';
            // Auto-generate item code
            const maxCode = Math.max(...state.stockOpname.map(item => {
                const codeNum = parseInt(item.code.replace(/\D/g, ''));
                return isNaN(codeNum) ? 0 : codeNum;
            }), 0);
            document.getElementById('stock-opname-code').value = `IT${String(maxCode + 1).padStart(3, '0')}`;
        }
        
        modal.style.display = 'flex';
    }

    function saveStockOpnameItem(event) {
        event.preventDefault();
        
        const itemData = {
            code: document.getElementById('stock-opname-code').value,
            name: document.getElementById('stock-opname-name').value,
            category: document.getElementById('stock-opname-category').value,
            quantity: parseInt(document.getElementById('stock-opname-quantity').value),
            unit: document.getElementById('stock-opname-unit').value,
            minStock: parseInt(document.getElementById('stock-opname-min-stock').value),
            price: parseInt(document.getElementById('stock-opname-price').value),
            supplier: document.getElementById('stock-opname-supplier').value
        };
        
        const itemId = document.getElementById('stock-opname-id').value;
        
        if (itemId) {
            const index = state.stockOpname.findIndex(item => item.id == itemId);
            if (index !== -1) {
                state.stockOpname[index] = { ...state.stockOpname[index], ...itemData };
                showNotification('Barang berhasil diperbarui!', 'success');
            }
        } else {
            state.stockOpname.push({
                id: Date.now(),
                ...itemData
            });
            showNotification('Barang berhasil ditambahkan!', 'success');
        }
        
        // Check if menu items can be made with updated stock
        checkAndUpdateMenuStock();
        
        saveState();
        closeModal('stock-opname-modal');
        renderStockOpname();
    }

    function editStockOpnameItem(itemId) {
        openStockOpnameModal(itemId);
    }

    function deleteStockOpnameItem(itemId) {
        if (confirm('Apakah Anda yakin ingin menghapus barang ini?')) {
            state.stockOpname = state.stockOpname.filter(item => item.id !== itemId);
            saveState();
            showNotification('Barang berhasil dihapus!', 'success');
            renderStockOpname();
        }
    }

    // --- ASSET MANAGEMENT ---
    function renderAssetManagement() {
        renderAssetGrid();
    }

    function renderAssetGrid() {
        const assetGrid = document.getElementById('asset-grid');
        if (state.assets.length === 0) {
            assetGrid.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">Belum ada aset.</p>';
        } else {
            assetGrid.innerHTML = state.assets.map(asset => `
                <div class="asset-card">
                    ${asset.image ? `<img src="${asset.image}" alt="${asset.name}" class="asset-image">` : ''}
                    <div class="asset-name">${asset.name}</div>
                    <div class="asset-category">${asset.category}</div>
                    <div class="asset-details">
                        <div>Jumlah: ${asset.quantity} ${asset.lostQuantity > 0 ? `(${asset.lostQuantity} hilang)` : ''}</div>
                        <div>Tanggal Beli: ${new Date(asset.purchaseDate).toLocaleDateString('id-ID')}</div>
                    </div>
                    <div class="asset-details">
                        <div>Harga: Rp ${asset.price.toLocaleString('id-ID')}</div>
                        <div>Nilai Saat Ini: Rp ${asset.currentValue.toLocaleString('id-ID')}</div>
                    </div>
                    <div class="asset-details">
                        <div>Lokasi: ${asset.location}</div>
                        <div>Status: ${asset.status}</div>
                    </div>
                    <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                        <button class="btn btn-secondary" onclick="editAsset(${asset.id})" style="flex-grow: 1;">
                            <i data-lucide="edit"></i> Edit
                        </button>
                        <button class="btn btn-danger" onclick="deleteAsset(${asset.id})" style="flex-grow: 1;">
                            <i data-lucide="trash-2"></i> Hapus
                        </button>
                    </div>
                </div>
            `).join('');
        }
        lucide.createIcons();
    }

    function filterAssetsByCategory(category, button) {
        document.querySelectorAll('#asset-category-tabs .category-tab').forEach(tab => tab.classList.remove('active'));
        button.classList.add('active');
        
        const assetGrid = document.getElementById('asset-grid');
        const assetsToRender = category === 'all' ? state.assets : state.assets.filter(asset => asset.category === category);
        
        if (assetsToRender.length === 0) {
            assetGrid.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">Tidak ada aset dalam kategori ini.</p>';
        } else {
            assetGrid.innerHTML = assetsToRender.map(asset => `
                <div class="asset-card">
                    ${asset.image ? `<img src="${asset.image}" alt="${asset.name}" class="asset-image">` : ''}
                    <div class="asset-name">${asset.name}</div>
                    <div class="asset-category">${asset.category}</div>
                    <div class="asset-details">
                        <div>Jumlah: ${asset.quantity} ${asset.lostQuantity > 0 ? `(${asset.lostQuantity} hilang)` : ''}</div>
                        <div>Tanggal Beli: ${new Date(asset.purchaseDate).toLocaleDateString('id-ID')}</div>
                    </div>
                    <div class="asset-details">
                        <div>Harga: Rp ${asset.price.toLocaleString('id-ID')}</div>
                        <div>Nilai Saat Ini: Rp ${asset.currentValue.toLocaleString('id-ID')}</div>
                    </div>
                    <div class="asset-details">
                        <div>Lokasi: ${asset.location}</div>
                        <div>Status: ${asset.status}</div>
                    </div>
                    <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                        <button class="btn btn-secondary" onclick="editAsset(${asset.id})" style="flex-grow: 1;">
                            <i data-lucide="edit"></i> Edit
                        </button>
                        <button class="btn btn-danger" onclick="deleteAsset(${asset.id})" style="flex-grow: 1;">
                            <i data-lucide="trash-2"></i> Hapus
                        </button>
                    </div>
                </div>
            `).join('');
        }
        lucide.createIcons();
    }

    function openAssetModal(assetId = null) {
        const modal = document.getElementById('asset-modal');
        const title = document.getElementById('asset-modal-title');
        
        if (assetId) {
            const asset = state.assets.find(a => a.id === assetId);
            if (asset) {
                title.innerText = 'Edit Aset';
                document.getElementById('asset-id').value = asset.id;
                document.getElementById('asset-name').value = asset.name;
                document.getElementById('asset-category').value = asset.category;
                document.getElementById('asset-quantity').value = asset.quantity;
                document.getElementById('asset-purchase-date').value = asset.purchaseDate;
                document.getElementById('asset-price').value = asset.price;
                document.getElementById('asset-current-value').value = asset.currentValue;
                document.getElementById('asset-location').value = asset.location;
                document.getElementById('asset-status').value = asset.status;
                document.getElementById('asset-lost-quantity').value = asset.lostQuantity || 0;
                
                // Show image preview if exists
                if (asset.image) {
                    document.getElementById('asset-image-preview').innerHTML = 
                        `<img src="${asset.image}" alt="Preview" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px;">`;
                }
            }
        } else {
            title.innerText = 'Tambah Aset';
            document.getElementById('asset-form').reset();
            document.getElementById('asset-id').value = '';
            document.getElementById('asset-image-preview').innerHTML = '';
        }
        
        modal.style.display = 'flex';
    }

    function saveAsset(event) {
        event.preventDefault();
        
        const assetData = {
            name: document.getElementById('asset-name').value,
            category: document.getElementById('asset-category').value,
            quantity: parseInt(document.getElementById('asset-quantity').value),
            purchaseDate: document.getElementById('asset-purchase-date').value,
            price: parseInt(document.getElementById('asset-price').value),
            currentValue: parseInt(document.getElementById('asset-current-value').value),
            location: document.getElementById('asset-location').value,
            status: document.getElementById('asset-status').value,
            lostQuantity: parseInt(document.getElementById('asset-lost-quantity').value) || 0
        };
        
        const assetId = document.getElementById('asset-id').value;
        
        // Handle image upload
        const imageInput = document.getElementById('asset-image');
        if (imageInput.files && imageInput.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                assetData.image = e.target.result;
                saveAssetData(assetId, assetData);
            };
            reader.readAsDataURL(imageInput.files[0]);
        } else {
            // Keep existing image if editing
            if (assetId) {
                const existingAsset = state.assets.find(asset => asset.id == assetId);
                if (existingAsset && existingAsset.image) {
                    assetData.image = existingAsset.image;
                }
            }
            saveAssetData(assetId, assetData);
        }
    }

    function saveAssetData(assetId, assetData) {
        if (assetId) {
            const index = state.assets.findIndex(asset => asset.id == assetId);
            if (index !== -1) {
                state.assets[index] = { ...state.assets[index], ...assetData };
                showNotification('Aset berhasil diperbarui!', 'success');
            }
        } else {
            state.assets.push({
                id: Date.now(),
                ...assetData
            });
            showNotification('Aset berhasil ditambahkan!', 'success');
        }
        
        saveState();
        closeModal('asset-modal');
        renderAssetManagement();
    }

    function editAsset(assetId) {
        openAssetModal(assetId);
    }

    function deleteAsset(assetId) {
        if (confirm('Apakah Anda yakin ingin menghapus aset ini?')) {
            state.assets = state.assets.filter(asset => asset.id !== assetId);
            saveState();
            showNotification('Aset berhasil dihapus!', 'success');
            renderAssetManagement();
        }
    }

    // --- FINANCIAL MANAGEMENT ---
    function renderFinancialManagement() {
        renderFinancialSummary();
        renderFinancialCharts();
        renderTransactionList();
    }

    function renderFinancialSummary() {
        const now = new Date();
        const thisMonth = now.getMonth();
        const thisYear = now.getFullYear();
        
        const monthlyTransactions = state.transactions.filter(transaction => {
            const transactionDate = new Date(transaction.date);
            return transactionDate.getMonth() === thisMonth && transactionDate.getFullYear() === thisYear;
        });
        
        const monthlyIncome = monthlyTransactions
            .filter(t => t.type === 'income')
            .reduce((sum, t) => sum + t.amount, 0);
        
        const monthlyExpenses = monthlyTransactions
            .filter(t => t.type === 'expense')
            .reduce((sum, t) => sum + t.amount, 0);
        
        const netProfit = monthlyIncome - monthlyExpenses;
        
        document.getElementById('monthly-revenue').textContent = `Rp ${monthlyIncome.toLocaleString('id-ID')}`;
        document.getElementById('monthly-expenses').textContent = `Rp ${monthlyExpenses.toLocaleString('id-ID')}`;
        document.getElementById('net-profit').textContent = `Rp ${netProfit.toLocaleString('id-ID')}`;
        document.getElementById('total-transactions').textContent = monthlyTransactions.length.toLocaleString('id-ID');
    }

    function renderFinancialCharts() {
        renderFinancialChart();
        renderExpenseChart();
    }

    function renderFinancialChart() {
        const ctx = document.getElementById('financial-chart');
        if (!ctx) return;
        
        // Generate data for the last 6 months
        const labels = [];
        const incomeData = [];
        const expenseData = [];
        
        for (let i = 5; i >= 0; i--) {
            const date = new Date();
            date.setMonth(date.getMonth() - i);
            const monthStr = date.toLocaleDateString('id-ID', { month: 'short', year: 'numeric' });
            labels.push(monthStr);
            
            const monthTransactions = state.transactions.filter(transaction => {
                const transactionDate = new Date(transaction.date);
                return transactionDate.getMonth() === date.getMonth() && 
                       transactionDate.getFullYear() === date.getFullYear();
            });
            
            const monthIncome = monthTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const monthExpense = monthTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            incomeData.push(monthIncome);
            expenseData.push(monthExpense);
        }
        
        // Destroy existing chart if it exists
        if (window.financialChart) {
            window.financialChart.destroy();
        }
        
        // Create new chart
        window.financialChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Pemasukan',
                        data: incomeData,
                        backgroundColor: 'rgba(16, 185, 129, 0.8)',
                        borderColor: 'rgba(16, 185, 129, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Pengeluaran',
                        data: expenseData,
                        backgroundColor: 'rgba(239, 68, 68, 0.8)',
                        borderColor: 'rgba(239, 68, 68, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return 'Rp ' + value.toLocaleString('id-ID');
                            }
                        }
                    }
                }
            }
        });
    }

    function renderExpenseChart() {
        const ctx = document.getElementById('expense-chart');
        if (!ctx) return;
        
        // Calculate expenses by category
        const expensesByCategory = {};
        state.transactions
            .filter(t => t.type === 'expense')
            .forEach(transaction => {
                if (!expensesByCategory[transaction.category]) {
                    expensesByCategory[transaction.category] = 0;
                }
                expensesByCategory[transaction.category] += transaction.amount;
            });
        
        const labels = Object.keys(expensesByCategory);
        const data = Object.values(expensesByCategory);
        
        // Destroy existing chart if it exists
        if (window.expenseChart) {
            window.expenseChart.destroy();
        }
        
        // Create new chart
        window.expenseChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: [
                        'rgba(239, 68, 68, 0.8)',
                        'rgba(245, 158, 11, 0.8)',
                        'rgba(59, 130, 246, 0.8)',
                        'rgba(16, 185, 129, 0.8)',
                        'rgba(139, 92, 246, 0.8)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    }

    function renderTransactionList() {
        const container = document.getElementById('transaction-list');
        const transactions = state.transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        if (transactions.length === 0) {
            container.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">Belum ada transaksi.</p>';
        } else {
            container.innerHTML = transactions.slice(0, 10).map(transaction => `
                <div class="transaction-item">
                    <div>
                        <div style="font-weight: 600;">${transaction.category}</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">
                            ${new Date(transaction.date).toLocaleDateString('id-ID')} • ${transaction.description || '-'}
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div class="transaction-amount" style="color: ${transaction.type === 'income' ? 'var(--accent-success)' : 'var(--accent-danger)'};">
                            ${transaction.type === 'income' ? '+' : '-'}Rp ${transaction.amount.toLocaleString('id-ID')}
                        </div>
                    </div>
                </div>
            `).join('');
        }
    }

    function openTransactionModal() {
        const modal = document.getElementById('transaction-modal');
        document.getElementById('transaction-form').reset();
        document.getElementById('transaction-date').value = new Date().toISOString().split('T')[0];
        modal.style.display = 'flex';
    }

    function saveTransaction(event) {
        event.preventDefault();
        
        const transactionData = {
            type: document.getElementById('transaction-type').value,
            category: document.getElementById('transaction-category').value,
            amount: parseInt(document.getElementById('transaction-amount').value),
            description: document.getElementById('transaction-description').value,
            date: document.getElementById('transaction-date').value
        };
        
        state.transactions.push({
            id: Date.now(),
            ...transactionData
        });
        
        saveState();
        closeModal('transaction-modal');
        showNotification('Transaksi berhasil ditambahkan!', 'success');
        renderFinancialManagement();
    }

    // --- PAYROLL MANAGEMENT ---
    function renderPayrollManagement() {
        renderPayrollTable();
        renderPayrollGrid();
        updatePayrollSummary();
    }

    function renderPayrollTable() {
        const tableBody = document.getElementById('payroll-table-body');
        const employees = state.users.filter(u => u.role !== 'owner');
        
        if (state.payroll.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="10" style="text-align:center; color: var(--text-secondary);">Belum ada data gaji.</td></tr>';
        } else {
            tableBody.innerHTML = state.payroll.map(payroll => {
                const employee = employees.find(e => e.id === payroll.employeeId);
                if (!employee) return '';
                
                return `
                    <tr>
                        <td>${payroll.id}</td>
                        <td>${employee.name}</td>
                        <td>${getRoleLabel(employee.role)}</td>
                        <td>${payroll.period}</td>
                        <td>Rp ${payroll.base.toLocaleString('id-ID')}</td>
                        <td>Rp ${payroll.allowance.toLocaleString('id-ID')}</td>
                        <td>Rp ${payroll.deduction.toLocaleString('id-ID')}</td>
                        <td style="font-weight: 600; color: var(--accent-primary);">Rp ${payroll.total.toLocaleString('id-ID')}</td>
                        <td>
                            <span class="subscription-status ${payroll.status === 'paid' ? 'status-active' : 'status-warning'}">
                                ${payroll.status === 'paid' ? 'Sudah Dibayar' : 'Menunggu Pembayaran'}
                            </span>
                        </td>
                        <td>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-secondary" onclick="editPayroll(${payroll.id})" style="padding: 0.25rem 0.5rem;">
                                    <i data-lucide="edit" style="width: 14px; height: 14px;"></i>
                                </button>
                                <button class="btn btn-danger" onclick="deletePayroll(${payroll.id})" style="padding: 0.25rem 0.5rem;">
                                    <i data-lucide="trash-2" style="width: 14px; height: 14px;"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        lucide.createIcons();
    }

    function updatePayrollSummary() {
        if (state.payroll.length === 0) {
            document.getElementById('total-payroll').textContent = 'Rp 0';
            document.getElementById('avg-payroll').textContent = 'Rp 0';
            document.getElementById('highest-payroll').textContent = 'Rp 0';
            document.getElementById('lowest-payroll').textContent = 'Rp 0';
            return;
        }
        
        const totalPayroll = state.payroll.reduce((sum, p) => sum + p.total, 0);
        const avgPayroll = totalPayroll / state.payroll.length;
        const highestPayroll = Math.max(...state.payroll.map(p => p.total));
        const lowestPayroll = Math.min(...state.payroll.map(p => p.total));
        
        document.getElementById('total-payroll').textContent = `Rp ${totalPayroll.toLocaleString('id-ID')}`;
        document.getElementById('avg-payroll').textContent = `Rp ${Math.round(avgPayroll).toLocaleString('id-ID')}`;
        document.getElementById('highest-payroll').textContent = `Rp ${highestPayroll.toLocaleString('id-ID')}`;
        document.getElementById('lowest-payroll').textContent = `Rp ${lowestPayroll.toLocaleString('id-ID')}`;
    }

    function renderPayrollGrid() {
        const container = document.getElementById('payroll-grid');
        const employees = state.users.filter(u => u.role !== 'owner');
        
        if (employees.length === 0) {
            container.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">Belum ada karyawan.</p>';
        } else {
            container.innerHTML = employees.map(employee => {
                const payroll = state.payroll.find(p => p.employeeId === employee.id);
                const currentMonth = new Date().toISOString().slice(0, 7);
                const currentPayroll = payroll && payroll.period === currentMonth ? payroll : null;
                
                return `
                    <div class="payroll-card">
                        <div class="payroll-header">
                            <div class="payroll-name">${employee.name}</div>
                            <div class="payroll-role">${getRoleLabel(employee.role)}</div>
                        </div>
                        <div class="payroll-details">
                            <div class="payroll-detail"><strong>Periode:</strong> ${currentMonth}</div>
                            <div class="payroll-detail"><strong>Gaji Pokok:</strong> Rp ${(currentPayroll?.base || 0).toLocaleString('id-ID')}</div>
                            <div class="payroll-detail"><strong>Tunjangan:</strong> Rp ${(currentPayroll?.allowance || 0).toLocaleString('id-ID')}</div>
                            <div class="payroll-detail"><strong>Potongan:</strong> Rp ${(currentPayroll?.deduction || 0).toLocaleString('id-ID')}</div>
                            <div class="payroll-detail"><strong>Total:</strong> <strong style="color: var(--accent-primary);">Rp ${(currentPayroll?.total || 0).toLocaleString('id-ID')}</strong></div>
                        </div>
                        <div class="payroll-actions">
                            <button class="btn btn-primary" onclick="openPayrollModal(${employee.id})">
                                <i data-lucide="edit"></i> ${currentPayroll ? 'Edit' : 'Tambah'}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        lucide.createIcons();
    }

    function openPayrollModal(employeeId = null) {
        const modal = document.getElementById('payroll-modal');
        const title = document.getElementById('payroll-modal-title');
        const employeeSelect = document.getElementById('payroll-employee');
        
        // Populate employee select
        const employees = state.users.filter(u => u.role !== 'owner');
        employeeSelect.innerHTML = '<option value="">Pilih Karyawan</option>' +
            employees.map(emp => `<option value="${emp.id}">${emp.name} - ${getRoleLabel(emp.role)}</option>`).join('');
        
        if (employeeId) {
            const employee = employees.find(e => e.id === employeeId);
            const payroll = state.payroll.find(p => p.employeeId === employeeId && p.period === new Date().toISOString().slice(0, 7));
            
            if (payroll) {
                title.innerText = 'Edit Gaji';
                document.getElementById('payroll-id').value = payroll.id;
                employeeSelect.value = employeeId;
                document.getElementById('payroll-period').value = payroll.period;
                document.getElementById('payroll-base').value = payroll.base;
                document.getElementById('payroll-allowance').value = payroll.allowance;
                document.getElementById('payroll-deduction').value = payroll.deduction;
                document.getElementById('payroll-total').value = payroll.total;
                document.getElementById('payroll-status').value = payroll.status;
            } else {
                title.innerText = 'Tambah Gaji';
                document.getElementById('payroll-form').reset();
                document.getElementById('payroll-id').value = '';
                employeeSelect.value = employeeId;
                document.getElementById('payroll-period').value = new Date().toISOString().slice(0, 7);
            }
        } else {
            title.innerText = 'Tambah Gaji';
            document.getElementById('payroll-form').reset();
            document.getElementById('payroll-id').value = '';
            document.getElementById('payroll-period').value = new Date().toISOString().slice(0, 7);
        }
        
        modal.style.display = 'flex';
    }

    function savePayroll(event) {
        event.preventDefault();
        
        const payrollData = {
            employeeId: parseInt(document.getElementById('payroll-employee').value),
            period: document.getElementById('payroll-period').value,
            base: parseInt(document.getElementById('payroll-base').value),
            allowance: parseInt(document.getElementById('payroll-allowance').value),
            deduction: parseInt(document.getElementById('payroll-deduction').value),
            total: parseInt(document.getElementById('payroll-total').value),
            status: document.getElementById('payroll-status').value
        };
        
        const payrollId = document.getElementById('payroll-id').value;
        
        if (payrollId) {
            const index = state.payroll.findIndex(p => p.id == payrollId);
            if (index !== -1) {
                state.payroll[index] = { ...state.payroll[index], ...payrollData };
                showNotification('Gaji berhasil diperbarui!', 'success');
            }
        } else {
            state.payroll.push({
                id: Date.now(),
                ...payrollData
            });
            showNotification('Gaji berhasil ditambahkan!', 'success');
        }
        
        saveState();
        closeModal('payroll-modal');
        renderPayrollManagement();
    }

    function editPayroll(payrollId) {
        const payroll = state.payroll.find(p => p.id === payrollId);
        if (payroll) {
            openPayrollModal(payroll.employeeId);
        }
    }

    function deletePayroll(payrollId) {
        if (confirm('Apakah Anda yakin ingin menghapus data gaji ini?')) {
            state.payroll = state.payroll.filter(p => p.id !== payrollId);
            saveState();
            showNotification('Data gaji berhasil dihapus!', 'success');
            renderPayrollManagement();
        }
    }

    // --- SHIFT MANAGEMENT ---
    function renderShiftManagement() {
        renderShiftCalendar();
        renderShiftGrid();
    }

    function renderShiftCalendar() {
        const calendarContainer = document.getElementById('shift-calendar');
        const days = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];
        
        // Create calendar header
        let calendarHTML = '<div class="shift-day-header" style="grid-column: 1/-1;">Hari</div>';
        
        // Create day columns
        days.forEach(day => {
            calendarHTML += `
                <div class="shift-day">
                    <div class="shift-day-header">${day}</div>
                    <div class="shift-day-content">
                        ${renderShiftsForDay(day)}
                    </div>
                </div>
            `;
        });
        
        calendarContainer.innerHTML = calendarHTML;
        lucide.createIcons();
    }

    function renderShiftsForDay(day) {
        const dayShifts = state.shifts.filter(shift => shift.days.includes(day));
        
        if (dayShifts.length === 0) {
            return '<div style="color: var(--text-secondary); font-size: 0.875rem;">Tidak ada shift</div>';
        }
        
        return dayShifts.map(shift => {
            const employees = state.users.filter(u => shift.employees.includes(u.id));
            
            return `
                <div class="shift-assignment">
                    <div style="font-weight: 600;">${shift.name}</div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary);">${shift.startTime} - ${shift.endTime}</div>
                    <div style="margin-top: 0.25rem;">
                        ${employees.map(emp => `
                            <div style="font-size: 0.75rem; display: flex; align-items: center; gap: 0.25rem;">
                                <div class="shift-employee-avatar">${emp.name.charAt(0)}</div>
                                <span>${emp.name}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }).join('');
    }

    function renderShiftGrid() {
        const container = document.getElementById('shift-grid');
        
        if (state.shifts.length === 0) {
            container.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">Belum ada shift.</p>';
        } else {
            container.innerHTML = state.shifts.map(shift => {
                const shiftEmployees = state.users.filter(u => shift.employees.includes(u.id));
                
                return `
                    <div class="shift-card">
                        <div class="shift-header">
                            <div class="shift-name">${shift.name}</div>
                            <div class="shift-time">${shift.startTime} - ${shift.endTime}</div>
                        </div>
                        <div class="shift-employees">
                            <div style="font-weight: 600; margin-bottom: 0.5rem;">Hari Kerja:</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.25rem; margin-bottom: 0.5rem;">
                                ${shift.days.map(day => `
                                    <span style="background-color: var(--bg-tertiary); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">
                                        ${day}
                                    </span>
                                `).join('')}
                            </div>
                            <div style="font-weight: 600; margin-bottom: 0.5rem;">Karyawan:</div>
                            ${shiftEmployees.map(employee => `
                                <div class="shift-employee">
                                    <div class="shift-employee-avatar">${employee.name.charAt(0)}</div>
                                    <div>
                                        <div style="font-weight: 500;">${employee.name}</div>
                                        <div style="font-size: 0.75rem; color: var(--text-secondary);">${getRoleLabel(employee.role)}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="shift-actions">
                            <button class="btn btn-secondary" onclick="openShiftModal(${shift.id})">
                                <i data-lucide="edit"></i> Edit
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        lucide.createIcons();
    }

    function openShiftModal(shiftId = null) {
        const modal = document.getElementById('shift-modal');
        const title = document.getElementById('shift-modal-title');
        const employeesList = document.getElementById('shift-employees-list');
        
        // Populate employees list
        const employees = state.users.filter(u => u.role !== 'owner');
        employeesList.innerHTML = employees.map(employee => `
            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                <input type="checkbox" name="shift-employees" value="${employee.id}" ${shiftId && state.shifts.find(s => s.id === shiftId)?.employees.includes(employee.id) ? 'checked' : ''}>
                <span>${employee.name} - ${getRoleLabel(employee.role)}</span>
            </label>
        `).join('');
        
        if (shiftId) {
            const shift = state.shifts.find(s => s.id === shiftId);
            if (shift) {
                title.innerText = 'Edit Shift';
                document.getElementById('shift-id').value = shift.id;
                document.getElementById('shift-name').value = shift.name;
                document.getElementById('shift-start').value = shift.startTime;
                document.getElementById('shift-end').value = shift.endTime;
                
                // Check days
                const dayCheckboxes = document.querySelectorAll('input[name="shift-days"]');
                dayCheckboxes.forEach(checkbox => {
                    checkbox.checked = shift.days.includes(checkbox.value);
                });
            }
        } else {
            title.innerText = 'Tambah Shift';
            document.getElementById('shift-form').reset();
            document.getElementById('shift-id').value = '';
        }
        
        modal.style.display = 'flex';
    }

    function saveShift(event) {
        event.preventDefault();
        
        const selectedEmployees = Array.from(document.querySelectorAll('input[name="shift-employees"]:checked'))
            .map(cb => parseInt(cb.value));
        
        const selectedDays = Array.from(document.querySelectorAll('input[name="shift-days"]:checked'))
            .map(cb => cb.value);
        
        const shiftData = {
            name: document.getElementById('shift-name').value,
            startTime: document.getElementById('shift-start').value,
            endTime: document.getElementById('shift-end').value,
            days: selectedDays,
            employees: selectedEmployees
        };
        
        const shiftId = document.getElementById('shift-id').value;
        
        if (shiftId) {
            const index = state.shifts.findIndex(s => s.id == shiftId);
            if (index !== -1) {
                state.shifts[index] = { ...state.shifts[index], ...shiftData };
                showNotification('Shift berhasil diperbarui!', 'success');
            }
        } else {
            state.shifts.push({
                id: Date.now(),
                ...shiftData
            });
            showNotification('Shift berhasil ditambahkan!', 'success');
        }
        
        saveState();
        closeModal('shift-modal');
        renderShiftManagement();
    }

    // --- BRANCH MANAGEMENT ---
    function renderBranchManagement() {
        const container = document.getElementById('branch-grid');
        
        if (state.branches.length === 0) {
            container.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">Belum ada cabang.</p>';
        } else {
            container.innerHTML = state.branches.map(branch => {
                const manager = state.users.find(u => u.id === branch.manager);
                
                return `
                    <div class="branch-card">
                        <div class="branch-header">
                            <div class="branch-name">${branch.name}</div>
                            <div class="branch-status ${branch.status}">${branch.status === 'active' ? 'Aktif' : 'Tidak Aktif'}</div>
                        </div>
                        <div class="branch-details">
                            <div class="branch-detail"><strong>Alamat:</strong> ${branch.address}</div>
                            <div class="branch-detail"><strong>Telepon:</strong> ${branch.phone}</div>
                            <div class="branch-detail"><strong>Email:</strong> ${branch.email || '-'}</div>
                            <div class="branch-detail"><strong>Manager:</strong> ${manager ? manager.name : '-'}</div>
                        </div>
                        <div class="branch-actions">
                            <button class="btn btn-secondary" onclick="openBranchModal(${branch.id})">
                                <i data-lucide="edit"></i> Edit
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        lucide.createIcons();
    }

    function openBranchModal(branchId = null) {
        const modal = document.getElementById('branch-modal');
        const title = document.getElementById('branch-modal-title');
        const managerSelect = document.getElementById('branch-manager');
        
        // Populate manager select
        const managers = state.users.filter(u => u.role === 'admin' || u.role === 'owner');
        managerSelect.innerHTML = '<option value="">Pilih Manager</option>' +
            managers.map(manager => `<option value="${manager.id}">${manager.name}</option>`).join('');
        
        if (branchId) {
            const branch = state.branches.find(b => b.id === branchId);
            if (branch) {
                title.innerText = 'Edit Cabang';
                document.getElementById('branch-id').value = branch.id;
                document.getElementById('branch-name').value = branch.name;
                document.getElementById('branch-address').value = branch.address;
                document.getElementById('branch-phone').value = branch.phone;
                document.getElementById('branch-email').value = branch.email || '';
                managerSelect.value = branch.manager;
                document.getElementById('branch-status').value = branch.status;
            }
        } else {
            title.innerText = 'Tambah Cabang';
            document.getElementById('branch-form').reset();
            document.getElementById('branch-id').value = '';
        }
        
        modal.style.display = 'flex';
    }

    function saveBranch(event) {
        event.preventDefault();
        
        const branchData = {
            name: document.getElementById('branch-name').value,
            address: document.getElementById('branch-address').value,
            phone: document.getElementById('branch-phone').value,
            email: document.getElementById('branch-email').value,
            manager: parseInt(document.getElementById('branch-manager').value),
            status: document.getElementById('branch-status').value
        };
        
        const branchId = document.getElementById('branch-id').value;
        
        if (branchId) {
            const index = state.branches.findIndex(b => b.id == branchId);
            if (index !== -1) {
                state.branches[index] = { ...state.branches[index], ...branchData };
                showNotification('Cabang berhasil diperbarui!', 'success');
            }
        } else {
            state.branches.push({
                id: Date.now(),
                ...branchData
            });
            showNotification('Cabang berhasil ditambahkan!', 'success');
        }
        
        saveState();
        closeModal('branch-modal');
        renderBranchManagement();
    }

    // --- LICENSE MANAGEMENT ---
    function renderLicensePage() {
        updateLicenseInfo();
        renderUsageStatistics();
        renderTransactionHistory();
        renderSubscriptionPlans();
    }

    function updateLicenseInfo() {
        const expiryDate = new Date(state.license.expiryDate);
        const daysLeft = Math.ceil((expiryDate - new Date()) / (1000 * 60 * 60 * 24));
        
        document.getElementById('license-plan').textContent = getPlanLabel(state.license.plan);
        document.getElementById('license-expiry').textContent = expiryDate.toLocaleDateString('id-ID');
        document.getElementById('license-days-left').textContent = `${Math.max(0, daysLeft)} Hari`;
        document.getElementById('license-max-users').textContent = `${state.license.maxUsers} Users`;
    }

    function renderUsageStatistics() {
        const activeUsers = state.users.length;
        const usedTables = state.tables.length;
        
        const now = new Date();
        const thisMonth = now.getMonth();
        const thisYear = now.getFullYear();
        
        const monthlyOrders = state.orders.filter(order => {
            const orderDate = new Date(order.timestamp);
            return orderDate.getMonth() === thisMonth && orderDate.getFullYear() === thisYear;
        });
        
        const monthlyRevenue = monthlyOrders.reduce((sum, order) => sum + (order.total || 0), 0);
        
        document.getElementById('active-users-count').textContent = `${activeUsers}/${state.license.maxUsers}`;
        document.getElementById('used-tables-count').textContent = `${usedTables}/${state.license.maxTables}`;
        document.getElementById('monthly-orders').textContent = monthlyOrders.length.toLocaleString('id-ID');
        document.getElementById('monthly-revenue').textContent = `Rp ${monthlyRevenue.toLocaleString('id-ID')}`;
    }

    function renderTransactionHistory() {
        const container = document.getElementById('transaction-history');
        const transactions = state.licenseTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        if (transactions.length === 0) {
            container.innerHTML = '<p style="text-align:center; color: var(--text-secondary); padding: 2rem 0;">Belum ada transaksi.</p>';
        } else {
            container.innerHTML = transactions.map(transaction => `
                <div class="transaction-item">
                    <div>
                        <div style="font-weight: 600;">${getPlanLabel(transaction.plan)} - ${transaction.type === 'purchase' ? 'Pembelian' : 'Perpanjangan'}</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">
                            ${new Date(transaction.date).toLocaleDateString('id-ID')} • ${transaction.paymentMethod}
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div class="transaction-amount">Rp ${transaction.amount.toLocaleString('id-ID')}</div>
                        <div class="transaction-status status-${transaction.status}">
                            ${transaction.status === 'completed' ? 'Selesai' : transaction.status === 'pending' ? 'Menunggu' : 'Gagal'}
                        </div>
                    </div>
                </div>
            `).join('');
        }
    }

    function renderSubscriptionPlans() {
        const container = document.getElementById('subscription-plans');
        const subscriptionPlans = [
            {
                id: 'basic',
                name: 'Dasar',
                price: 299000,
                period: 'per bulan',
                features: [
                    'Maksimal 5 pengguna',
                    'Maksimal 10 meja',
                    'Support standar',
                    'Semua fitur POS',
                    'Laporan penjualan'
                ],
                recommended: false
            },
            {
                id: 'premium',
                name: 'Premium',
                price: 599000,
                period: 'per bulan',
                features: [
                    'Maksimal 10 pengguna',
                    'Maksimal 15 meja',
                    'Support prioritas',
                    'Semua fitur POS',
                    'Laporan lengkap',
                    'Analitik lanjutan'
                ],
                recommended: true
            },
            {
                id: 'enterprise',
                name: 'Enterprise',
                price: 999000,
                period: 'per bulan',
                features: [
                    'Pengguna tidak terbatas',
                    'Meja tidak terbatas',
                    'Support 24/7',
                    'Semua fitur POS',
                    'Laporan lengkap',
                    'Analitik lanjutan',
                    'Integrasi eksternal',
                    'Custom development'
                ],
                recommended: false
            }
        ];
        
        container.innerHTML = subscriptionPlans.map(plan => `
            <div class="plan-card ${plan.recommended ? 'recommended' : ''} ${state.license.plan === plan.id ? 'selected' : ''}" 
                 onclick="selectPlan('${plan.id}')">
                <h3>${plan.name}</h3>
                <div class="plan-price">Rp ${plan.price.toLocaleString('id-ID')}</div>
                <div class="plan-period">${plan.period}</div>
                <ul class="plan-features">
                    ${plan.features.map(feature => `<li><i data-lucide="check"></i> ${feature}</li>`).join('')}
                </ul>
                <button class="btn ${state.license.plan === plan.id ? 'btn-secondary' : 'btn-primary'}">
                    ${state.license.plan === plan.id ? 'Paket Aktif' : 'Pilih Paket'}
                </button>
            </div>
        `).join('');
        
        lucide.createIcons();
    }

    function openUpgradeModal() {
        const modal = document.getElementById('upgrade-modal');
        const container = document.getElementById('upgrade-plans-container');
        
        const upgradePlans = [
            {
                id: 'basic',
                name: 'Dasar',
                price: 299000,
                features: ['Maksimal 5 pengguna', 'Support standar']
            },
            {
                id: 'premium', 
                name: 'Premium',
                price: 599000,
                features: ['Maksimal 10 pengguna', 'Support prioritas']
            },
            {
                id: 'enterprise',
                name: 'Enterprise', 
                price: 999000,
                features: ['Pengguna tidak terbatas', 'Support 24/7']
            }
        ];
        
        container.innerHTML = upgradePlans.map(plan => `
            <div class="plan-card ${state.license.plan === plan.id ? 'selected' : ''}" 
                 onclick="processUpgrade('${plan.id}')">
                <h3>${plan.name}</h3>
                <div class="plan-price">Rp ${plan.price.toLocaleString('id-ID')}</div>
                <ul class="plan-features">
                    ${plan.features.map(feature => `<li><i data-lucide="check"></i> ${feature}</li>`).join('')}
                </ul>
                <button class="btn ${state.license.plan === plan.id ? 'btn-secondary' : 'btn-primary'}">
                    ${state.license.plan === plan.id ? 'Paket Saat Ini' : 'Upgrade Sekarang'}
                </button>
            </div>
        `).join('');
        
        modal.style.display = 'flex';
        lucide.createIcons();
    }

    function processUpgrade(planId) {
        if (state.license.plan === planId) {
            showNotification('Anda sudah menggunakan paket ini.', 'info');
            return;
        }
        
        const plans = {
            'basic': { maxUsers: 5, price: 299000 },
            'premium': { maxUsers: 10, price: 599000 },
            'enterprise': { maxUsers: 999, price: 999000 }
        };
        
        const selectedPlan = plans[planId];
        if (!selectedPlan) return;

        const newTransaction = {
            id: Date.now(),
            type: 'upgrade',
            plan: planId,
            amount: selectedPlan.price,
            date: new Date().toISOString(),
            status: 'completed',
            paymentMethod: 'Transfer Bank'
        };
        
        state.licenseTransactions.push(newTransaction);
        state.license.plan = planId;
        state.license.maxUsers = selectedPlan.maxUsers;
        state.license.status = 'active';

        if (state.users.length > selectedPlan.maxUsers) {
            state.users = state.users.slice(0, selectedPlan.maxUsers);
            showNotification(`Jumlah pengguna disesuaikan dengan paket baru.`, 'warning');
        }

        saveState();
        closeModal('upgrade-modal');
        renderLicensePage();
        showNotification(`Berhasil upgrade ke paket ${getPlanLabel(planId)}!`, 'success');
    }

    function extendLicense() {
        const plans = {
            'basic': { price: 299000 },
            'premium': { price: 599000 },
            'enterprise': { price: 999000 }
        };
        
        const currentPlan = plans[state.license.plan];
        if (!currentPlan) return;
        
        if (confirm(`Perpanjang lisensi ${getPlanLabel(state.license.plan)} dengan biaya Rp ${currentPlan.price.toLocaleString('id-ID')}?`)) {
            const newTransaction = {
                id: Date.now(),
                type: 'renewal',
                plan: state.license.plan,
                amount: currentPlan.price,
                date: new Date().toISOString(),
                status: 'completed',
                paymentMethod: 'QRIS'
            };
            
            state.licenseTransactions.push(newTransaction);
            
            const currentExpiry = new Date(state.license.expiryDate);
            currentExpiry.setDate(currentExpiry.getDate() + 30);
            state.license.expiryDate = currentExpiry.toISOString();
            state.license.status = 'active';
            
            saveState();
            renderLicensePage();
            showNotification('Lisensi berhasil diperpanjang 30 hari!', 'success');
        }
    }

    function showLicenseKey() {
        document.getElementById('license-key-display').value = state.license.key || 'Tidak ada kunci lisensi';
        document.getElementById('license-expiry-display').value = new Date(state.license.expiryDate).toLocaleDateString('id-ID');
        document.getElementById('license-key-modal').style.display = 'flex';
    }

    function copyLicenseKey() {
        const licenseKey = document.getElementById('license-key-display');
        licenseKey.select();
        navigator.clipboard.writeText(licenseKey.value);
        showNotification('Kunci lisensi berhasil disalin!', 'success');
    }

    function selectPlan(planId) {
        processUpgrade(planId);
    }

    function getPlanLabel(planId) {
        const planMap = {
            'basic': 'Dasar',
            'premium': 'Premium', 
            'enterprise': 'Enterprise'
        };
        return planMap[planId] || planId;
    }

    function checkLicenseLimits(itemType) {
        if (itemType === 'user' && state.users.length >= state.license.maxUsers) {
            showNotification(`Batas maksimal pengguna (${state.license.maxUsers}) telah tercapai! Upgrade paket untuk menambah lebih banyak pengguna.`, 'error');
            return false;
        }
        
        if (itemType === 'table' && state.tables.length >= state.license.maxTables) {
            showNotification(`Batas maksimal meja (${state.license.maxTables}) telah tercapai! Upgrade paket untuk menambah lebih banyak meja.`, 'error');
            return false;
        }
        
        if (state.license.status === 'expired') {
            showNotification('Lisensi Anda telah kedaluwarsa! Silakan perpanjang untuk melanjutkan menggunakan aplikasi.', 'error');
            return false;
        }
        
        return true;
    }

    // --- SETTINGS ---
    function renderSettings() {
        // Populate settings form with current user data
        const user = state.currentUser;
        document.getElementById('settings-name').value = user.name;
        document.getElementById('settings-email').value = user.email;
        document.getElementById('settings-role').value = user.role;
    }

    function updateProfile() {
        const name = document.getElementById('settings-name').value;
        const email = document.getElementById('settings-email').value;
        const role = document.getElementById('settings-role').value;
        
        // Update current user in state
        const userIndex = state.users.findIndex(u => u.id === state.currentUser.id);
        if (userIndex !== -1) {
            state.users[userIndex].name = name;
            state.users[userIndex].email = email;
            state.users[userIndex].role = role;
            state.currentUser.name = name;
            state.currentUser.email = email;
            state.currentUser.role = role;
            
            saveState();
            showNotification('Profil berhasil diperbarui!', 'success');
            renderUserInterface();
        }
    }

    function changePassword() {
        const oldPassword = document.getElementById('settings-old-password').value;
        const newPassword = document.getElementById('settings-new-password').value;
        const confirmPassword = document.getElementById('settings-confirm-password').value;
        
        // Validate old password
        if (oldPassword !== state.currentUser.password) {
            showNotification('Password lama tidak sesuai!', 'error');
            return;
        }
        
        // Validate new password
        if (newPassword.length < 6) {
            showNotification('Password baru minimal 6 karakter!', 'error');
            return;
        }
        
        // Validate password confirmation
        if (newPassword !== confirmPassword) {
            showNotification('Konfirmasi password tidak sesuai!', 'error');
            return;
        }
        
        // Update password
        const userIndex = state.users.findIndex(u => u.id === state.currentUser.id);
        if (userIndex !== -1) {
            state.users[userIndex].password = newPassword;
            state.currentUser.password = newPassword;
            
            saveState();
            showNotification('Password berhasil diubah!', 'success');
            
            // Clear form
            document.getElementById('settings-old-password').value = '';
            document.getElementById('settings-new-password').value = '';
            document.getElementById('settings-confirm-password').value = '';
        }
    }

    // --- CHATBOX ---
    function toggleChatbox() {
        document.getElementById('chatbox').classList.toggle('open');
    }

    function sendMessage() {
        const input = document.getElementById('chatbox-input');
        const message = input.value.trim();
        
        if (!message) return;
        
        // Add user message
        addChatMessage(message, 'user');
        
        // Clear input
        input.value = '';
        
        // Simulate AI response
        setTimeout(() => {
            const responses = [
                'Terima kasih atas pertanyaan Anda. Saya akan membantu Anda.',
                'Silakan jelaskan lebih detail tentang masalah yang Anda alami.',
                'Berdasarkan informasi yang Anda berikan, saya sarankan untuk...',
                'Untuk informasi lebih lanjut, Anda dapat menghubungi tim support kami.',
                'Apakah ada hal lain yang bisa saya bantu?'
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            addChatMessage(randomResponse, 'bot');
        }, 1000);
    }

    function addChatMessage(message, sender) {
        const chatboxBody = document.getElementById('chatbox-body');
        const messageElement = document.createElement('div');
        messageElement.className = `chat-message ${sender}`;
        messageElement.textContent = message;
        chatboxBody.appendChild(messageElement);
        
        // Scroll to bottom
        chatboxBody.scrollTop = chatboxBody.scrollHeight;
    }

    function handleChatInputKeypress(event) {
        if (event.key === 'Enter') {
            sendMessage();
        }
    }

    // --- UI HELPERS ---
    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }

    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('open');
    }

    function updateTableOrder() {
        renderTableOrder();
    }

    function renderCurrentPage() {
        const activePage = document.querySelector('.page.active');
        if (activePage) {
            const pageId = activePage.id.replace('-page', '');
            showPage(pageId);
        }
    }

    function getStatusLabel(status) {
        const statusMap = {
            'baru': 'Baru',
            'dimasak': 'Diproses',
            'siap': 'Siap',
            'selesai': 'Selesai'
        };
        return statusMap[status] || status;
    }

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', function() {
        loadState();
        lucide.createIcons();

        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                showPage(this.dataset.page);
            });
        });

        document.addEventListener('click', function(e) {
            if (!e.target.closest('.user-dropdown')) {
                document.getElementById('userDropdownMenu').classList.remove('show');
            }
        });

        document.getElementById('payment-amount').addEventListener('input', function() {
            const total = parseInt(document.getElementById('modal-total').textContent.replace(/\D/g,''));
            const paidAmount = parseInt(this.value) || 0;
            const change = paidAmount - total;
            document.getElementById('payment-change').textContent = `Rp ${Math.max(0, change).toLocaleString('id-ID')}`;
        });

        // Auto-calculate payroll total
        document.getElementById('payroll-base')?.addEventListener('input', calculatePayrollTotal);
        document.getElementById('payroll-allowance')?.addEventListener('input', calculatePayrollTotal);
        document.getElementById('payroll-deduction')?.addEventListener('input', calculatePayrollTotal);

        const today = new Date().toISOString().split('T')[0];
        document.getElementById('filter-date-from').value = today;
        document.getElementById('filter-date-to').value = today;
        document.getElementById('filter-reservation-date-from').value = today;
        document.getElementById('filter-reservation-date-to').value = today;

        renderUserInterface();
    });

    function calculatePayrollTotal() {
        const base = parseInt(document.getElementById('payroll-base').value) || 0;
        const allowance = parseInt(document.getElementById('payroll-allowance').value) || 0;
        const deduction = parseInt(document.getElementById('payroll-deduction').value) || 0;
        const total = base + allowance - deduction;
        document.getElementById('payroll-total').value = total;
    }
</script>

</body>
</html>
